dojo._xdResourceLoaded({depends:[["provide","dojo.data.ItemFileReadStore"],["require","dojo.data.util.filter"],["require","dojo.data.util.simpleFetch"],["require","dojo.date.stamp"]],defineResource:function(e){e._hasResource["dojo.data.ItemFileReadStore"]||(e._hasResource["dojo.data.ItemFileReadStore"]=!0,e.provide("dojo.data.ItemFileReadStore"),e.require("dojo.data.util.filter"),e.require("dojo.data.util.simpleFetch"),e.require("dojo.date.stamp"),e.declare("dojo.data.ItemFileReadStore",null,{constructor:function(t){this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._jsonFileUrl=t.url,this._jsonData=t.data,this._datatypeMap=t.typeMap||{},this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(t){return e.date.stamp.fromISOString(t)}}),this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0},this._itemsByIdentity=null,this._storeRefPropName="_S",this._itemNumPropName="_0",this._rootItemPropName="_RI",this._loadInProgress=!1,this._queuedFetches=[]},url:"",_assertIsItem:function(e){if(!this.isItem(e))throw new Error("dojo.data.ItemFileReadStore: Invalid item argument.")},_assertIsAttribute:function(e){if("string"!=typeof e)throw new Error("dojo.data.ItemFileReadStore: Invalid attribute argument.")},getValue:function(e,t,r){var a=this.getValues(e,t);return a.length>0?a[0]:r},getValues:function(e,t){return this._assertIsItem(e),this._assertIsAttribute(t),e[t]||[]},getAttributes:function(e){this._assertIsItem(e);var t=[];for(var r in e)r!==this._storeRefPropName&&r!==this._itemNumPropName&&r!==this._rootItemPropName&&t.push(r);return t},hasAttribute:function(e,t){return this.getValues(e,t).length>0},containsValue:function(t,r,a){var i=void 0;return"string"==typeof a&&(i=e.data.util.filter.patternToRegExp(a,!1)),this._containsValue(t,r,a,i)},_containsValue:function(t,r,a,i){return e.some(this.getValues(t,r),function(t){if(null!==t&&!e.isObject(t)&&i){if(t.toString().match(i))return!0}else if(a===t)return!0})},isItem:function(e){return e&&e[this._storeRefPropName]===this&&this._arrayOfAllItems[e[this._itemNumPropName]]===e?!0:!1},isItemLoaded:function(e){return this.isItem(e)},loadItem:function(e){this._assertIsItem(e.item)},getFeatures:function(){return this._features},getLabel:function(e){return this._labelAttr&&this.isItem(e)?this.getValue(e,this._labelAttr):void 0},getLabelAttributes:function(){return this._labelAttr?[this._labelAttr]:null},_fetchItems:function(t,r,a){var i=this,s=function(t,a){var s=[];if(t.query){var o=t.queryOptions?t.queryOptions.ignoreCase:!1,n={};for(var l in t.query){var d=t.query[l];"string"==typeof d&&(n[l]=e.data.util.filter.patternToRegExp(d,o))}for(var h=0;h<a.length;++h){var u=!0,f=a[h];if(null===f)u=!1;else for(var l in t.query){var d=t.query[l];i._containsValue(f,l,d,n[l])||(u=!1)}u&&s.push(f)}r(s,t)}else{for(var h=0;h<a.length;++h){var _=a[h];null!==_&&s.push(_)}r(s,t)}};if(this._loadFinished)s(t,this._getItemsArray(t.queryOptions));else if(this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:t,filter:s});else{this._loadInProgress=!0;var o={url:i._jsonFileUrl,handleAs:"json-comment-optional"},n=e.xhrGet(o);n.addCallback(function(e){try{i._getItemsFromLoadedData(e),i._loadFinished=!0,i._loadInProgress=!1,s(t,i._getItemsArray(t.queryOptions)),i._handleQueuedFetches()}catch(r){i._loadFinished=!0,i._loadInProgress=!1,a(r,t)}}),n.addErrback(function(e){i._loadInProgress=!1,a(e,t)})}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,s(t,this._getItemsArray(t.queryOptions))}catch(l){a(l,t)}else a(new Error("dojo.data.ItemFileReadStore: No JSON source data was provided as either URL or a nested Javascript object."),t)},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var e=0;e<this._queuedFetches.length;e++){var t=this._queuedFetches[e],r=t.args,a=t.filter;a?a(r,this._getItemsArray(r.queryOptions)):this.fetchItemByIdentity(r)}this._queuedFetches=[]}},_getItemsArray:function(e){return e&&e.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(){},_getItemsFromLoadedData:function(t){function r(t){var r=null!=t&&"object"==typeof t&&!e.isArray(t)&&!e.isFunction(t)&&t.constructor==Object&&"undefined"==typeof t._reference&&"undefined"==typeof t._type&&"undefined"==typeof t._value;return r}function a(t){i._arrayOfAllItems.push(t);for(var s in t){var o=t[s];if(o)if(e.isArray(o))for(var n=o,l=0;l<n.length;++l){var d=n[l];r(d)&&a(d)}else r(o)&&a(o)}}var i=this;this._labelAttr=t.label;var s,o;for(this._arrayOfAllItems=[],this._arrayOfTopLevelItems=t.items,s=0;s<this._arrayOfTopLevelItems.length;++s)o=this._arrayOfTopLevelItems[s],a(o),o[this._rootItemPropName]=!0;var n,l={};for(s=0;s<this._arrayOfAllItems.length;++s){o=this._arrayOfAllItems[s];for(n in o){if(n!==this._rootItemPropName){var d=o[n];null!==d?e.isArray(d)||(o[n]=[d]):o[n]=[null]}l[n]=n}}for(;l[this._storeRefPropName];)this._storeRefPropName+="_";for(;l[this._itemNumPropName];)this._itemNumPropName+="_";var h,u=t.identifier;if(u)for(this._itemsByIdentity={},this._features["dojo.data.api.Identity"]=u,s=0;s<this._arrayOfAllItems.length;++s){o=this._arrayOfAllItems[s],h=o[u];var f=h[0];if(this._itemsByIdentity[f]){if(this._jsonFileUrl)throw new Error("dojo.data.ItemFileReadStore:  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+u+"].  Value collided: ["+f+"]");if(this._jsonData)throw new Error("dojo.data.ItemFileReadStore:  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+u+"].  Value collided: ["+f+"]")}else this._itemsByIdentity[f]=o}else this._features["dojo.data.api.Identity"]=Number;for(s=0;s<this._arrayOfAllItems.length;++s)o=this._arrayOfAllItems[s],o[this._storeRefPropName]=this,o[this._itemNumPropName]=s;for(s=0;s<this._arrayOfAllItems.length;++s){o=this._arrayOfAllItems[s];for(n in o){h=o[n];for(var _=0;_<h.length;++_)if(d=h[_],null!==d&&"object"==typeof d){if(d._type&&d._value){var m=d._type,c=this._datatypeMap[m];if(!c)throw new Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+m+"'");if(e.isFunction(c))h[_]=new c(d._value);else{if(!e.isFunction(c.deserialize))throw new Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");h[_]=c.deserialize(d._value)}}if(d._reference){var I=d._reference;if(e.isString(I))h[_]=this._itemsByIdentity[I];else for(var y=0;y<this._arrayOfAllItems.length;++y){var p=this._arrayOfAllItems[y],g=!0;for(var v in I)p[v]!=I[v]&&(g=!1);g&&(h[_]=p)}}}}}},getIdentity:function(e){var t=this._features["dojo.data.api.Identity"];if(t===Number)return e[this._itemNumPropName];var r=e[t];return r?r[0]:null},fetchItemByIdentity:function(t){if(this._loadFinished){var r=this._getItemByIdentity(t.identity);if(t.onItem){var a=t.scope?t.scope:e.global;t.onItem.call(a,r)}}else{var i=this;if(this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:t});else{this._loadInProgress=!0;var s={url:i._jsonFileUrl,handleAs:"json-comment-optional"},o=e.xhrGet(s);o.addCallback(function(r){var a=t.scope?t.scope:e.global;try{i._getItemsFromLoadedData(r),i._loadFinished=!0,i._loadInProgress=!1;var s=i._getItemByIdentity(t.identity);t.onItem&&t.onItem.call(a,s),i._handleQueuedFetches()}catch(o){i._loadInProgress=!1,t.onError&&t.onError.call(a,o)}}),o.addErrback(function(r){if(i._loadInProgress=!1,t.onError){var a=t.scope?t.scope:e.global;t.onError.call(a,r)}})}else if(this._jsonData){i._getItemsFromLoadedData(i._jsonData),i._jsonData=null,i._loadFinished=!0;var r=i._getItemByIdentity(t.identity);if(t.onItem){var a=t.scope?t.scope:e.global;t.onItem.call(a,r)}}}},_getItemByIdentity:function(e){var t=null;return t=this._itemsByIdentity?this._itemsByIdentity[e]:this._arrayOfAllItems[e],void 0===t&&(t=null),t},getIdentityAttributes:function(){var e=this._features["dojo.data.api.Identity"];return e===Number?null:[e]},_forceLoad:function(){var t=this;if(this._jsonFileUrl){var r={url:t._jsonFileUrl,handleAs:"json-comment-optional",sync:!0},a=e.xhrGet(r);a.addCallback(function(e){try{t._loadInProgress===!0||t._loadFinished||(t._getItemsFromLoadedData(e),t._loadFinished=!0)}catch(r){throw console.log(r),r}}),a.addErrback(function(e){throw e})}else this._jsonData&&(t._getItemsFromLoadedData(t._jsonData),t._jsonData=null,t._loadFinished=!0)}}),e.extend(e.data.ItemFileReadStore,e.data.util.simpleFetch))}});