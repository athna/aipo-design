dojo._xdResourceLoaded({depends:[["provide","dojo.dnd.Manager"],["require","dojo.dnd.common"],["require","dojo.dnd.autoscroll"],["require","dojo.dnd.Avatar"]],defineResource:function(o){o._hasResource["dojo.dnd.Manager"]||(o._hasResource["dojo.dnd.Manager"]=!0,o.provide("dojo.dnd.Manager"),o.require("dojo.dnd.common"),o.require("dojo.dnd.autoscroll"),o.require("dojo.dnd.Avatar"),o.dnd.Manager=function(){this.avatar=null,this.source=null,this.nodes=[],this.copy=!0,this.target=null,this.canDropFlag=!1,this.events=[]},o.extend(o.dnd.Manager,{OFFSET_X:16,OFFSET_Y:16,overSource:function(t){this.avatar&&(this.target=t&&"Disabled"!=t.targetState?t:null,this.avatar.update()),o.publish("/dnd/source/over",[t])},outSource:function(t){this.avatar?this.target==t&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),o.publish("/dnd/source/over",[null])):o.publish("/dnd/source/over",[null])},startDrag:function(t,e,a){this.source=t,this.nodes=e,this.copy=Boolean(a),this.avatar=this.makeAvatar(),o.body().appendChild(this.avatar.node),o.publish("/dnd/start",[t,e,this.copy]),this.events=[o.connect(o.doc,"onmousemove",this,"onMouseMove"),o.connect(o.doc,"onmouseup",this,"onMouseUp"),o.connect(o.doc,"onkeydown",this,"onKeyDown"),o.connect(o.doc,"onkeyup",this,"onKeyUp")];var n="dojoDnd"+(a?"Copy":"Move");o.addClass(o.body(),n)},canDrop:function(o){var t=this.target&&o;this.canDropFlag!=t&&(this.canDropFlag=t,this.avatar.update())},stopDrag:function(){o.removeClass(o.body(),"dojoDndCopy"),o.removeClass(o.body(),"dojoDndMove"),o.forEach(this.events,o.disconnect),this.events=[],this.avatar.destroy(),this.avatar=null,this.source=null,this.nodes=[]},makeAvatar:function(){return new o.dnd.Avatar(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(t){var e=this.avatar;if(e){o.dnd.autoScroll(t),o.marginBox(e.node,{l:t.pageX+this.OFFSET_X,t:t.pageY+this.OFFSET_Y});var a=Boolean(this.source.copyState(o.dnd.getCopyKeyState(t)));this.copy!=a&&this._setCopyStatus(a)}},onMouseUp:function(t){if(!(!this.avatar||"mouseButton"in this.source&&this.source.mouseButton!=t.button)){if(this.target&&this.canDropFlag){var e=[this.source,this.nodes,Boolean(this.source.copyState(o.dnd.getCopyKeyState(t))),this.target];o.publish("/dnd/drop/before",e),o.publish("/dnd/drop",e)}else o.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(t){if(this.avatar)switch(t.keyCode){case o.keys.CTRL:var e=Boolean(this.source.copyState(!0));this.copy!=e&&this._setCopyStatus(e);break;case o.keys.ESCAPE:o.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(t){if(this.avatar&&t.keyCode==o.keys.CTRL){var e=Boolean(this.source.copyState(!1));this.copy!=e&&this._setCopyStatus(e)}},_setCopyStatus:function(t){this.copy=t,this.source._markDndStatus(this.copy),this.updateAvatar(),o.removeClass(o.body(),"dojoDnd"+(this.copy?"Move":"Copy")),o.addClass(o.body(),"dojoDnd"+(this.copy?"Copy":"Move"))}}),o.dnd._manager=null,o.dnd.manager=function(){return o.dnd._manager||(o.dnd._manager=new o.dnd.Manager),o.dnd._manager})}});