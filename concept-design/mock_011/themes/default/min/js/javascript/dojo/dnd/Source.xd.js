dojo._xdResourceLoaded({depends:[["provide","dojo.dnd.Source"],["require","dojo.dnd.Selector"],["require","dojo.dnd.Manager"]],defineResource:function(t){t._hasResource["dojo.dnd.Source"]||(t._hasResource["dojo.dnd.Source"]=!0,t.provide("dojo.dnd.Source"),t.require("dojo.dnd.Selector"),t.require("dojo.dnd.Manager"),t.declare("dojo.dnd.Source",t.dnd.Selector,{isSource:!0,horizontal:!1,copyOnly:!1,skipForm:!1,withHandles:!1,accept:["text"],constructor:function(e,r){r||(r={}),this.isSource="undefined"==typeof r.isSource?!0:r.isSource;var o=r.accept instanceof Array?r.accept:["text"];if(this.accept=null,o.length){this.accept={};for(var n=0;n<o.length;++n)this.accept[o[n]]=1}this.horizontal=r.horizontal,this.copyOnly=r.copyOnly,this.withHandles=r.withHandles,this.isDragging=!1,this.mouseDown=!1,this.targetAnchor=null,this.targetBox=null,this.before=!0,this.sourceState="",this.isSource&&t.addClass(this.node,"dojoDndSource"),this.targetState="",this.accept&&t.addClass(this.node,"dojoDndTarget"),this.horizontal&&t.addClass(this.node,"dojoDndHorizontal"),this.topics=[t.subscribe("/dnd/source/over",this,"onDndSourceOver"),t.subscribe("/dnd/start",this,"onDndStart"),t.subscribe("/dnd/drop",this,"onDndDrop"),t.subscribe("/dnd/cancel",this,"onDndCancel")]},checkAcceptance:function(t,e){if(this==t)return!0;for(var r=0;r<e.length;++r){for(var o=t.getItem(e[r].id).type,n=!1,i=0;i<o.length;++i)if(o[i]in this.accept){n=!0;break}if(!n)return!1}return!0},copyState:function(t){return this.copyOnly||t},destroy:function(){t.dnd.Source.superclass.destroy.call(this),t.forEach(this.topics,t.unsubscribe),this.targetAnchor=null},markupFactory:function(e,r){return e._skipStartup=!0,new t.dnd.Source(r,e)},onMouseMove:function(e){if(!this.isDragging||"Disabled"!=this.targetState){t.dnd.Source.superclass.onMouseMove.call(this,e);var r=t.dnd.manager();if(this.isDragging){var o=!1;this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox={xy:t.coords(this.current,!0),w:this.current.offsetWidth,h:this.current.offsetHeight}),o=this.horizontal?e.pageX-this.targetBox.xy.x<this.targetBox.w/2:e.pageY-this.targetBox.xy.y<this.targetBox.h/2),(this.current!=this.targetAnchor||o!=this.before)&&(this._markTargetAnchor(o),r.canDrop(!(this.current&&r.source==this&&this.current.id in this.selection)))}else if(this.mouseDown&&this.isSource){var n=this.getSelectedNodes();n.length&&r.startDrag(this,n,this.copyState(t.dnd.getCopyKeyState(e)))}}},onMouseDown:function(e){!this._legalMouseDown(e)||this.skipForm&&t.dnd.isFormElement(e)||(this.mouseDown=!0,this.mouseButton=e.button,t.dnd.Source.superclass.onMouseDown.call(this,e))},onMouseUp:function(e){this.mouseDown&&(this.mouseDown=!1,t.dnd.Source.superclass.onMouseUp.call(this,e))},onDndSourceOver:function(e){if(this!=e)this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor();else if(this.isDragging){var r=t.dnd.manager();r.canDrop(!("Disabled"==this.targetState||this.current&&r.source==this&&this.current.id in this.selection))}},onDndStart:function(e,r,o){this.isSource&&this._changeState("Source",this==e?o?"Copied":"Moved":"");var n=this.accept&&this.checkAcceptance(e,r);this._changeState("Target",n?"":"Disabled"),n&&this==e&&t.dnd.manager().overSource(this),this.isDragging=!0},onDndDrop:function(e,r,o){do{if("Over"!=this.containerState)break;var n=this._normalizedCreator;if(this!=e)this._normalizedCreator=this.creator?function(t,r){return n.call(this,e.getItem(t.id).data,r)}:o?function(r){var o=e.getItem(r.id),n=r.cloneNode(!0);return n.id=t.dnd.getUniqueId(),{node:n,data:o.data,type:o.type}}:function(t){var r=e.getItem(t.id);return e.delItem(t.id),{node:t,data:r.data,type:r.type}};else{if(this.current&&this.current.id in this.selection)break;if(this.creator)if(o)this._normalizedCreator=function(t,r){return n.call(this,e.getItem(t.id).data,r)};else{if(!this.current)break;this._normalizedCreator=function(t){var r=e.getItem(t.id);return{node:t,data:r.data,type:r.type}}}else if(o)this._normalizedCreator=function(r){var o=e.getItem(r.id),n=r.cloneNode(!0);return n.id=t.dnd.getUniqueId(),{node:n,data:o.data,type:o.type}};else{if(!this.current)break;this._normalizedCreator=function(t){var r=e.getItem(t.id);return{node:t,data:r.data,type:r.type}}}}this._removeSelection(),this!=e&&this._removeAnchor(),this==e||o||this.creator||e.selectNone(),this.insertNodes(!0,r,this.before,this.current),this!=e&&!o&&this.creator&&e.deleteSelectedNodes(),this._normalizedCreator=n}while(!1);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null),this.before=!0,this.isDragging=!1,this.mouseDown=!1,delete this.mouseButton,this._changeState("Source",""),this._changeState("Target","")},onOverEvent:function(){t.dnd.Source.superclass.onOverEvent.call(this),t.dnd.manager().overSource(this)},onOutEvent:function(){t.dnd.Source.superclass.onOutEvent.call(this),t.dnd.manager().outSource(this)},_markTargetAnchor:function(t){(this.current!=this.targetAnchor||this.before!=t)&&(this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=t,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After"))},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=null,this.targetBox=null,this.before=!0)},_markDndStatus:function(t){this._changeState("Source",t?"Copied":"Moved")},_legalMouseDown:function(e){if(!this.withHandles)return!0;for(var r=e.target;r&&!t.hasClass(r,"dojoDndItem");r=r.parentNode)if(t.hasClass(r,"dojoDndHandle")){var o=e;o||(o=window.event);var n={x:o.clientX,y:o.clientY},i=!1;return t.query("a",r).forEach(function(t){if(!i){var e=t.getBoundingClientRect();i=e.left<=n.x&&n.x<=e.right&&e.top<=n.y&&n.y<=e.bottom}}),i?!1:!0}return!1}}),t.declare("dojo.dnd.Target",t.dnd.Source,{constructor:function(){this.isSource=!1,t.removeClass(this.node,"dojoDndSource")},markupFactory:function(e,r){return e._skipStartup=!0,new t.dnd.Target(r,e)}}))}});