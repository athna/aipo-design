dojo._hasResource["dojox.data.HtmlTableStore"]||(dojo._hasResource["dojox.data.HtmlTableStore"]=!0,dojo.provide("dojox.data.HtmlTableStore"),dojo.require("dojox.data.dom"),dojo.require("dojo.data.util.simpleFetch"),dojo.require("dojo.data.util.filter"),dojo.declare("dojox.data.HtmlTableStore",null,{constructor:function(t){if(t.url){if(!t.tableId)throw new Error("dojo.data.HtmlTableStore: Cannot instantiate using url without an id!");this.url=t.url,this.tableId=t.tableId}else{t.tableId?(this._rootNode=dojo.byId(t.tableId),this.tableId=this._rootNode.id):this._rootNode=dojo.byId(this.tableId),this._getHeadings();for(var o=0;o<this._rootNode.rows.length;o++)this._rootNode.rows[o].store=this}},url:"",tableId:"",_getHeadings:function(){this._headings=[],dojo.forEach(this._rootNode.tHead.rows[0].cells,dojo.hitch(this,function(t){this._headings.push(dojox.data.dom.textContent(t))}))},_getAllItems:function(){for(var t=[],o=1;o<this._rootNode.rows.length;o++)t.push(this._rootNode.rows[o]);return t},_assertIsItem:function(t){if(!this.isItem(t))throw new Error("dojo.data.HtmlTableStore: a function was passed an item argument that was not an item")},_assertIsAttribute:function(t){if("string"!=typeof t)throw new Error("dojo.data.HtmlTableStore: a function was passed an attribute argument that was not an attribute name string");return dojo.indexOf(this._headings,t)},getValue:function(t,o,e){var r=this.getValues(t,o);return r.length>0?r[0]:e},getValues:function(t,o){this._assertIsItem(t);var e=this._assertIsAttribute(o);return e>-1?[dojox.data.dom.textContent(t.cells[e])]:[]},getAttributes:function(t){this._assertIsItem(t);for(var o=[],e=0;e<this._headings.length;e++)this.hasAttribute(t,this._headings[e])&&o.push(this._headings[e]);return o},hasAttribute:function(t,o){return this.getValues(t,o).length>0},containsValue:function(t,o,e){var r=void 0;return"string"==typeof e&&(r=dojo.data.util.filter.patternToRegExp(e,!1)),this._containsValue(t,o,e,r)},_containsValue:function(t,o,e,r){for(var i=this.getValues(t,o),s=0;s<i.length;++s){var n=i[s];if("string"==typeof n&&r)return null!==n.match(r);if(e===n)return!0}return!1},isItem:function(t){return t&&t.store&&t.store===this?!0:!1},isItemLoaded:function(t){return this.isItem(t)},loadItem:function(t){this._assertIsItem(t.item)},_fetchItems:function(t,o,e){if(this._rootNode)this._finishFetchItems(t,o,e);else if(this.url){var r={url:this.url,handleAs:"text"},i=this,s=dojo.xhrGet(r);s.addCallback(function(r){var s=function(t,o){if(t.id==o)return t;if(t.childNodes)for(var e=0;e<t.childNodes.length;e++){var r=s(t.childNodes[e],o);if(r)return r}return null},n=document.createElement("div");n.innerHTML=r,i._rootNode=s(n,i.tableId),i._getHeadings.call(i);for(var a=0;a<i._rootNode.rows.length;a++)i._rootNode.rows[a].store=i;i._finishFetchItems(t,o,e)}),s.addErrback(function(o){e(o,t)})}else{this._rootNode=dojo.byId(this.tableId),this._getHeadings();for(var n=0;n<this._rootNode.rows.length;n++)this._rootNode.rows[n].store=this}},_finishFetchItems:function(t,o){var e=null,r=this._getAllItems();if(t.query){var i=t.queryOptions?t.queryOptions.ignoreCase:!1;e=[];var s={};for(var n in t.query){var a=t.query[n]+"";"string"==typeof a&&(s[n]=dojo.data.util.filter.patternToRegExp(a,i))}for(var d=0;d<r.length;++d){var l=!0,h=r[d];for(var n in t.query){var a=t.query[n]+"";this._containsValue(h,n,a,s[n])||(l=!1)}l&&e.push(h)}o(e,t)}else r.length>0&&(e=r.slice(0,r.length)),o(e,t)},getFeatures:function(){return{"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0}},close:function(){},getLabel:function(t){return this.isItem(t)?"Table Row #"+this.getIdentity(t):void 0},getLabelAttributes:function(){return null},getIdentity:function(t){return this._assertIsItem(t),dojo.isOpera?dojo.indexOf(this._rootNode.rows,t)-1:t.sectionRowIndex},getIdentityAttributes:function(){return null},fetchItemByIdentity:function(t){var o=t.identity,e=this,r=null;if(this._rootNode){if(this._rootNode.rows[o+1]&&(r=this._rootNode.rows[o+1],t.onItem)){var i=t.scope?t.scope:dojo.global;t.onItem.call(i,r)}}else if(this.url){var s={url:this.url,handleAs:"text"},e=this,n=dojo.xhrGet(s);n.addCallback(function(i){var s=function(t,o){if(t.id==o)return t;if(t.childNodes)for(var e=0;e<t.childNodes.length;e++){var r=s(t.childNodes[e],o);if(r)return r}return null},n=document.createElement("div");n.innerHTML=i,e._rootNode=s(n,e.tableId),e._getHeadings.call(e);for(var a=0;a<e._rootNode.rows.length;a++)e._rootNode.rows[a].store=e;if(r=e._rootNode.rows[o+1],t.onItem){var d=t.scope?t.scope:dojo.global;t.onItem.call(d,r)}}),n.addErrback(function(o){if(t.onError){var e=t.scope?t.scope:dojo.global;t.onError.call(e,o)}})}else{this._rootNode=dojo.byId(this.tableId),this._getHeadings();for(var a=0;a<this._rootNode.rows.length;a++)this._rootNode.rows[a].store=this;if(r=this._rootNode.rows[o+1],t.onItem){var i=t.scope?t.scope:dojo.global;t.onItem.call(i,r)}}}}),dojo.extend(dojox.data.HtmlTableStore,dojo.data.util.simpleFetch));