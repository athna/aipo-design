dojo._hasResource["dojox.data.PicasaStore"]||(dojo._hasResource["dojox.data.PicasaStore"]=!0,dojo.provide("dojox.data.PicasaStore"),dojo.require("dojo.data.util.simpleFetch"),dojo.require("dojo.io.script"),dojo.require("dojo.date.stamp"),dojo.declare("dojox.data.PicasaStore",null,{constructor:function(t){t&&t.label&&(this.label=t.label)},_picasaUrl:"http://picasaweb.google.com/data/feed/api/all",_storeRef:"_S",label:"title",_assertIsItem:function(t){if(!this.isItem(t))throw new Error("dojox.data.PicasaStore: a function was passed an item argument that was not an item")},_assertIsAttribute:function(t){if("string"!=typeof t)throw new Error("dojox.data.PicasaStore: a function was passed an attribute argument that was not an attribute name string")},getFeatures:function(){return{"dojo.data.api.Read":!0}},getValue:function(t,e){var a=this.getValues(t,e);return a?a[0]:void 0},getAttributes:function(){return["id","published","updated","category","title$type","title","summary$type","summary","rights$type","rights","link","author","gphoto$id","gphoto$name","location"]},hasAttribute:function(t,e){return this.getValue(t,e)?!0:!1},isItemLoaded:function(t){return this.isItem(t)},loadItem:function(){},getLabel:function(t){return this.getValue(t,this.label)},getLabelAttributes:function(){return[this.label]},containsValue:function(t,e,a){for(var r=this.getValues(t,e),o=0;o<r.length;o++)if(r[o]===a)return!0;return!1},getValues:function(t,e){return this._assertIsItem(t),this._assertIsAttribute(e),"title"===e?[this._unescapeHtml(t.title)]:"author"===e?[this._unescapeHtml(t.author[0].name)]:"datePublished"===e?[dojo.date.stamp.fromISOString(t.published)]:"dateTaken"===e?[dojo.date.stamp.fromISOString(t.date_taken)]:"imageUrlSmall"===e?[t.media.thumbnail[1].url]:"imageUrl"===e?[t.content$src]:"imageUrlMedium"===e?[t.media.thumbnail[2].url]:"link"===e?[t.link[1]]:"tags"===e?t.tags.split(" "):"description"===e?[this._unescapeHtml(t.summary)]:void 0},isItem:function(t){return t&&t[this._storeRef]===this?!0:!1},close:function(){},_fetchItems:function(t,e,a){t.query||(t.query={});var r={alt:"jsonm",pp:"1",psc:"G"};r["start-index"]="1",t.query.start&&(r["start-index"]=t.query.start),t.query.tags&&(r.q=t.query.tags),t.query.userid&&(r.uname=t.query.userid),t.query.userids&&(r.ids=t.query.userids),t.query.lang&&(r.hl=t.query.lang),r["max-results"]=t.count?t.count:"20";var o=this,i=null,s=function(a){null!==i&&dojo.disconnect(i),e(o._processPicasaData(a),t)},n={url:this._picasaUrl,content:r,callbackParamName:"callback",handle:s},u=dojo.io.script.get(n);u.addErrback(function(e){dojo.disconnect(i),a(e,t)})},_processPicasaData:function(t){var e=[];if(t.feed){e=t.feed.entry;for(var a=0;a<e.length;a++){var r=e[a];r[this._storeRef]=this}}return e},_unescapeHtml:function(t){return t=t.replace(/&amp;/gm,"&").replace(/&lt;/gm,"<").replace(/&gt;/gm,">").replace(/&quot;/gm,'"'),t=t.replace(/&#39;/gm,"'")}}),dojo.extend(dojox.data.PicasaStore,dojo.data.util.simpleFetch));