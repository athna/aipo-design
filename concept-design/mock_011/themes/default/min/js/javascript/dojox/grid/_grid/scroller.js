dojo._hasResource["dojox.grid._grid.scroller"]||(dojo._hasResource["dojox.grid._grid.scroller"]=!0,dojo.provide("dojox.grid._grid.scroller"),dojo.declare("dojox.grid.scroller.base",null,{constructor:function(){this.pageHeights=[],this.stack=[]},rowCount:0,defaultRowHeight:10,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,lastVisibleRow:0,page:0,pageTop:0,init:function(t,e,i){switch(arguments.length){case 3:this.rowsPerPage=i;case 2:this.keepRows=e;case 1:this.rowCount=t}this.defaultPageHeight=this.defaultRowHeight*this.rowsPerPage,this.pageCount=Math.ceil(this.rowCount/this.rowsPerPage),this.keepPages=Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2),this.invalidate(),this.scrollboxNode&&(this.scrollboxNode.scrollTop=0,this.scroll(0),this.scrollboxNode.onscroll=dojo.hitch(this,"onscroll"))},invalidate:function(){this.invalidateNodes(),this.pageHeights=[],this.height=this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0,this.resize()},updateRowCount:function(t){if(this.invalidateNodes(),this.rowCount=t,oldPageCount=this.pageCount,this.pageCount=Math.ceil(this.rowCount/this.rowsPerPage),this.pageCount<oldPageCount)for(var e=oldPageCount-1;e>=this.pageCount;e--)this.height-=this.getPageHeight(e),delete this.pageHeights[e];else this.pageCount>oldPageCount&&(this.height+=this.defaultPageHeight*(this.pageCount-oldPageCount-1)+this.calcLastPageHeight());this.resize()},pageExists:function(){},measurePage:function(){},positionPage:function(){},repositionPages:function(){},installPage:function(){},preparePage:function(){},renderPage:function(){},removePage:function(){},pacify:function(){},pacifying:!1,pacifyTicks:200,setPacifying:function(t){this.pacifying!=t&&(this.pacifying=t,this.pacify(this.pacifying))},startPacify:function(){this.startPacifyTicks=(new Date).getTime()},doPacify:function(){var t=(new Date).getTime()-this.startPacifyTicks>this.pacifyTicks;return this.setPacifying(!0),this.startPacify(),t},endPacify:function(){this.setPacifying(!1)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight),dojox.grid.setStyleHeightPx(this.contentNode,this.height)},calcLastPageHeight:function(){if(!this.pageCount)return 0;var t=this.pageCount-1,e=(this.rowCount%this.rowsPerPage||this.rowsPerPage)*this.defaultRowHeight;return this.pageHeights[t]=e,e},updateContentHeight:function(t){this.height+=t,this.resize()},updatePageHeight:function(t){if(this.pageExists(t)){var e=this.getPageHeight(t),i=this.measurePage(t)||e;this.pageHeights[t]=i,i&&e!=i&&(this.updateContentHeight(i-e),this.repositionPages(t))}},rowHeightChanged:function(t){this.updatePageHeight(Math.floor(t/this.rowsPerPage))},invalidateNodes:function(){for(;this.stack.length;)this.destroyPage(this.popPage())},createPageNode:function(){var t=document.createElement("div");return t.style.position="absolute",t.style.left="0",t},getPageHeight:function(t){var e=this.pageHeights[t];return void 0!==e?e:this.defaultPageHeight},pushPage:function(t){return this.stack.push(t)},popPage:function(){return this.stack.shift()},findPage:function(t){for(var e=0,i=0,o=0;e<this.pageCount&&(o=this.getPageHeight(e),!(i+o>=t));e++,i+=o);this.page=e,this.pageTop=i},buildPage:function(t,e,i){this.preparePage(t,e),this.positionPage(t,i),this.installPage(t),this.renderPage(t),this.pushPage(t)},needPage:function(t,e){var i=this.getPageHeight(t),o=i;return this.pageExists(t)?this.positionPage(t,e):(this.buildPage(t,this.keepPages&&this.stack.length>=this.keepPages,e),i=this.measurePage(t)||i,this.pageHeights[t]=i,i&&o!=i&&this.updateContentHeight(i-o)),i},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop)},scroll:function(t){this.startPacify(),this.findPage(t);for(var e=this.height,i=this.getScrollBottom(t),o=this.page,s=this.pageTop;o<this.pageCount&&(0>i||i>s);o++)s+=this.needPage(o,s);this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,t),this.lastVisibleRow=this.getLastVisibleRow(o-1,s,i),e!=this.height&&this.repositionPages(o-1),this.endPacify()},getScrollBottom:function(t){return this.windowHeight>=0?t+this.windowHeight:-1},processNodeEvent:function(t,e){for(var i=t.target;i&&i!=e&&i.parentNode&&i.parentNode.parentNode!=e;)i=i.parentNode;if(!i||!i.parentNode||i.parentNode.parentNode!=e)return!1;var o=i.parentNode;return t.topRowIndex=o.pageIndex*this.rowsPerPage,t.rowIndex=t.topRowIndex+dojox.grid.indexInParent(i),t.rowTarget=i,!0},processEvent:function(t){return this.processNodeEvent(t,this.contentNode)},dummy:0}),dojo.declare("dojox.grid.scroller",dojox.grid.scroller.base,{constructor:function(){this.pageNodes=[]},renderRow:function(){},removeRow:function(){},getDefaultNodes:function(){return this.pageNodes},getDefaultPageNode:function(t){return this.getDefaultNodes()[t]},positionPageNode:function(t,e){t.style.top=e+"px"},getPageNodePosition:function(t){return t.offsetTop},repositionPageNodes:function(t,e){for(var i=0,o=0;o<this.stack.length;o++)i=Math.max(this.stack[o],i);for(var s=e[t],n=s?this.getPageNodePosition(s)+this.getPageHeight(t):0,a=t+1;i>=a;a++){if(s=e[a]){if(this.getPageNodePosition(s)==n)return;this.positionPage(a,n)}n+=this.getPageHeight(a)}},invalidatePageNode:function(t,e){var i=e[t];return i&&(delete e[t],this.removePage(t,i),dojox.grid.cleanNode(i),i.innerHTML=""),i},preparePageNode:function(t,e,i){var o=null===e?this.createPageNode():this.invalidatePageNode(e,i);o.pageIndex=t,o.id="page-"+t,i[t]=o},pageExists:function(t){return Boolean(this.getDefaultPageNode(t))},measurePage:function(t){return this.getDefaultPageNode(t).offsetHeight},positionPage:function(t,e){this.positionPageNode(this.getDefaultPageNode(t),e)},repositionPages:function(t){this.repositionPageNodes(t,this.getDefaultNodes())},preparePage:function(t,e){this.preparePageNode(t,e?this.popPage():null,this.getDefaultNodes())},installPage:function(t){this.contentNode.appendChild(this.getDefaultPageNode(t))},destroyPage:function(t){var e=this.invalidatePageNode(t,this.getDefaultNodes());dojox.grid.removeNode(e)},renderPage:function(t){for(var e=this.pageNodes[t],i=0,o=t*this.rowsPerPage;i<this.rowsPerPage&&o<this.rowCount;i++,o++)this.renderRow(o,e)},removePage:function(t){for(var e=0,i=t*this.rowsPerPage;e<this.rowsPerPage;e++,i++)this.removeRow(i)},getPageRow:function(t){return t*this.rowsPerPage},getLastPageRow:function(t){return Math.min(this.rowCount,this.getPageRow(t+1))-1},getFirstVisibleRowNodes:function(t,e,i,o){for(var s=this.getPageRow(t),n=dojox.grid.divkids(o[t]),a=0,r=n.length;r>a&&i>e;a++,s++)e+=n[a].offsetHeight;return s?s-1:s},getFirstVisibleRow:function(t,e,i){return this.pageExists(t)?this.getFirstVisibleRowNodes(t,e,i,this.getDefaultNodes()):0},getLastVisibleRowNodes:function(t,e,i,o){for(var s=this.getLastPageRow(t),n=dojox.grid.divkids(o[t]),a=n.length-1;a>=0&&e>i;a--,s--)e-=n[a].offsetHeight;return s+1},getLastVisibleRow:function(t,e,i){return this.pageExists(t)?this.getLastVisibleRowNodes(t,e,i,this.getDefaultNodes()):0},findTopRowForNodes:function(t,e){for(var i,o=dojox.grid.divkids(e[this.page]),s=0,n=o.length,a=this.pageTop;n>s;s++)if(i=o[s].offsetHeight,a+=i,a>=t)return this.offset=i-(a-t),s+this.page*this.rowsPerPage;return-1},findScrollTopForNodes:function(t,e){for(var i=Math.floor(t/this.rowsPerPage),o=0,s=0;i>s;s++)o+=this.getPageHeight(s);this.pageTop=o,this.needPage(i,this.pageTop);for(var n=dojox.grid.divkids(e[i]),a=t-this.rowsPerPage*i,s=0,r=n.length;r>s&&a>s;s++)o+=n[s].offsetHeight;return o},findTopRow:function(t){return this.findTopRowForNodes(t,this.getDefaultNodes())},findScrollTop:function(t){return this.findScrollTopForNodes(t,this.getDefaultNodes())},dummy:0}),dojo.declare("dojox.grid.scroller.columns",dojox.grid.scroller,{constructor:function(t){this.setContentNodes(t)},setContentNodes:function(t){this.contentNodes=t,this.colCount=this.contentNodes?this.contentNodes.length:0,this.pageNodes=[];for(var e=0;e<this.colCount;e++)this.pageNodes[e]=[]},getDefaultNodes:function(){return this.pageNodes[0]||[]},scroll:function(t){this.colCount&&dojox.grid.scroller.prototype.scroll.call(this,t)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight);for(var t=0;t<this.colCount;t++)dojox.grid.setStyleHeightPx(this.contentNodes[t],this.height)},positionPage:function(t,e){for(var i=0;i<this.colCount;i++)this.positionPageNode(this.pageNodes[i][t],e)},preparePage:function(t,e){for(var i=e?this.popPage():null,o=0;o<this.colCount;o++)this.preparePageNode(t,i,this.pageNodes[o])},installPage:function(t){for(var e=0;e<this.colCount;e++)this.contentNodes[e].appendChild(this.pageNodes[e][t])},destroyPage:function(t){for(var e=0;e<this.colCount;e++)dojox.grid.removeNode(this.invalidatePageNode(t,this.pageNodes[e]))},renderPage:function(t){for(var e=[],i=0;i<this.colCount;i++)e[i]=this.pageNodes[i][t];for(var i=0,o=t*this.rowsPerPage;i<this.rowsPerPage&&o<this.rowCount;i++,o++)this.renderRow(o,e)}}));