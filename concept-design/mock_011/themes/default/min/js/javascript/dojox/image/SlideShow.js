dojo._hasResource["dojox.image.SlideShow"]||(dojo._hasResource["dojox.image.SlideShow"]=!0,dojo.provide("dojox.image.SlideShow"),dojo.require("dojo.fx"),dojo.require("dijit._Widget"),dojo.require("dijit._Templated"),dojo.declare("dojox.image.SlideShow",[dijit._Widget,dijit._Templated],{imageHeight:375,imageWidth:500,title:"",titleTemplate:'@title <span class="slideShowCounterText">(@current of @total)</span>',noLink:!1,loop:!0,hasNav:!0,images:[],pageSize:20,autoLoad:!0,fixedHeight:!1,imageStore:null,linkAttr:"link",imageLargeAttr:"imageUrl",titleAttr:"title",slideshowInterval:3,templateString:'<div dojoAttachPoint="outerNode" class="slideShowWrapper">\r\n	<div style="position:relative;" dojoAttachPoint="innerWrapper">\r\n		<div class="slideShowNav" dojoAttachEvent="onclick: _handleClick">\r\n			<div class="dijitInline slideShowTitle" dojoAttachPoint="titleNode">${title}</div>\r\n		</div>\r\n		<div dojoAttachPoint="navNode" class="slideShowCtrl" dojoAttachEvent="onclick: _handleClick">\r\n			<span dojoAttachPoint="navPrev" class="slideShowCtrlPrev"></span>\r\n			<span dojoAttachPoint="navPlay" class="slideShowCtrlPlay"></span>\r\n			<span dojoAttachPoint="navNext" class="slideShowCtrlNext"></span>\r\n		</div>\r\n		<div dojoAttachPoint="largeNode" class="slideShowImageWrapper"></div>		\r\n		<div dojoAttachPoint="hiddenNode" class="slideShowHidden"></div>\r\n	</div>\r\n</div>\r\n',_tempImgPath:dojo.moduleUrl("dojox.image","resources/images/1pixel.gif"),_imageCounter:0,_tmpImage:null,_request:null,postCreate:function(){this.inherited("postCreate",arguments);var t=document.createElement("img");t.setAttribute("width",this.imageWidth),t.setAttribute("height",this.imageHeight),this.hasNav&&(dojo.connect(this.outerNode,"onmouseover",function(){try{e._showNav()}catch(t){}}),dojo.connect(this.outerNode,"onmouseout",function(t){try{e._hideNav(t)}catch(i){}})),this.outerNode.style.width=this.imageWidth+"px",t.setAttribute("src",this._tempImgPath);var e=this;this.largeNode.appendChild(t),this._tmpImage=t,this._currentImage=t,this._fitSize(!0),this._loadImage(0,function(){e.showImage(0)}),this._calcNavDimensions()},setDataStore:function(t,e,i){this.reset();var o=this;this._request={query:{},start:e.start?e.start:0,count:e.count?e.count:this.pageSize,onBegin:function(t){o.maxPhotos=t}},e.query&&dojo.mixin(this._request.query,e.query),i&&i.imageLargeAttr&&(this.imageLargeAttr=i.imageLargeAttr);var o=this,s=function(){o.showImage(0),o._request.onComplete=null};this.imageStore=t,this._request.onComplete=s,this._request.start=0,this.imageStore.fetch(this._request)},reset:function(){for(;this.largeNode.firstChild;)this.largeNode.removeChild(this.largeNode.firstChild);for(this.largeNode.appendChild(this._tmpImage);this.hiddenNode.firstChild;)this.hiddenNode.removeChild(this.hiddenNode.firstChild);for(var t,e=0;e<this.images.length;e++)t=this.images[e],t&&t.parentNode&&t.parentNode.removeChild(t);this.images=[],this.isInitialized=!1,this._imageCounter=0},isImageLoaded:function(t){return this.images&&this.images.length>index&&this.images[t]},moveImageLoadingPointer:function(t){this._imageCounter=t},destroy:function(){this._slideId&&this._stop(),this.inherited("destroy",arguments)},showNextImage:function(t,e){if(t&&this._timerCancelled)return!1;if(this.imageIndex+1>=this.maxPhotos){if(!t||!this.loop&&!e)return this._slideId&&this._stop(),!1;this.imageIndex=-1}var i=this;return this.showImage(this.imageIndex+1,function(){t&&i._startTimer()}),!0},toggleSlideShow:function(){if(this._slideId)this._stop();else{dojo.toggleClass(this.domNode,"slideShowPaused"),this._timerCancelled=!1;var t=this.showNextImage(!0,!0);t||this._stop()}},getShowTopicName:function(){return(this.widgetId?this.widgetId:this.id)+"/imageShow"},getLoadTopicName:function(){return(this.widgetId?this.widgetId:this.id)+"/imageLoad"},showImage:function(t,e){!e&&this._slideId&&this.toggleSlideShow();var i=this,o=this.largeNode.getElementsByTagName("div");this.imageIndex=t;var s=function(){if(i.images[t]){for(;i.largeNode.firstChild;)i.largeNode.removeChild(i.largeNode.firstChild);i.images[t].style.opacity=0,i.largeNode.appendChild(i.images[t]),i._currentImage=i.images[t]._img,i._fitSize();var o=function(o,s,a){var n=i.images[t].firstChild;"img"!=n.tagName.toLowerCase()&&(n=n.firstChild),title=n.getAttribute("title"),i._navShowing&&i._showNav(!0),dojo.publish(i.getShowTopicName(),[{index:t,title:title,url:n.getAttribute("src")}]),e&&e(o,s,a),i._setTitle(title)};dojo.fadeIn({node:i.images[t],duration:300,onEnd:o}).play()}else i._loadImage(t,function(){dojo.publish(i.getLoadTopicName(),[t]),i.showImage(t,e)})};o&&o.length>0?dojo.fadeOut({node:o[0],duration:300,onEnd:function(){i.hiddenNode.appendChild(o[0]),s()}}).play():s()},_fitSize:function(t){if(!this.fixedHeight||t){var e=this._currentImage.height+(this.hasNav?20:0);return dojo.style(this.innerWrapper,"height",e+"px"),void 0}dojo.style(this.largeNode,"paddingTop",this._getTopPadding()+"px")},_getTopPadding:function(){return this.fixedHeight?(this.imageHeight-this._currentImage.height)/2:0},_loadNextImage:function(){if(this.autoLoad){for(;this.images.length>=this._imageCounter&&this.images[this._imageCounter];)this._imageCounter++;this._loadImage(this._imageCounter)}},_loadImage:function(t,e){if(!this.images[t]&&this._request){var i=t-t%this.pageSize;this._request.start=i,this._request.onComplete=function(e){var o=t-i;e&&e.length>o&&s(e[o])};var o=this,s=function(i){var s=o.imageStore.getValue(i,o.imageLargeAttr),a=document.createElement("img"),n=document.createElement("div");n._img=a;var h=o.imageStore.getValue(i,o.linkAttr);if(!h||o.noLink)n.appendChild(a);else{var d=document.createElement("a");d.setAttribute("href",h),d.setAttribute("target","_blank"),n.appendChild(d),d.appendChild(a)}n.setAttribute("id",o.id+"_imageDiv"+t),dojo.connect(a,"onload",function(){o._fitImage(a),n.setAttribute("width",o.imageWidth),n.setAttribute("height",o.imageHeight),dojo.publish(o.getLoadTopicName(),[t]),o._loadNextImage(),e&&e()}),o.hiddenNode.appendChild(n);var r=document.createElement("div");dojo.addClass(r,"slideShowTitle"),n.appendChild(r),o.images[t]=n,a.setAttribute("src",s);var l=o.imageStore.getValue(i,o.titleAttr);l&&a.setAttribute("title",l)};this.imageStore.fetch(this._request)}},_stop:function(){this._slideId&&clearTimeout(this._slideId),this._slideId=null,this._timerCancelled=!0,dojo.removeClass(this.domNode,"slideShowPaused")},_prev:function(){this.imageIndex<1||this.showImage(this.imageIndex-1)},_next:function(){this.showNextImage()},_startTimer:function(){this._slideId=setTimeout("dijit.byId('"+this.id+"').showNextImage(true);",1e3*this.slideshowInterval)},_calcNavDimensions:function(){dojo.style(this.navNode,"position","absolute"),dojo.style(this.navNode,"left","-10000px"),dojo._setOpacity(this.navNode,99),this.navPlay._size=dojo.marginBox(this.navPlay),this.navPrev._size=dojo.marginBox(this.navPrev),this.navNext._size=dojo.marginBox(this.navNext),dojo._setOpacity(this.navNode,0),dojo.style(this.navNode,"position",""),dojo.style(this.navNode,"left","")},_setTitle:function(t){this.titleNode.innerHTML=this.titleTemplate.replace("@title",t).replace("@current",String(Number(this.imageIndex)+1)).replace("@total",String(this.maxPhotos))},_fitImage:function(t){var e=t.width,i=t.height;e>this.imageWidth&&(i=Math.floor(i*(this.imageWidth/e)),t.setAttribute("height",i+"px"),t.setAttribute("width",this.imageWidth+"px")),i>this.imageHeight&&(e=Math.floor(e*(this.imageHeight/i)),t.setAttribute("height",this.imageHeight+"px"),t.setAttribute("width",e+"px"))},_handleClick:function(t){switch(t.target){case this.navNext:this._next();break;case this.navPrev:this._prev();break;case this.navPlay:this.toggleSlideShow()}},_showNav:function(t){if(!this._navShowing||t){dojo.style(this.navNode,"marginTop","0px"),dojo.style(this.navPlay,"marginLeft","0px");var e=(dojo.marginBox(this.outerNode),this._currentImage.height-this.navPlay._size.h-10+this._getTopPadding());e>this._currentImage.height&&(e+=10),dojo[this.imageIndex<1?"addClass":"removeClass"](this.navPrev,"slideShowCtrlHide"),dojo[this.imageIndex+1>=this.maxPhotos?"addClass":"removeClass"](this.navNext,"slideShowCtrlHide");var i=this;this._navAnim&&this._navAnim.stop(),this._navShowing||(this._navAnim=dojo.fadeIn({node:this.navNode,duration:300,onEnd:function(){i._navAnim=null}}),this._navAnim.play(),this._navShowing=!0)}},_hideNav:function(t){if(!t||!this._overElement(this.outerNode,t)){var e=this;this._navAnim&&this._navAnim.stop(),this._navAnim=dojo.fadeOut({node:this.navNode,duration:300,onEnd:function(){e._navAnim=null}}),this._navAnim.play(),this._navShowing=!1}},_overElement:function(t,e){if("undefined"==typeof dojo)return!1;t=dojo.byId(t);var i={x:e.pageX,y:e.pageY},o=dojo._getBorderBox(t),s=dojo.coords(t,!0),a=s.x;return i.x>=a&&i.x<=a+o.w&&i.y>=s.y&&i.y<=top+o.h}}));