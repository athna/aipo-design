dojo._xdResourceLoaded({depends:[["provide","dojox.image.ThumbnailPicker"],["require","dojo.fx"],["require","dijit._Widget"],["require","dijit._Templated"],["require","dojox.fx.scroll"],["require","dojox.fx.easing"]],defineResource:function(t){t._hasResource["dojox.image.ThumbnailPicker"]||(t._hasResource["dojox.image.ThumbnailPicker"]=!0,t.provide("dojox.image.ThumbnailPicker"),t.experimental("dojox.image.ThumbnailPicker"),t.require("dojo.fx"),t.require("dijit._Widget"),t.require("dijit._Templated"),t.declare("dojox.image.ThumbnailPicker",[dijit._Widget,dijit._Templated],{imageStore:null,request:null,size:500,thumbHeight:75,thumbWidth:100,useLoadNotifier:!1,useHyperlink:!1,hyperlinkTarget:"new",isClickable:!0,isScrollable:!0,isHorizontal:!0,autoLoad:!0,linkAttr:"link",imageThumbAttr:"imageUrlThumb",imageLargeAttr:"imageUrl",pageSize:20,titleAttr:"title",templateString:'<div dojoAttachPoint="outerNode" class="thumbOuter">\r\n	<div dojoAttachPoint="navPrev" class="thumbNav thumbClickable">\r\n	  <img src="" dojoAttachPoint="navPrevImg"/>    \r\n	</div>\r\n	<div dojoAttachPoint="thumbScroller" class="thumbScroller">\r\n	  <div dojoAttachPoint="thumbsNode" class="thumbWrapper"></div>\r\n	</div>\r\n	<div dojoAttachPoint="navNext" class="thumbNav thumbClickable">\r\n	  <img src="" dojoAttachPoint="navNextImg"/>  \r\n	</div>\r\n</div>\r\n',tempImgPath:t.moduleUrl("dojox.image","resources/images/1pixel.gif"),_thumbs:[],_thumbIndex:0,_maxPhotos:0,_loadedImages:{},postCreate:function(){this.widgetid=this.id,this.inherited("postCreate",arguments),this.pageSize=Number(this.pageSize),this._scrollerSize=this.size-102;var i=this._sizeProperty=this.isHorizontal?"width":"height";t.style(this.outerNode,"textAlign","center"),t.style(this.outerNode,i,this.size+"px"),t.style(this.thumbScroller,i,this._scrollerSize+"px"),this.useHyperlink&&t.subscribe(this.getClickTopicName(),this,function(t){var i=(t.index,this.imageStore.getValue(t.data,this.linkAttr));i&&("new"==this.hyperlinkTarget?window.open(i):window.location=i)}),this.isScrollable&&(t.require("dojox.fx.scroll"),t.require("dojox.fx.easing")),this.isClickable&&t.addClass(this.thumbsNode,"thumbClickable"),this._totalSize=0,this.init()},init:function(){if(this.isInitialized)return!1;var i=this.isHorizontal?"Horiz":"Vert";return t.addClass(this.navPrev,"prev"+i),t.addClass(this.navNext,"next"+i),t.addClass(this.thumbsNode,"thumb"+i),t.addClass(this.outerNode,"thumb"+i),this.navNextImg.setAttribute("src",this.tempImgPath),this.navPrevImg.setAttribute("src",this.tempImgPath),t.connect(this.navPrev,"onclick",this,"_prev"),t.connect(this.navNext,"onclick",this,"_next"),this.isInitialized=!0,this.isHorizontal?(this._offsetAttr="offsetLeft",this._sizeAttr="offsetWidth",this._scrollAttr="scrollLeft"):(this._offsetAttr="offsetTop",this._sizeAttr="offsetHeight",this._scrollAttr="scrollTop"),this._updateNavControls(),this.imageStore&&this.request&&this._loadNextPage(),!0},getClickTopicName:function(){return(this.widgetId?this.widgetId:this.id)+"/select"},getShowTopicName:function(){return(this.widgetId?this.widgetId:this.id)+"/show"},setDataStore:function(i,e,s){if(this.reset(),this.request={query:{},start:e.start?e.start:0,count:e.count?e.count:10,onBegin:t.hitch(this,function(t){this._maxPhotos=t})},e.query&&t.mixin(this.request.query,e.query),s&&s.imageThumbAttr)for(var o=["imageThumbAttr","imageLargeAttr","linkAttr","titleAttr"],h=0;h<o.length;h++)s[o[h]]&&(this[o[h]]=s[o[h]]);this.request.start=0,this.request.count=this.pageSize,this.imageStore=i,this.init()||this._loadNextPage()},reset:function(){this._loadedImages={};for(var t,i=0;i<this._thumbs.length;i++)t=this._thumbs[i],t&&t.parentNode&&t.parentNode.removeChild(t);this._thumbs=[],this.isInitialized=!1,this._noImages=!0},isVisible:function(t){var i=this._thumbs[t];if(!i)return!1;var e=this.isHorizontal?"offsetLeft":"offsetTop",s=this.isHorizontal?"offsetWidth":"offsetHeight",o=this.isHorizontal?"scrollLeft":"scrollTop",h=i[e]-this.thumbsNode[e];return h>=this.thumbScroller[o]&&h+i[s]<=this.thumbScroller[o]+this._scrollerSize},_next:function(){for(var t,i=this.isHorizontal?"offsetLeft":"offsetTop",e=this.isHorizontal?"offsetWidth":"offsetHeight",s=this.thumbsNode[i],o=this._thumbs[this._thumbIndex],h=o[i]-s,r=this._thumbIndex+1;r<this._thumbs.length;r++)if(t=this._thumbs[r],t[i]-s+t[e]-h>this._scrollerSize)return this._showThumbs(r),void 0},_prev:function(){if(0!=this.thumbScroller[this.isHorizontal?"scrollLeft":"scrollTop"]){for(var t,i=this.isHorizontal?"offsetLeft":"offsetTop",e=(this.isHorizontal?"offsetWidth":"offsetHeight",this._thumbs[this._thumbIndex]),s=e[i]-this.thumbsNode[i],o=this._thumbIndex-1;o>-1;o--)if(t=this._thumbs[o],s-t[i]>this._scrollerSize)return this._showThumbs(o+1),void 0;this._showThumbs(0)}},_checkLoad:function(i,e){t.publish(this.getShowTopicName(),[{index:e}]),this._updateNavControls(),this._loadingImages={},this._thumbIndex=e,this.thumbsNode.offsetWidth-i.offsetLeft<2*this._scrollerSize&&this._loadNextPage()},_showThumbs:function(i){var i=0==arguments.length?this._thumbIndex:arguments[0];if(i=Math.min(Math.max(i,0),this._maxPhotos),!(i>=this._maxPhotos)){var e=this._thumbs[i];if(e){var s=e.offsetLeft-this.thumbsNode.offsetLeft,o=e.offsetTop-this.thumbsNode.offsetTop,h=this.isHorizontal?s:o;if(!(h>=this.thumbScroller[this._scrollAttr]&&h+e[this._sizeAttr]<=this.thumbScroller[this._scrollAttr]+this._scrollerSize))if(this.isScrollable){var r=this.isHorizontal?{x:s,y:0}:{x:0,y:o};dojox.fx.smoothScroll({target:r,win:this.thumbScroller,duration:300,easing:dojox.fx.easing.easeOut,onEnd:t.hitch(this,"_checkLoad",e,i)}).play(10)}else this.isHorizontal?this.thumbScroller.scrollLeft=s:this.thumbScroller.scrollTop=o,this._checkLoad(e,i)}}},markImageLoaded:function(i){var e=t.byId("loadingDiv_"+this.widgetid+"_"+i);e&&this._setThumbClass(e,"thumbLoaded"),this._loadedImages[i]=!0},_setThumbClass:function(i,e){this.autoLoad&&t.addClass(i,e)},_loadNextPage:function(){if(!this._loadInProgress){this._loadInProgress=!0;for(var t=this.request.start+(1==this._noImages?0:this.pageSize),i=t;i<this._thumbs.length&&this._thumbs[i];)i++;var e=this,s=function(t){if(t&&t.length){var s=0,o=function(){if(s>=t.length)return e._loadInProgress=!1,void 0;var h=s++;e._loadImage(t[h],i+h,o)};o(),e._updateNavControls()}else e._loadInProgress=!1},o=function(){e._loadInProgress=!1,console.debug("Error getting items")};this.request.onComplete=s,this.request.onError=o,this.request.start=t,this._noImages=!1,this.imageStore.fetch(this.request)}},_loadImage:function(i,e,s){var o=this.imageStore.getValue(i,this.imageThumbAttr),h=document.createElement("img"),r=document.createElement("div");r.setAttribute("id","img_"+this.widgetid+"_"+e),r.appendChild(h),h._index=e,h._data=i,this._thumbs[e]=r;var a;this.useLoadNotifier&&(a=document.createElement("div"),a.setAttribute("id","loadingDiv_"+this.widgetid+"_"+e),this._setThumbClass(a,this._loadedImages[e]?"thumbLoaded":"thumbNotifier"),r.appendChild(a));var l,n,u=t.marginBox(this.thumbsNode);this.isHorizontal?(l=this.thumbWidth,n="w"):(l=this.thumbHeight,n="h"),u=u[n];var d=this.thumbScroller.scrollLeft,m=this.thumbScroller.scrollTop;t.style(this.thumbsNode,this._sizeProperty,u+l+20+"px"),this.thumbScroller.scrollLeft=d,this.thumbScroller.scrollTop=m,this.thumbsNode.appendChild(r),t.connect(h,"onload",this,function(){var i=t.marginBox(h)[n];return this._totalSize+=Number(i)+4,t.style(this.thumbsNode,this._sizeProperty,this._totalSize+"px"),this.useLoadNotifier&&t.style(a,"width",h.width-4+"px"),s(),!1}),t.connect(h,"onclick",this,function(e){return t.publish(this.getClickTopicName(),[{index:e.target._index,data:e.target._data,url:h.getAttribute("src"),largeUrl:this.imageStore.getValue(i,this.imageLargeAttr),title:this.imageStore.getValue(i,this.titleAttr),link:this.imageStore.getValue(i,this.linkAttr)}]),!1}),t.addClass(h,"imageGalleryThumb"),h.setAttribute("src",o);var c=this.imageStore.getValue(i,this.titleAttr);c&&h.setAttribute("title",c),this._updateNavControls()},_updateNavControls:function(){var i=function(i,e){var s=e?"addClass":"removeClass";t[s](i,"enabled"),t[s](i,"thumbClickable")},e=this.isHorizontal?"scrollLeft":"scrollTop",s=this.isHorizontal?"offsetWidth":"offsetHeight";i(this.navPrev,this.thumbScroller[e]>0);var o=(this._thumbs[this._thumbs.length-1],this.thumbScroller[e]+this._scrollerSize<this.thumbsNode[s]);i(this.navNext,o)}}))}});