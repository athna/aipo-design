dojo._hasResource["dojox.charting.axis2d.Default"]||(dojo._hasResource["dojox.charting.axis2d.Default"]=!0,dojo.provide("dojox.charting.axis2d.Default"),dojo.require("dojox.charting.scaler"),dojo.require("dojox.charting.axis2d.common"),dojo.require("dojox.charting.axis2d.Base"),dojo.require("dojo.colors"),dojo.require("dojox.gfx"),dojo.require("dojox.lang.functional"),dojo.require("dojox.lang.utils"),function(){var t=dojox.charting,i=dojox.lang.functional,o=dojox.lang.utils,e=dojox.gfx,r=4,a=.8,s=function(t,i){return Math.abs(t-i)<=1e-6*(Math.abs(t)+Math.abs(i))};dojo.declare("dojox.charting.axis2d.Default",dojox.charting.axis2d.Base,{defaultParams:{vertical:!1,fixUpper:"none",fixLower:"none",natural:!1,leftBottom:!0,includeZero:!1,fixed:!0,majorLabels:!0,minorTicks:!0,minorLabels:!0,microTicks:!1,htmlLabels:!0},optionalParams:{min:0,max:1,majorTickStep:4,minorTickStep:2,microTickStep:1,labels:[],stroke:{},majorTick:{},minorTick:{},font:"",fontColor:""},constructor:function(t,i){this.opt=dojo.clone(this.defaultParams),o.updateWithObject(this.opt,i),o.updateWithPattern(this.opt,i,this.optionalParams)},dependOnData:function(){return!("min"in this.opt&&"max"in this.opt)},clear:function(){return delete this.scaler,this.dirty=!0,this},initialized:function(){return"scaler"in this},calculate:function(t,o,s,n){if(this.initialized())return this;this.labels="labels"in this.opt?this.opt.labels:n,"min"in this.opt&&(t=this.opt.min),"max"in this.opt&&(o=this.opt.max),this.opt.includeZero&&(t>0&&(t=0),0>o&&(o=0));var h=0,l=this.chart.theme.axis,c="font"in this.opt?this.opt.font:l.font,m=c?e.normalizedLength(e.splitFontString(c).size):0;if(this.vertical)m&&(h=m+r);else if(m){var p=Math.ceil(Math.log(Math.max(Math.abs(t),Math.abs(o)))/Math.LN10);(0>t||0>o)&&++p;var x=Math.floor(Math.log(o-t)/Math.LN10);x>0&&(p+=x),this.labels&&(p=i.foldl(i.map(this.labels,"x.text.length"),"Math.max(a, b)",p)),h=Math.floor(m*p*a)+r}var f={fixUpper:this.opt.fixUpper,fixLower:this.opt.fixLower,natural:this.opt.natural};return"majorTickStep"in this.opt&&(f.majorTick=this.opt.majorTickStep),"minorTickStep"in this.opt&&(f.minorTick=this.opt.minorTickStep),"microTickStep"in this.opt&&(f.microTick=this.opt.microTickStep),this.scaler=dojox.charting.scaler(t,o,s,f),this.scaler.minMinorStep=h,this},getScaler:function(){return this.scaler},getOffsets:function(){var t={l:0,r:0,t:0,b:0},o=0,s=this.chart.theme.axis,n="font"in this.opt?this.opt.font:s.font,h="majorTick"in this.opt?this.opt.majorTick:s.majorTick,l="minorTick"in this.opt?this.opt.minorTick:s.minorTick,c=n?e.normalizedLength(e.splitFontString(n).size):0;if(this.vertical){if(c){var m=this.scaler,p=this._getLabel(m.major.start,m.major.prec).length,x=this._getLabel(m.major.start+m.major.count*m.major.tick,m.major.prec).length,f=this._getLabel(m.minor.start,m.minor.prec).length,d=this._getLabel(m.minor.start+m.minor.count*m.minor.tick,m.minor.prec).length,g=Math.max(p,x,f,d);this.labels&&(g=i.foldl(i.map(this.labels,"x.text.length"),"Math.max(a, b)",g)),o=Math.floor(c*g*a)+r}o+=r+Math.max(h.length,l.length),t[this.opt.leftBottom?"l":"r"]=o,t.t=t.b=c/2}else if(c&&(o=c+r),o+=r+Math.max(h.length,l.length),t[this.opt.leftBottom?"b":"t"]=o,c){var m=this.scaler,p=this._getLabel(m.major.start,m.major.prec).length,x=this._getLabel(m.major.start+m.major.count*m.major.tick,m.major.prec).length,f=this._getLabel(m.minor.start,m.minor.prec).length,d=this._getLabel(m.minor.start+m.minor.count*m.minor.tick,m.minor.prec).length,g=Math.max(p,x,f,d);this.labels&&(g=i.foldl(i.map(this.labels,"x.text.length"),"Math.max(a, b)",g)),t.l=t.r=Math.floor(c*g*a)/2}return t},render:function(i,o){if(!this.dirty)return this;var a,s,n,h,l,c,m=this.chart.theme.axis,p="stroke"in this.opt?this.opt.stroke:m.stroke,x="majorTick"in this.opt?this.opt.majorTick:m.majorTick,f="minorTick"in this.opt?this.opt.minorTick:m.minorTick,d="font"in this.opt?this.opt.font:m.font,g="fontColor"in this.opt?this.opt.fontColor:m.fontColor,u=Math.max(x.length,f.length),j=d?e.normalizedLength(e.splitFontString(d).size):0;this.vertical?(a={y:i.height-o.b},s={y:o.t},n={x:0,y:-1},this.opt.leftBottom?(a.x=s.x=o.l,h={x:-1,y:0},c="end"):(a.x=s.x=i.width-o.r,h={x:1,y:0},c="start"),l={x:h.x*(u+r),y:.4*j}):(a={x:o.l},s={x:i.width-o.r},n={x:1,y:0},c="middle",this.opt.leftBottom?(a.y=s.y=i.height-o.b,h={x:0,y:1},l={y:u+r+j}):(a.y=s.y=o.t,h={x:0,y:-1},l={y:-u-r}),l.x=0),this.cleanGroup();var k,b,y=this.group,T=this.scaler,L=T.major.start,M=T.minor.start,v=T.micro.start;if(y.createLine({x1:a.x,y1:a.y,x2:s.x,y2:s.y}).setStroke(p),this.opt.microTicks&&T.micro.tick)k=T.micro.tick,b=v;else if(this.opt.minorTicks&&T.minor.tick)k=T.minor.tick,b=M;else{if(!T.major.tick)return this;k=T.major.tick,b=L}for(;b<=T.bounds.upper+1/T.scale;){var S=(b-T.bounds.lower)*T.scale,_=a.x+n.x*S,z=a.y+n.y*S;if(Math.abs(L-b)<k/2){if(y.createLine({x1:_,y1:z,x2:_+h.x*x.length,y2:z+h.y*x.length}).setStroke(x),this.opt.majorLabels){var q=t.axis2d.common.createText[this.opt.htmlLabels?"html":"gfx"](this.chart,y,_+l.x,z+l.y,c,this._getLabel(L,T.major.prec),d,g);this.opt.htmlLabels&&this.htmlElements.push(q)}L+=T.major.tick,M+=T.minor.tick,v+=T.micro.tick}else if(Math.abs(M-b)<k/2){if(this.opt.minorTicks&&(y.createLine({x1:_,y1:z,x2:_+h.x*f.length,y2:z+h.y*f.length}).setStroke(f),this.opt.minorLabels&&T.minMinorStep<=T.minor.tick*T.scale)){var q=t.axis2d.common.createText[this.opt.htmlLabels?"html":"gfx"](this.chart,y,_+l.x,z+l.y,c,this._getLabel(M,T.minor.prec),d,g);this.opt.htmlLabels&&this.htmlElements.push(q)}M+=T.minor.tick,v+=T.micro.tick}else this.opt.microTicks&&y.createLine({x1:_,y1:z,x2:_+h.x*f.length,y2:z+h.y*f.length}).setStroke(f),v+=T.micro.tick;b+=k}return this.dirty=!1,this},_getLabel:function(t,i){if(this.opt.labels){for(var o=this.opt.labels,e=0,r=o.length;r>e;){var a=Math.floor((e+r)/2),n=o[a].value;t>n?e=a+1:r=a}if(e<o.length&&s(o[e].value,t))return o[e].text;if(--e,e<o.length&&s(o[e].value,t))return o[e].text;if(e+=2,e<o.length&&s(o[e].value,t))return o[e].text}return this.opt.fixed?t.toFixed(0>i?-i:0):t.toString()}})}());