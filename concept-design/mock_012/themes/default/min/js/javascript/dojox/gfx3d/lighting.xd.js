dojo._xdResourceLoaded({depends:[["provide","dojox.gfx3d.lighting"],["require","dojox.gfx._base"]],defineResource:function(o){o._hasResource["dojox.gfx3d.lighting"]||(o._hasResource["dojox.gfx3d.lighting"]=!0,o.provide("dojox.gfx3d.lighting"),o.require("dojox.gfx._base"),function(){var r=dojox.gfx3d.lighting;o.mixin(dojox.gfx3d.lighting,{black:function(){return{r:0,g:0,b:0,a:1}},white:function(){return{r:1,g:1,b:1,a:1}},toStdColor:function(o){return o=dojox.gfx.normalizeColor(o),{r:o.r/255,g:o.g/255,b:o.b/255,a:o.a}},fromStdColor:function(r){return new o.Color([Math.round(255*r.r),Math.round(255*r.g),Math.round(255*r.b),r.a])},scaleColor:function(o,r){return{r:o*r.r,g:o*r.g,b:o*r.b,a:o*r.a}},addColor:function(o,r){return{r:o.r+r.r,g:o.g+r.g,b:o.b+r.b,a:o.a+r.a}},multiplyColor:function(o,r){return{r:o.r*r.r,g:o.g*r.g,b:o.b*r.b,a:o.a*r.a}},saturateColor:function(o){return{r:o.r<0?0:o.r>1?1:o.r,g:o.g<0?0:o.g>1?1:o.g,b:o.b<0?0:o.b>1?1:o.b,a:o.a<0?0:o.a>1?1:o.a}},mixColor:function(o,t,a){return r.addColor(r.scaleColor(a,o),r.scaleColor(1-a,t))},diff2Color:function(o,r){var t=o.r-r.r,a=o.g-r.g,n=o.b-r.b,i=o.a-r.a;return t*t+a*a+n*n+i*i},length2Color:function(o){return o.r*o.r+o.g*o.g+o.b*o.b+o.a*o.a},dot:function(o,r){return o.x*r.x+o.y*r.y+o.z*r.z},scale:function(o,r){return{x:o*r.x,y:o*r.y,z:o*r.z}},add:function(o,r){return{x:o.x+r.x,y:o.y+r.y,z:o.z+r.z}},saturate:function(o){return Math.min(Math.max(o,0),1)},length:function(o){return Math.sqrt(dojox.gfx3d.lighting.dot(o,o))},normalize:function(o){return r.scale(1/r.length(o),o)},faceforward:function(o,r){var t=dojox.gfx3d.lighting,a=t.dot(r,o)<0?1:-1;return t.scale(a,o)},reflect:function(o,r){var t=dojox.gfx3d.lighting;return t.add(o,t.scale(-2*t.dot(o,r),r))},diffuse:function(o,t){for(var a=r.black(),n=0;n<t.length;++n){var i=t[n],l=r.dot(r.normalize(i.direction),o);a=r.addColor(a,r.scaleColor(l,i.color))}return r.saturateColor(a)},specular:function(o,t,a,n){for(var i=r.black(),l=0;l<n.length;++l){var e=n[l],s=r.normalize(r.add(r.normalize(e.direction),t)),d=Math.pow(Math.max(0,r.dot(o,s)),1/a);i=r.addColor(i,r.scaleColor(d,e.color))}return r.saturateColor(i)},phong:function(o,t,a,n){o=r.normalize(o);for(var i=r.black(),l=0;l<n.length;++l){var e=n[l],s=r.reflect(r.scale(-1,r.normalize(t)),o),d=Math.pow(Math.max(0,r.dot(s,r.normalize(e.direction))),a);i=r.addColor(i,r.scaleColor(d,e.color))}return r.saturateColor(i)}}),o.declare("dojox.gfx3d.lighting.Model",null,{constructor:function(o,t,a,n){this.incident=r.normalize(o),this.lights=[];for(var i=0;i<t.length;++i){var l=t[i];this.lights.push({direction:r.normalize(l.direction),color:r.toStdColor(l.color)})}this.ambient=r.toStdColor(a.color?a.color:"white"),this.ambient=r.scaleColor(a.intensity,this.ambient),this.ambient=r.scaleColor(this.ambient.a,this.ambient),this.ambient.a=1,this.specular=r.toStdColor(n?n:"white"),this.specular=r.scaleColor(this.specular.a,this.specular),this.specular.a=1,this.npr_cool={r:0,g:0,b:.4,a:1},this.npr_warm={r:.4,g:.4,b:.2,a:1},this.npr_alpha=.2,this.npr_beta=.6,this.npr_scale=.6},constant:function(o,t,a){a=r.toStdColor(a);var n=a.a,i=r.scaleColor(n,a);return i.a=n,r.fromStdColor(r.saturateColor(i))},matte:function(o,t,a){"string"==typeof t&&(t=r.finish[t]),a=r.toStdColor(a),o=r.faceforward(r.normalize(o),this.incident);var n=r.scaleColor(t.Ka,this.ambient),i=r.saturate(-4*r.dot(o,this.incident)),l=r.scaleColor(i*t.Kd,r.diffuse(o,this.lights)),e=r.scaleColor(a.a,r.multiplyColor(a,r.addColor(n,l)));return e.a=a.a,r.fromStdColor(r.saturateColor(e))},metal:function(o,t,a){"string"==typeof t&&(t=r.finish[t]),a=r.toStdColor(a),o=r.faceforward(r.normalize(o),this.incident);var n,i,l=r.scale(-1,this.incident),e=r.scaleColor(t.Ka,this.ambient),s=r.saturate(-4*r.dot(o,this.incident));return n="phong"in t?r.scaleColor(s*t.Ks*t.phong,r.phong(o,l,t.phong_size,this.lights)):r.scaleColor(s*t.Ks,r.specular(o,l,t.roughness,this.lights)),i=r.scaleColor(a.a,r.addColor(r.multiplyColor(a,e),r.multiplyColor(this.specular,n))),i.a=a.a,r.fromStdColor(r.saturateColor(i))},plastic:function(o,t,a){"string"==typeof t&&(t=r.finish[t]),a=r.toStdColor(a),o=r.faceforward(r.normalize(o),this.incident);var n,i,l=r.scale(-1,this.incident),e=r.scaleColor(t.Ka,this.ambient),s=r.saturate(-4*r.dot(o,this.incident)),d=r.scaleColor(s*t.Kd,r.diffuse(o,this.lights));return n="phong"in t?r.scaleColor(s*t.Ks*t.phong,r.phong(o,l,t.phong_size,this.lights)):r.scaleColor(s*t.Ks,r.specular(o,l,t.roughness,this.lights)),i=r.scaleColor(a.a,r.addColor(r.multiplyColor(a,r.addColor(e,d)),r.multiplyColor(this.specular,n))),i.a=a.a,r.fromStdColor(r.saturateColor(i))},npr:function(o,t,a){"string"==typeof t&&(t=r.finish[t]),a=r.toStdColor(a),o=r.faceforward(r.normalize(o),this.incident);var n=r.scaleColor(t.Ka,this.ambient),i=r.saturate(-4*r.dot(o,this.incident)),l=r.scaleColor(i*t.Kd,r.diffuse(o,this.lights)),e=r.scaleColor(a.a,r.multiplyColor(a,r.addColor(n,l))),s=r.addColor(this.npr_cool,r.scaleColor(this.npr_alpha,e)),d=r.addColor(this.npr_warm,r.scaleColor(this.npr_beta,e)),h=(1+r.dot(this.incident,o))/2,e=r.scaleColor(this.npr_scale,r.addColor(e,r.mixColor(s,d,h)));return e.a=a.a,r.fromStdColor(r.saturateColor(e))}})}(),dojox.gfx3d.lighting.finish={defaults:{Ka:.1,Kd:.6,Ks:0,roughness:.05},dull:{Ka:.1,Kd:.6,Ks:.5,roughness:.15},shiny:{Ka:.1,Kd:.6,Ks:1,roughness:.001},glossy:{Ka:.1,Kd:.6,Ks:1,roughness:1e-4},phong_dull:{Ka:.1,Kd:.6,Ks:.5,phong:.5,phong_size:1},phong_shiny:{Ka:.1,Kd:.6,Ks:1,phong:1,phong_size:200},phong_glossy:{Ka:.1,Kd:.6,Ks:1,phong:1,phong_size:300},luminous:{Ka:1,Kd:0,Ks:0,roughness:.05},metalA:{Ka:.35,Kd:.3,Ks:.8,roughness:.05},metalB:{Ka:.3,Kd:.4,Ks:.7,roughness:1/60},metalC:{Ka:.25,Kd:.5,Ks:.8,roughness:1/80},metalD:{Ka:.15,Kd:.6,Ks:.8,roughness:.01},metalE:{Ka:.1,Kd:.7,Ks:.8,roughness:1/120}})}});