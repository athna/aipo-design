dojo._xdResourceLoaded({depends:[["provide","dojox.grid._grid.focus"]],defineResource:function(t){t._hasResource["dojox.grid._grid.focus"]||(t._hasResource["dojox.grid._grid.focus"]=!0,t.provide("dojox.grid._grid.focus"),t.declare("dojox.grid.focus",null,{constructor:function(i){this.grid=i,this.cell=null,this.rowIndex=-1,t.connect(this.grid.domNode,"onfocus",this,"doFocus")},tabbingOut:!1,focusClass:"dojoxGrid-cell-focus",focusView:null,initFocusView:function(){this.focusView=this.grid.views.getFirstScrollingView()},isFocusCell:function(t,i){return this.cell==t&&this.rowIndex==i},isLastFocusCell:function(){return this.rowIndex==this.grid.rowCount-1&&this.cell.index==this.grid.layout.cellCount-1},isFirstFocusCell:function(){return 0==this.rowIndex&&0==this.cell.index},isNoFocusCell:function(){return this.rowIndex<0||!this.cell},_focusifyCellNode:function(i){var s=this.cell&&this.cell.getNode(this.rowIndex);if(s){t.toggleClass(s,this.focusClass,i),this.scrollIntoView();try{this.grid.edit.isEditing()||dojox.grid.fire(s,"focus")}catch(o){}}},scrollIntoView:function(){if(this.cell){var t=this.cell,i=t.view.scrollboxNode,s={w:i.clientWidth,l:i.scrollLeft,t:i.scrollTop,h:i.clientHeight},o=t.getNode(this.rowIndex),e=t.view.getRowNode(this.rowIndex),l=this.grid.scroller.findScrollTop(this.rowIndex);o.offsetLeft+o.offsetWidth>s.l+s.w?i.scrollLeft=o.offsetLeft+o.offsetWidth-s.w:o.offsetLeft<s.l&&(i.scrollLeft=o.offsetLeft),l+e.offsetHeight>s.t+s.h?this.grid.setScrollTop(l+e.offsetHeight-s.h):l<s.t&&this.grid.setScrollTop(l)}},styleRow:function(t){t.index==this.rowIndex&&this._focusifyCellNode(!0)},setFocusIndex:function(t,i){this.setFocusCell(this.grid.getCell(i),t)},setFocusCell:function(i,s){i&&!this.isFocusCell(i,s)&&(this.tabbingOut=!1,this.focusGrid(),this._focusifyCellNode(!1),this.cell=i,this.rowIndex=s,this._focusifyCellNode(!0)),t.isOpera?setTimeout(t.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1):this.grid.onCellFocus(this.cell,this.rowIndex)},next:function(){var t=this.rowIndex,i=this.cell.index+1,s=this.grid.layout.cellCount-1,o=this.grid.rowCount-1;i>s&&(i=0,t++),t>o&&(i=s,t=o),this.setFocusIndex(t,i)},previous:function(){var t=this.rowIndex||0,i=(this.cell.index||0)-1;0>i&&(i=this.grid.layout.cellCount-1,t--),0>t&&(t=0,i=0),this.setFocusIndex(t,i)},move:function(t,i){var s=this.grid.rowCount-1,o=this.grid.layout.cellCount-1,e=this.rowIndex,l=this.cell.index,c=Math.min(s,Math.max(0,e+t)),n=Math.min(o,Math.max(0,l+i));this.setFocusIndex(c,n),t&&this.grid.updateRow(e)},previousKey:function(i){this.isFirstFocusCell()?this.tabOut(this.grid.domNode):(t.stopEvent(i),this.previous())},nextKey:function(i){this.isLastFocusCell()?this.tabOut(this.grid.lastFocusNode):(t.stopEvent(i),this.next())},tabOut:function(t){this.tabbingOut=!0,t.focus()},focusGrid:function(){dojox.grid.fire(this.focusView,"focus"),this._focusifyCellNode(!0)},doFocus:function(t){t&&t.target!=t.currentTarget||(!this.tabbingOut&&this.isNoFocusCell()&&this.setFocusIndex(0,0),this.tabbingOut=!1)}}))}});