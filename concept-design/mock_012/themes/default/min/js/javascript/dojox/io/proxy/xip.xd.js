dojo._xdResourceLoaded({depends:[["provide","dojox.io.proxy.xip"],["require","dojo.io.iframe"],["require","dojox.data.dom"]],defineResource:function(e){e._hasResource["dojox.io.proxy.xip"]||(e._hasResource["dojox.io.proxy.xip"]=!0,e.provide("dojox.io.proxy.xip"),e.require("dojo.io.iframe"),e.require("dojox.data.dom"),dojox.io.proxy.xip={xipClientUrl:djConfig.xipClientUrl||e.moduleUrl("dojox.io.proxy","xip_client.html"),_state:{},_stateIdCounter:0,needFrameRecursion:function(){return e.isIE>=7},send:function(t){var r="XhrIframeProxy"+this._stateIdCounter++;t._stateId=r;var o=this.xipClientUrl+"#0:init:id="+r+"&server="+encodeURIComponent(t._ifpServerUrl)+"&fr=false";if(this.needFrameRecursion()){var s=window.location.href.split("#")[0].split("?")[0];if("/"==(this.xipClientUrl+"").charAt(0)){var i=s.indexOf("://");i=s.indexOf("/",i+3),s=s.substring(0,i)}else s=s.substring(0,s.lastIndexOf("/")+1);s+=this.xipClientUrl;var a=t._ifpServerUrl+(-1==t._ifpServerUrl.indexOf("?")?"?":"&")+"dojo.fr=1";o=a+"#0:init:id="+r+"&client="+encodeURIComponent(s)+"&fr="+this.needFrameRecursion()}return this._state[r]={facade:t,stateId:r,clientFrame:e.io.iframe.create(r,"",o)},r},receive:function(e,t){for(var r={},o=t.split("&"),s=0;s<o.length;s++)if(o[s]){var i=o[s].split("=");r[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}var a=this._state[e],n=a.facade;if(n._setResponseHeaders(r.responseHeaders),(0==r.status||r.status)&&(n.status=parseInt(r.status,10)),r.statusText&&(n.statusText=r.statusText),r.responseText){n.responseText=r.responseText;var d=n.getResponseHeader("Content-Type");!d||"application/xml"!=d&&"text/xml"!=d||(n.responseXML=dojox.data.dom.createDocument(r.responseText,d))}n.readyState=4,this.destroyState(e)},clientFrameLoaded:function(t){var r=this._state[t],o=r.facade;if(this.needFrameRecursion())var s=window.open("",r.stateId+"_clientEndPoint");else var s=r.clientFrame.contentWindow;var i=[];for(var a in o._requestHeaders)i.push(a+": "+o._requestHeaders[a]);var n={uri:o._uri};i.length>0&&(n.requestHeaders=i.join("\r\n")),o._method&&(n.method=o._method),o._bodyData&&(n.data=o._bodyData),s.send(e.objectToQuery(n))},destroyState:function(e){var t=this._state[e];if(t){delete this._state[e];var r=t.clientFrame.parentNode;r.removeChild(t.clientFrame),t.clientFrame=null,t=null}},createFacade:function(){return arguments&&arguments[0]&&arguments[0].iframeProxyUrl?new dojox.io.proxy.xip.XhrIframeFacade(arguments[0].iframeProxyUrl):dojox.io.proxy.xip._xhrObjOld.apply(e,arguments)}},dojox.io.proxy.xip._xhrObjOld=e._xhrObj,e._xhrObj=dojox.io.proxy.xip.createFacade,dojox.io.proxy.xip.XhrIframeFacade=function(e){this._requestHeaders={},this._allResponseHeaders=null,this._responseHeaders={},this._method=null,this._uri=null,this._bodyData=null,this.responseText=null,this.responseXML=null,this.status=null,this.statusText=null,this.readyState=0,this._ifpServerUrl=e,this._stateId=null},e.extend(dojox.io.proxy.xip.XhrIframeFacade,{open:function(e,t){this._method=e,this._uri=t,this.readyState=1},setRequestHeader:function(e,t){this._requestHeaders[e]=t},send:function(e){this._bodyData=e,this._stateId=dojox.io.proxy.xip.send(this),this.readyState=2},abort:function(){dojox.io.proxy.xip.destroyState(this._stateId)},getAllResponseHeaders:function(){return this._allResponseHeaders},getResponseHeader:function(e){return this._responseHeaders[e]},_setResponseHeaders:function(e){if(e){this._allResponseHeaders=e,e=e.replace(/\r/g,"");for(var t=e.split("\n"),r=0;r<t.length;r++)if(t[r]){var o=t[r].split(": ");this._responseHeaders[o[0]]=o[1]}}}}))}});