dojo._xdResourceLoaded({depends:[["provide","dijit._editor.range"]],defineResource:function(e){e._hasResource["dijit._editor.range"]||(e._hasResource["dijit._editor.range"]=!0,e.provide("dijit._editor.range"),dijit.range={},dijit.range.getIndex=function(t,n){for(var i=[],r=[],o=n,a=t;t!=o;){for(var s,d=0,l=t.parentNode;s=l.childNodes[d++];)if(s===t){--d;break}d>=l.childNodes.length&&e.debug("Error finding index of a node in dijit.range.getIndex"),i.unshift(d),r.unshift(d-l.childNodes.length),t=l}if(i.length>0&&3==a.nodeType){for(var s=a.previousSibling;s&&3==s.nodeType;)i[i.length-1]--,s=s.previousSibling;for(s=a.nextSibling;s&&3==s.nodeType;)r[r.length-1]++,s=s.nextSibling}return{o:i,r:r}},dijit.range.getNode=function(t,n){if(!e.isArray(t)||0==t.length)return n;var i=n;return e.every(t,function(e){return e>=0&&e<i.childNodes.length?(i=i.childNodes[e],!0):(i=null,console.debug("Error: can not find node with index",t,"under parent node",n),!1)}),i},dijit.range.getCommonAncestor=function(e,t,n){for(var i=function(e,t){for(var n=[];e&&(n.unshift(e),e!=t&&"BODY"!=e.tagName);)e=e.parentNode;return n},r=i(e,n),o=i(t,n),a=Math.min(r.length,o.length),s=r[0],d=1;a>d&&r[d]===o[d];d++)s=r[d];return s},dijit.range.getAncestor=function(e,t,n){for(n=n||e.ownerDocument.body;e&&e!==n;){var i=e.nodeName.toUpperCase();if(t.test(i))return e;e=e.parentNode}return null},dijit.range.BlockTagNames=/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,dijit.range.getBlockAncestor=function(e,t,n){n=n||e.ownerDocument.body,t=t||dijit.range.BlockTagNames;for(var i,r=null;e&&e!==n;){var o=e.nodeName.toUpperCase();!r&&t.test(o)&&(r=e),!i&&/^(?:BODY|TD|TH|CAPTION)$/.test(o)&&(i=e),e=e.parentNode}return{blockNode:r,blockContainer:i||e.ownerDocument.body}},dijit.range.atBeginningOfContainer=function(t,n,i){var r=!1,o=0==i;if(o||3!=n.nodeType||0==e.trim(n.nodeValue.substr(0,i))&&(o=!0),o){var a=n;for(r=!0;a&&a!==t;){if(a.previousSibling){r=!1;break}a=a.parentNode}}return r},dijit.range.atEndOfContainer=function(t,n,i){var r=!1,o=i==(n.length||n.childNodes.length);if(o||3!=n.nodeType||0==e.trim(n.nodeValue.substr(i))&&(o=!0),o){var a=n;for(r=!0;a&&a!==t;){if(a.nextSibling){r=!1;break}a=a.parentNode}}return r},dijit.range.adjacentNoneTextNode=function(e,t){for(var n=e,i=0-e.length||0,r=t?"nextSibling":"previousSibling";n&&3==n.nodeType;)i+=n.length,n=n[r];return[n,i]},dijit.range._w3c=Boolean(window.getSelection),dijit.range.create=function(){return dijit.range._w3c?document.createRange():new dijit.range.W3CRange},dijit.range.getSelection=function(e,t){if(dijit.range._w3c)return e.getSelection();var n=e.__W3CRange;if(n&&dijit.range.ie.cachedSelection[n])var i=dijit.range.ie.cachedSelection[n];else{var i=new dijit.range.ie.selection(e);for(n=(new Date).getTime();n in dijit.range.ie.cachedSelection;)n+=1;n=String(n),dijit.range.ie.cachedSelection[n]=i}return t||i._getCurrentSelection(),i},dijit.range._w3c||(dijit.range.ie={cachedSelection:{},selection:function(e){this._ranges=[],this.addRange=function(e,t){this._ranges.push(e),t||e._select(),this.rangeCount=this._ranges.length},this.removeAllRanges=function(){this._ranges=[],this.rangeCount=0};var t=function(){var t=e.document.selection.createRange(),n=e.document.selection.type.toUpperCase();return"CONTROL"==n?new dijit.range.W3CRange(dijit.range.ie.decomposeControlRange(t)):new dijit.range.W3CRange(dijit.range.ie.decomposeTextRange(t))};this.getRangeAt=function(e){return this._ranges[e]},this._getCurrentSelection=function(){this.removeAllRanges();var e=t();e&&this.addRange(e,!0)}},decomposeControlRange:function(e){var t=e.item(0),n=e.item(e.length-1),i=t.parentNode,r=n.parentNode,o=dijit.range.getIndex(t,i).o,a=dijit.range.getIndex(n,r).o+1;return[[i,o],[r,a]]},getEndPoint:function(t,n){var i=t.duplicate();i.collapse(!n);var r,o,a,s="EndTo"+(n?"End":"Start"),d=i.parentElement();return d.childNodes.length>0?e.every(d.childNodes,function(e,n){var l;if(3!=e.nodeType){if(i.moveToElementText(e),i.compareEndPoints(s,t)>0){if(r=e.previousSibling,!a||3!=a.nodeType)return r=d,o=n,!1;r=a,l=!0}else if(n==d.childNodes.length-1)return r=d,o=d.childNodes.length,!1}else n==d.childNodes.length-1&&(r=e,l=!0);if(l&&r){var c=dijit.range.adjacentNoneTextNode(r)[0];r=c?c.nextSibling:d.firstChild;var g=dijit.range.adjacentNoneTextNode(r);c=g[0];var h=g[1];return c?(i.moveToElementText(c),i.collapse(!1)):i.moveToElementText(d),i.setEndPoint(s,t),o=i.text.length-h,!1}return a=e,!0}):(r=d,o=0),n||3==r.nodeType||o!=r.childNodes.length||r.nextSibling&&3==r.nextSibling.nodeType&&(r=r.nextSibling,o=0),[r,o]},setEndPoint:function(e,t,n){var i=e.duplicate();if(3!=t.nodeType)if(i.moveToElementText(t),i.collapse(!0),n==t.childNodes.length)if(n>0){for(var r=t.lastChild,o=0;r&&3==r.nodeType;)o+=r.length,t=r,r=r.previousSibling;r&&i.moveToElementText(r),i.collapse(!1),n=o}else i.moveToElementText(t),i.collapse(!0);else if(n>0){var r=t.childNodes[n-1];3==r.nodeType?(t=r,n=r.length):(i.moveToElementText(r),i.collapse(!1))}if(3==t.nodeType){var a=dijit.range.adjacentNoneTextNode(t),s=a[0],o=a[1];s?(i.moveToElementText(s),i.collapse(!1),"inherit"!=s.contentEditable&&o++):(i.moveToElementText(t.parentNode),i.collapse(!0)),n+=o,n>0&&(i.moveEnd("character",n)!=n&&alert("Error when moving!"),i.collapse(!1))}return i},decomposeTextRange:function(e){var t=dijit.range.ie.getEndPoint(e),n=t[0],i=t[1],r=t[0],o=t[1];return e.htmlText.length&&(e.htmlText==e.text?o=i+e.text.length:(t=dijit.range.ie.getEndPoint(e,!0),r=t[0],o=t[1])),[[n,i],[r,o],e.parentElement()]},setRange:function(e,t,n,i,r){var o=dijit.range.ie.setEndPoint(e,t,n);if(e.setEndPoint("StartToStart",o),!this.collapsed){var a=dijit.range.ie.setEndPoint(e,i,r);e.setEndPoint("EndToEnd",a)}return e}},e.declare("dijit.range.W3CRange",null,{constructor:function(){arguments.length>0?(this.setStart(arguments[0][0][0],arguments[0][0][1]),this.setEnd(arguments[0][1][0],arguments[0][1][1],arguments[0][2])):(this.commonAncestorContainer=null,this.startContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0)},_simpleSetEndPoint:function(e,t,n){var i=(this._body||e.ownerDocument.body).createTextRange();1!=e.nodeType?i.moveToElementText(e.parentNode):i.moveToElementText(e),i.collapse(!0),t.setEndPoint(n?"EndToEnd":"StartToStart",i)},_updateInternal:function(e){if(this.startContainer!==this.endContainer){if(!e){var t=(this._body||this.startContainer.ownerDocument.body).createTextRange();this._simpleSetEndPoint(this.startContainer,t),this._simpleSetEndPoint(this.endContainer,t,!0),e=t.parentElement()}this.commonAncestorContainer=dijit.range.getCommonAncestor(this.startContainer,this.endContainer,e)}else this.commonAncestorContainer=this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(e,t,n){(this.startContainer!==e||this.startOffset!=t)&&(delete this._cachedBookmark,this.startContainer=e,this.startOffset=t,this.endContainer?this._updateInternal(n):this.setEnd(e,t,n))},setEnd:function(e,t,n){(this.endContainer!==e||this.endOffset!=t)&&(delete this._cachedBookmark,this.endContainer=e,this.endOffset=t,this.startContainer?this._updateInternal(n):this.setStart(e,t,n))},setStartAfter:function(e,t){this._setPoint("setStart",e,t,1)},setStartBefore:function(e,t){this._setPoint("setStart",e,t,0)},setEndAfter:function(e,t){this._setPoint("setEnd",e,t,1)},setEndBefore:function(e,t){this._setPoint("setEnd",e,t,0)},_setPoint:function(e,t,n,i){var r=dijit.range.getIndex(t,t.parentNode).o;this[e](t.parentNode,r.pop()+i)},_getIERange:function(){var e=(this._body||this.endContainer.ownerDocument.body).createTextRange();return dijit.range.ie.setRange(e,this.startContainer,this.startOffset,this.endContainer,this.endOffset),e},getBookmark:function(){return this._getIERange(),this._cachedBookmark},_select:function(){var e=this._getIERange();e.select()},deleteContents:function(){var e=this._getIERange();e.pasteHTML(""),this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.collapsed=!0},cloneRange:function(){var e=new dijit.range.W3CRange([[this.startContainer,this.startOffset],[this.endContainer,this.endOffset]]);return e._body=this._body,e},detach:function(){this._body=null,this.commonAncestorContainer=null,this.startContainer=null,this.startOffset=0,this.endContainer=null,this.endOffset=0,this.collapsed=!0}})))}});