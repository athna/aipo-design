dojo._hasResource["dijit._tree.dndSource"]||(dojo._hasResource["dijit._tree.dndSource"]=!0,dojo.provide("dijit._tree.dndSource"),dojo.require("dijit._tree.dndSelector"),dojo.require("dojo.dnd.Manager"),dojo.declare("dijit._tree.dndSource",dijit._tree.dndSelector,{isSource:!0,copyOnly:!1,skipForm:!1,accept:["text"],constructor:function(t,e){e||(e={}),dojo.mixin(this,e),this.isSource="undefined"==typeof e.isSource?!0:e.isSource;var r=e.accept instanceof Array?e.accept:["text"];if(this.accept=null,r.length){this.accept={};for(var o=0;o<r.length;++o)this.accept[r[o]]=1}this.isDragging=!1,this.mouseDown=!1,this.targetAnchor=null,this.targetBox=null,this.before=!0,this.sourceState="",this.isSource&&dojo.addClass(this.node,"dojoDndSource"),this.targetState="",this.accept&&dojo.addClass(this.node,"dojoDndTarget"),this.horizontal&&dojo.addClass(this.node,"dojoDndHorizontal"),this.topics=[dojo.subscribe("/dnd/source/over",this,"onDndSourceOver"),dojo.subscribe("/dnd/start",this,"onDndStart"),dojo.subscribe("/dnd/drop",this,"onDndDrop"),dojo.subscribe("/dnd/cancel",this,"onDndCancel")]},startup:function(){},checkAcceptance:function(){return!0},copyState:function(t){return this.copyOnly||t},destroy:function(){this.inherited("destroy",arguments),dojo.forEach(this.topics,dojo.unsubscribe),this.targetAnchor=null},markupFactory:function(t,e){return t._skipStartup=!0,new dijit._tree.dndSource(e,t)},onMouseMove:function(t){if(!this.isDragging||"Disabled"!=this.targetState){this.inherited("onMouseMove",arguments);var e=dojo.dnd.manager();if(this.isDragging){if(this.allowBetween){var r=!1;this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox={xy:dojo.coords(this.current,!0),w:this.current.offsetWidth,h:this.current.offsetHeight}),r=this.horizontal?t.pageX-this.targetBox.xy.x<this.targetBox.w/2:t.pageY-this.targetBox.xy.y<this.targetBox.h/2),(this.current!=this.targetAnchor||r!=this.before)&&(this._markTargetAnchor(r),e.canDrop(!(this.current&&e.source==this&&this.current.id in this.selection)))}}else if(this.mouseDown&&this.isSource){var o=this.getSelectedNodes(),i=[];for(var n in o)i.push(o[n]);i.length&&e.startDrag(this,i,this.copyState(dojo.dnd.getCopyKeyState(t)))}}},onMouseDown:function(t){this.mouseDown=!0,this.mouseButton=t.button,this.inherited("onMouseDown",arguments)},onMouseUp:function(){this.mouseDown&&(this.mouseDown=!1,this.inherited("onMouseUp",arguments))},onMouseOver:function(t){for(var e=t.relatedTarget;e&&e!=this.node;)try{e=e.parentNode}catch(r){e=null}if(e||(this._changeState("Container","Over"),this.onOverEvent()),e=this._getChildByEvent(t),this.current!=e){if(this.current&&this._removeItemClass(this.current,"Over"),e){if(this._addItemClass(e,"Over"),this.isDragging){var o=dojo.dnd.manager();this.checkItemAcceptance(e,o.source)?o.canDrop(!("Disabled"==this.targetState||this.current&&o.source==this&&this.current.id in this.selection)):o.canDrop(!1)}}else if(this.isDragging){var o=dojo.dnd.manager();o.source&&this.checkAcceptance(o.source,o.source.getSelectedNodes())?o.canDrop(!("Disabled"==this.targetState||this.current&&o.source==this&&this.current.id in this.selection)):o.canDrop(!1)}this.current=e}},checkItemAcceptance:function(){return!0},onDndSourceOver:function(t){if(this!=t)this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor();else if(this.isDragging){var e=dojo.dnd.manager();e.canDrop(!("Disabled"==this.targetState||this.current&&e.source==this&&this.current.id in this.selection))}},onDndStart:function(t,e,r){this.isSource&&this._changeState("Source",this==t?r?"Copied":"Moved":"");var o=this.checkAcceptance(t,e);this._changeState("Target",o?"":"Disabled"),o&&dojo.dnd.manager().overSource(this),this.isDragging=!0},itemCreator:function(t){for(var e=[],r=0;r<t.length;r++)e.push({name:t[r].textContent,id:t[r].id});return e},onDndDrop:function(t,e){if("Over"==this.containerState){this.isDragging=!1;var r=this.current,o=this.itemCreator(e,r);if(r&&r!=this.tree.domNode)for(var i=0;i<o.length;i++){pInfo={parent:dijit.getEnclosingWidget(r).item,attribute:"children"};var n=this.tree.store.newItem(o[i],pInfo);console.log("newItem:",n)}else for(var i=0;i<o.length;i++)this.tree.store.newItem(o[i],null)}this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null),this.before=!0,this.isDragging=!1,this.mouseDown=!1,delete this.mouseButton,this._changeState("Source",""),this._changeState("Target","")},onOverEvent:function(){this.inherited("onOverEvent",arguments),dojo.dnd.manager().overSource(this)},onOutEvent:function(){this.inherited("onOutEvent",arguments),dojo.dnd.manager().outSource(this)},_markTargetAnchor:function(t){(this.current!=this.targetAnchor||this.before!=t)&&(this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=t,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After"))},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=null,this.targetBox=null,this.before=!0)},_markDndStatus:function(t){this._changeState("Source",t?"Copied":"Moved")}}),dojo.declare("dijit._tree.dndTarget",dijit._tree.dndSource,{constructor:function(){this.isSource=!1,dojo.removeClass(this.node,"dojoDndSource")},markupFactory:function(t,e){return t._skipStartup=!0,new dijit._tree.dndTarget(e,t)}}));