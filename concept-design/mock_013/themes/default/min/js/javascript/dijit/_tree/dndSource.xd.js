dojo._xdResourceLoaded({depends:[["provide","dijit._tree.dndSource"],["require","dijit._tree.dndSelector"],["require","dojo.dnd.Manager"]],defineResource:function(t){t._hasResource["dijit._tree.dndSource"]||(t._hasResource["dijit._tree.dndSource"]=!0,t.provide("dijit._tree.dndSource"),t.require("dijit._tree.dndSelector"),t.require("dojo.dnd.Manager"),t.declare("dijit._tree.dndSource",dijit._tree.dndSelector,{isSource:!0,copyOnly:!1,skipForm:!1,accept:["text"],constructor:function(e,r){r||(r={}),t.mixin(this,r),this.isSource="undefined"==typeof r.isSource?!0:r.isSource;var i=r.accept instanceof Array?r.accept:["text"];if(this.accept=null,i.length){this.accept={};for(var n=0;n<i.length;++n)this.accept[i[n]]=1}this.isDragging=!1,this.mouseDown=!1,this.targetAnchor=null,this.targetBox=null,this.before=!0,this.sourceState="",this.isSource&&t.addClass(this.node,"dojoDndSource"),this.targetState="",this.accept&&t.addClass(this.node,"dojoDndTarget"),this.horizontal&&t.addClass(this.node,"dojoDndHorizontal"),this.topics=[t.subscribe("/dnd/source/over",this,"onDndSourceOver"),t.subscribe("/dnd/start",this,"onDndStart"),t.subscribe("/dnd/drop",this,"onDndDrop"),t.subscribe("/dnd/cancel",this,"onDndCancel")]},startup:function(){},checkAcceptance:function(){return!0},copyState:function(t){return this.copyOnly||t},destroy:function(){this.inherited("destroy",arguments),t.forEach(this.topics,t.unsubscribe),this.targetAnchor=null},markupFactory:function(t,e){return t._skipStartup=!0,new dijit._tree.dndSource(e,t)},onMouseMove:function(e){if(!this.isDragging||"Disabled"!=this.targetState){this.inherited("onMouseMove",arguments);var r=t.dnd.manager();if(this.isDragging){if(this.allowBetween){var i=!1;this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox={xy:t.coords(this.current,!0),w:this.current.offsetWidth,h:this.current.offsetHeight}),i=this.horizontal?e.pageX-this.targetBox.xy.x<this.targetBox.w/2:e.pageY-this.targetBox.xy.y<this.targetBox.h/2),(this.current!=this.targetAnchor||i!=this.before)&&(this._markTargetAnchor(i),r.canDrop(!(this.current&&r.source==this&&this.current.id in this.selection)))}}else if(this.mouseDown&&this.isSource){var n=this.getSelectedNodes(),s=[];for(var o in n)s.push(n[o]);s.length&&r.startDrag(this,s,this.copyState(t.dnd.getCopyKeyState(e)))}}},onMouseDown:function(t){this.mouseDown=!0,this.mouseButton=t.button,this.inherited("onMouseDown",arguments)},onMouseUp:function(){this.mouseDown&&(this.mouseDown=!1,this.inherited("onMouseUp",arguments))},onMouseOver:function(e){for(var r=e.relatedTarget;r&&r!=this.node;)try{r=r.parentNode}catch(i){r=null}if(r||(this._changeState("Container","Over"),this.onOverEvent()),r=this._getChildByEvent(e),this.current!=r){if(this.current&&this._removeItemClass(this.current,"Over"),r){if(this._addItemClass(r,"Over"),this.isDragging){var n=t.dnd.manager();this.checkItemAcceptance(r,n.source)?n.canDrop(!("Disabled"==this.targetState||this.current&&n.source==this&&this.current.id in this.selection)):n.canDrop(!1)}}else if(this.isDragging){var n=t.dnd.manager();n.source&&this.checkAcceptance(n.source,n.source.getSelectedNodes())?n.canDrop(!("Disabled"==this.targetState||this.current&&n.source==this&&this.current.id in this.selection)):n.canDrop(!1)}this.current=r}},checkItemAcceptance:function(){return!0},onDndSourceOver:function(e){if(this!=e)this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor();else if(this.isDragging){var r=t.dnd.manager();r.canDrop(!("Disabled"==this.targetState||this.current&&r.source==this&&this.current.id in this.selection))}},onDndStart:function(e,r,i){this.isSource&&this._changeState("Source",this==e?i?"Copied":"Moved":"");var n=this.checkAcceptance(e,r);this._changeState("Target",n?"":"Disabled"),n&&t.dnd.manager().overSource(this),this.isDragging=!0},itemCreator:function(t){for(var e=[],r=0;r<t.length;r++)e.push({name:t[r].textContent,id:t[r].id});return e},onDndDrop:function(t,e){if("Over"==this.containerState){this.isDragging=!1;var r=this.current,i=this.itemCreator(e,r);if(r&&r!=this.tree.domNode)for(var n=0;n<i.length;n++){pInfo={parent:dijit.getEnclosingWidget(r).item,attribute:"children"};var s=this.tree.store.newItem(i[n],pInfo);console.log("newItem:",s)}else for(var n=0;n<i.length;n++)this.tree.store.newItem(i[n],null)}this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null),this.before=!0,this.isDragging=!1,this.mouseDown=!1,delete this.mouseButton,this._changeState("Source",""),this._changeState("Target","")},onOverEvent:function(){this.inherited("onOverEvent",arguments),t.dnd.manager().overSource(this)},onOutEvent:function(){this.inherited("onOutEvent",arguments),t.dnd.manager().outSource(this)},_markTargetAnchor:function(t){(this.current!=this.targetAnchor||this.before!=t)&&(this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=t,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After"))},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=null,this.targetBox=null,this.before=!0)},_markDndStatus:function(t){this._changeState("Source",t?"Copied":"Moved")}}),t.declare("dijit._tree.dndTarget",dijit._tree.dndSource,{constructor:function(){this.isSource=!1,t.removeClass(this.node,"dojoDndSource")},markupFactory:function(t,e){return t._skipStartup=!0,new dijit._tree.dndTarget(e,t)}}))}});