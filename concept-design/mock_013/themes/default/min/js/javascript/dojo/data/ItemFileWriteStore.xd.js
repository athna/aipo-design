dojo._xdResourceLoaded({depends:[["provide","dojo.data.ItemFileWriteStore"],["require","dojo.data.ItemFileReadStore"]],defineResource:function(e){e._hasResource["dojo.data.ItemFileWriteStore"]||(e._hasResource["dojo.data.ItemFileWriteStore"]=!0,e.provide("dojo.data.ItemFileWriteStore"),e.require("dojo.data.ItemFileReadStore"),e.declare("dojo.data.ItemFileWriteStore",e.data.ItemFileReadStore,{constructor:function(){this._features["dojo.data.api.Write"]=!0,this._features["dojo.data.api.Notification"]=!0,this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}},this._datatypeMap.Date.serialize||(this._datatypeMap.Date.serialize=function(t){return e.date.stamp.toISOString(t,{zulu:!0})}),this._saveInProgress=!1},_assert:function(e){if(!e)throw new Error("assertion failed in ItemFileWriteStore")},_getIdentifierAttribute:function(){var e=this.getFeatures()["dojo.data.api.Identity"];return e},newItem:function(t,i){if(this._assert(!this._saveInProgress),this._loadFinished||this._forceLoad(),"object"!=typeof t&&"undefined"!=typeof t)throw new Error("newItem() was passed something other than an object");var s=null,r=this._getIdentifierAttribute();if(r===Number)s=this._arrayOfAllItems.length;else{if(s=t[r],"undefined"==typeof s)throw new Error("newItem() was not passed an identity for the new item");if(e.isArray(s))throw new Error("newItem() was not passed an single-valued identity")}this._itemsByIdentity&&this._assert("undefined"==typeof this._itemsByIdentity[s]),this._assert("undefined"==typeof this._pending._newItems[s]),this._assert("undefined"==typeof this._pending._deletedItems[s]);var n={};n[this._storeRefPropName]=this,n[this._itemNumPropName]=this._arrayOfAllItems.length,this._itemsByIdentity&&(this._itemsByIdentity[s]=n),this._arrayOfAllItems.push(n);var a=null;if(i&&i.parent&&i.attribute){a={item:i.parent,attribute:i.attribute,oldValue:void 0};var o=this.getValues(i.parent,i.attribute);if(o&&o.length>0){var h=o.slice(0,o.length);a.oldValue=1===o.length?o[0]:o.slice(0,o.length),h.push(n),this._setValueOrValues(i.parent,i.attribute,h,!1),a.newValue=this.getValues(i.parent,i.attribute)}else this._setValueOrValues(i.parent,i.attribute,n,!1),a.newValue=n}else n[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(n);this._pending._newItems[s]=n;for(var l in t){if(l===this._storeRefPropName||l===this._itemNumPropName)throw new Error("encountered bug in ItemFileWriteStore.newItem");var _=t[l];e.isArray(_)||(_=[_]),n[l]=_}return this.onNew(n,a),n},_removeArrayElement:function(t,i){var s=e.indexOf(t,i);return-1!=s?(t.splice(s,1),!0):!1},deleteItem:function(e){this._assert(!this._saveInProgress),this._assertIsItem(e);var t=e[this._itemNumPropName];this._arrayOfAllItems[t]=null;var i=this.getIdentity(e);return e[this._storeRefPropName]=null,this._itemsByIdentity&&delete this._itemsByIdentity[i],this._pending._deletedItems[i]=e,e[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,e),this.onDelete(e),!0},setValue:function(e,t,i){return this._setValueOrValues(e,t,i,!0)},setValues:function(e,t,i){return this._setValueOrValues(e,t,i,!0)},unsetAttribute:function(e,t){return this._setValueOrValues(e,t,[],!0)},_setValueOrValues:function(t,i,s,r){this._assert(!this._saveInProgress),this._assertIsItem(t),this._assert(e.isString(i)),this._assert("undefined"!=typeof s);var n=this._getIdentifierAttribute();if(i==n)throw new Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");var a=this._getValueOrValues(t,i),o=this.getIdentity(t);if(!this._pending._modifiedItems[o]){var h={};for(var l in t)if(l===this._storeRefPropName||l===this._itemNumPropName||l===this._rootItemPropName)h[l]=t[l];else{for(var _=t[l],m=[],d=0;d<_.length;++d)m.push(_[d]);h[l]=m}this._pending._modifiedItems[o]=h}var u=!1;if(e.isArray(s)&&0===s.length)u=delete t[i],s=void 0;else{var f=[];if(e.isArray(s))for(var p=s,I=0;I<p.length;++I)f.push(p[I]);else{var y=s;f.push(y)}t[i]=f,u=!0}return r&&this.onSet(t,i,a,s),u},_getValueOrValues:function(e,t){var i=void 0;if(this.hasAttribute(e,t)){var s=this.getValues(e,t);i=1==s.length?s[0]:s}return i},_flatten:function(t){if(this.isItem(t)){var i=t,s=this.getIdentity(i),r={_reference:s};return r}if("object"==typeof t)for(type in this._datatypeMap){var n=this._datatypeMap[type];if(e.isObject(n)&&!e.isFunction(n)){if(t instanceof n.type){if(!n.serialize)throw new Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+type+"]");return{_type:type,_value:n.serialize(t)}}}else if(t instanceof n)return{_type:type,_value:t.toString()}}return t},_getNewFileContentString:function(){var t={},i=this._getIdentifierAttribute();i!==Number&&(t.identifier=i),this._labelAttr&&(t.label=this._labelAttr),t.items=[];for(var s=0;s<this._arrayOfAllItems.length;++s){var r=this._arrayOfAllItems[s];if(null!==r){serializableItem={};for(var n in r)if(n!==this._storeRefPropName&&n!==this._itemNumPropName){var a=n,o=this.getValues(r,a);if(1==o.length)serializableItem[a]=this._flatten(o[0]);else for(var h=[],l=0;l<o.length;++l)h.push(this._flatten(o[l])),serializableItem[a]=h}t.items.push(serializableItem)}}var _=!0;return e.toJson(t,_)},save:function(t){this._assert(!this._saveInProgress),this._saveInProgress=!0;var i=this,s=function(){if(i._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}},i._saveInProgress=!1,t&&t.onComplete){var s=t.scope||e.global;t.onComplete.call(s)}},r=function(){if(i._saveInProgress=!1,t&&t.onError){var s=t.scope||e.global;t.onError.call(s)}};if(this._saveEverything){var n=this._getNewFileContentString();this._saveEverything(s,r,n)}this._saveCustom&&this._saveCustom(s,r),this._saveEverything||this._saveCustom||s()},revert:function(){this._assert(!this._saveInProgress);var e;for(e in this._pending._newItems){var t=this._pending._newItems[e];t[this._storeRefPropName]=null,this._arrayOfAllItems[t[this._itemNumPropName]]=null,t[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,t),this._itemsByIdentity&&delete this._itemsByIdentity[e]}for(e in this._pending._modifiedItems){var i=this._pending._modifiedItems[e],s=null;s=this._itemsByIdentity?this._itemsByIdentity[e]:this._arrayOfAllItems[e],i[this._storeRefPropName]=this,s[this._storeRefPropName]=null;var r=s[this._itemNumPropName];this._arrayOfAllItems[r]=i,s[this._rootItemPropName]&&(r=s[this._itemNumPropName],this._arrayOfTopLevelItems[r]=i),this._itemsByIdentity&&(this._itemsByIdentity[e]=i)}for(e in this._pending._deletedItems){var n=this._pending._deletedItems[e];n[this._storeRefPropName]=this;var a=n[this._itemNumPropName];this._arrayOfAllItems[a]=n,this._itemsByIdentity&&(this._itemsByIdentity[e]=n),n[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(n)}return this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}},!0},isDirty:function(e){if(e){var t=this.getIdentity(e);return new Boolean(this._pending._newItems[t]||this._pending._modifiedItems[t]||this._pending._deletedItems[t])}var i;for(i in this._pending._newItems)return!0;for(i in this._pending._modifiedItems)return!0;for(i in this._pending._deletedItems)return!0;return!1},onSet:function(){},onNew:function(){},onDelete:function(){}}))}});