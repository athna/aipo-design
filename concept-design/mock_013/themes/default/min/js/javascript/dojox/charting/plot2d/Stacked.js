dojo._hasResource["dojox.charting.plot2d.Stacked"]||(dojo._hasResource["dojox.charting.plot2d.Stacked"]=!0,dojo.provide("dojox.charting.plot2d.Stacked"),dojo.require("dojox.charting.plot2d.common"),dojo.require("dojox.charting.plot2d.Default"),dojo.require("dojox.lang.functional"),function(){var t=dojox.lang.functional,e=dojox.charting.plot2d.common,o=t.lambda("item.purgeGroup()");dojo.declare("dojox.charting.plot2d.Stacked",dojox.charting.plot2d.Default,{calculateAxes:function(t){var o=e.collectStackedStats(this.series);return this._maxRunLength=o.hmax,this._calc(t,o),this},render:function(r,i){for(var a=t.repeat(this._maxRunLength,"-> 0",0),s=0;s<this.series.length;++s)for(var h=this.series[s],l=0;l<h.data.length;++l){var n=h.data[l];isNaN(n)&&(n=0),a[l]+=n}if(this.dirty){dojo.forEach(this.series,o),this.cleanGroup();var d=this.group;t.forEachReversed(this.series,function(t){t.cleanGroup(d)})}for(var c,u,p,f,k=this.chart.theme,s=this.series.length-1;s>=0;--s){var h=this.series[s];if(this.dirty||h.dirty){h.cleanGroup();var d=h.group,j=dojo.map(a,function(t,e){return{x:this._hScaler.scale*(e+1-this._hScaler.bounds.lower)+i.l,y:r.height-i.b-this._vScaler.scale*(t-this._vScaler.bounds.lower)}},this);if(h.fill&&h.stroke||(p=new dojo.Color(k.next("color"))),this.opt.areas){var x=dojo.clone(j);x.push({x:j[j.length-1].x,y:r.height-i.b}),x.push({x:j[0].x,y:r.height-i.b}),x.push(j[0]);var g=h.fill?h.fill:e.augmentFill(k.series.fill,p);d.createPolyline(x).setFill(g)}if((this.opt.lines||this.opt.markers)&&(c=h.stroke?e.makeStroke(h.stroke):e.augmentStroke(k.series.stroke,p),(h.outline||k.series.outline)&&(u=e.makeStroke(h.outline?h.outline:k.series.outline),u.width=2*u.width+c.width)),this.opt.markers&&(f=h.marker?h.marker:k.next("marker")),this.opt.shadows&&c){var m=this.opt.shadows,v=new dojo.Color([0,0,0,.3]),S=dojo.map(j,function(t){return{x:t.x+m.dx,y:t.y+m.dy}}),y=dojo.clone(u?u:c);y.color=v,y.width+=m.dw?m.dw:0,this.opt.lines&&d.createPolyline(S).setStroke(y),this.opt.markers&&dojo.forEach(S,function(t){d.createPath("M"+t.x+" "+t.y+" "+f).setStroke(y).setFill(v)},this)}this.opt.lines&&(u&&d.createPolyline(j).setStroke(u),d.createPolyline(j).setStroke(c)),this.opt.markers&&dojo.forEach(j,function(t){var e="M"+t.x+" "+t.y+" "+f;u&&d.createPath(e).setStroke(u),d.createPath(e).setStroke(c).setFill(c.color)},this),h.dirty=!1;for(var l=0;l<h.data.length;++l){var n=h.data[l];isNaN(n)&&(n=0),a[l]-=n}}}return this.dirty=!1,this}})}());