dojo._xdResourceLoaded({depends:[["provide","dojox.gfx.canvas"],["require","dojox.gfx._base"],["require","dojox.gfx.shape"],["require","dojox.gfx.path"],["require","dojox.gfx.arc"],["require","dojox.gfx.decompose"]],defineResource:function(t){t._hasResource["dojox.gfx.canvas"]||(t._hasResource["dojox.gfx.canvas"]=!0,t.provide("dojox.gfx.canvas"),t.require("dojox.gfx._base"),t.require("dojox.gfx.shape"),t.require("dojox.gfx.path"),t.require("dojox.gfx.arc"),t.require("dojox.gfx.decompose"),t.experimental("dojox.gfx.canvas"),function(){var e=dojox.gfx,s=e.shape,a=e.arc,i=e.matrix,o=i.multiplyPoint,n=2*Math.PI;t.extend(e.Shape,{render:function(t){t.save(),this._renderTransform(t),this._renderShape(t),this._renderFill(t,!0),this._renderStroke(t,!0),t.restore()},_renderTransform:function(t){if("canvasTransform"in this){var e=this.canvasTransform;t.translate(e.dx,e.dy),t.rotate(e.angle2),t.scale(e.sx,e.sy),t.rotate(e.angle1)}},_renderShape:function(){},_renderFill:function(t,e){"canvasFill"in this?("canvasFillImage"in this&&(this.canvasFill=t.createPattern(this.canvasFillImage,"repeat"),delete this.canvasFillImage),t.fillStyle=this.canvasFill,e&&t.fill()):t.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(t,e){var s=this.strokeStyle;s?(t.strokeStyle=s.color.toString(),t.lineWidth=s.width,t.lineCap=s.cap,"number"==typeof s.join?(t.lineJoin="miter",t.miterLimit=s.join):t.lineJoin=s.join,e&&t.stroke()):e||(t.strokeStyle="rgba(0,0,0,0.0)")},getEventSource:function(){return null},connect:function(){},disconnect:function(){}});var r=function(t,e,s){var a=t.prototype[e];t.prototype[e]=s?function(){return this.surface.makeDirty(),a.apply(this,arguments),s.call(this),this}:function(){return this.surface.makeDirty(),a.apply(this,arguments)}};r(e.Shape,"setTransform",function(){this.matrix?this.canvasTransform=e.decompose(this.matrix):delete this.canvasTransform}),r(e.Shape,"setFill",function(){var s,a=this.fillStyle;if(a){if("object"==typeof a&&"type"in a){var i=this.surface.rawNode.getContext("2d");switch(a.type){case"linear":case"radial":s="linear"==a.type?i.createLinearGradient(a.x1,a.y1,a.x2,a.y2):i.createRadialGradient(a.cx,a.cy,0,a.cx,a.cy,a.r),t.forEach(a.colors,function(t){s.addColorStop(t.offset,e.normalizeColor(t.color).toString())});break;case"pattern":var o=new Image(a.width,a.height);this.surface.downloadImage(o,a.src),this.canvasFillImage=o}}else s=a.toString();this.canvasFill=s}else delete this.canvasFill}),r(e.Shape,"setStroke"),r(e.Shape,"setShape"),t.declare("dojox.gfx.Group",e.Shape,{constructor:function(){s.Container._init.call(this)},render:function(t){t.save(),this._renderTransform(t),this._renderFill(t),this._renderStroke(t);for(var e=0;e<this.children.length;++e)this.children[e].render(t);t.restore()}}),t.declare("dojox.gfx.Rect",s.Rect,{_renderShape:function(t){var e=this.shape,s=Math.min(e.r,e.height/2,e.width/2),a=e.x,i=a+e.width,o=e.y,n=o+e.height,r=a+s,h=i-s,l=o+s,c=n-s;t.beginPath(),t.moveTo(r,o),t.lineTo(h,o),s&&t.arcTo(i,o,i,l,s),t.lineTo(i,c),s&&t.arcTo(i,n,h,n,s),t.lineTo(r,n),s&&t.arcTo(a,n,a,c,s),t.lineTo(a,l),s&&t.arcTo(a,o,r,o,s),t.closePath()}});var h=[];!function(){var t=a.curvePI4;h.push(t.s,t.c1,t.c2,t.e);for(var e=45;360>e;e+=45){var s=i.rotateg(e);h.push(o(s,t.c1),o(s,t.c2),o(s,t.e))}}(),t.declare("dojox.gfx.Ellipse",s.Ellipse,{setShape:function(){e.Ellipse.superclass.setShape.apply(this,arguments);var t,s,a,n=this.shape,r=[],l=i.normalize([i.translate(n.cx,n.cy),i.scale(n.rx,n.ry)]);t=o(l,h[0]),r.push([t.x,t.y]);for(var c=1;c<h.length;c+=3)s=o(l,h[c]),a=o(l,h[c+1]),t=o(l,h[c+2]),r.push([s.x,s.y,a.x,a.y,t.x,t.y]);return this.canvasEllipse=r,this},_renderShape:function(t){var e=this.canvasEllipse;t.beginPath(),t.moveTo.apply(t,e[0]);for(var s=1;s<e.length;++s)t.bezierCurveTo.apply(t,e[s]);t.closePath()}}),t.declare("dojox.gfx.Circle",s.Circle,{_renderShape:function(t){var e=this.shape;t.beginPath(),t.arc(e.cx,e.cy,e.r,0,n,1)}}),t.declare("dojox.gfx.Line",s.Line,{_renderShape:function(t){var e=this.shape;t.beginPath(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2)}}),t.declare("dojox.gfx.Polyline",s.Polyline,{setShape:function(){e.Polyline.superclass.setShape.apply(this,arguments);var t,s,a=this.shape.points,i=a[0],o=[];if(a.length)for("number"==typeof i?(o.push(i,a[1]),s=2):(o.push(i.x,i.y),s=1);s<a.length;++s)t=a[s],"number"==typeof t?o.push(t,a[++s]):o.push(t.x,t.y);return this.canvasPolyline=o,this},_renderShape:function(t){var e=this.canvasPolyline;if(e.length){t.beginPath(),t.moveTo(e[0],e[1]);for(var s=2;s<e.length;s+=2)t.lineTo(e[s],e[s+1])}}}),t.declare("dojox.gfx.Image",s.Image,{setShape:function(){e.Image.superclass.setShape.apply(this,arguments);var t=new Image;return this.surface.downloadImage(t,this.shape.src),this.canvasImage=t,this},_renderShape:function(t){var e=this.shape;t.drawImage(this.canvasImage,e.x,e.y,e.width,e.height)}}),t.declare("dojox.gfx.Text",s.Text,{_renderShape:function(){this.shape}}),r(e.Text,"setFont");var l={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};t.declare("dojox.gfx.Path",e.path.Path,{constructor:function(){this.last={},this.lastControl={}},setShape:function(){return this.canvasPath=[],e.Path.superclass.setShape.apply(this,arguments)},_updateWithSegment:function(s){var a=t.clone(this.last);this[l[s.action]](this.canvasPath,s.action,s.args),this.last=a,e.Path.superclass._updateWithSegment.apply(this,arguments)},_renderShape:function(t){var e=this.canvasPath;t.beginPath();for(var s=0;s<e.length;s+=2)t[e[s]].apply(t,e[s+1])},_moveToA:function(t,e,s){t.push("moveTo",[s[0],s[1]]);for(var a=2;a<s.length;a+=2)t.push("lineTo",[s[a],s[a+1]]);this.last.x=s[s.length-2],this.last.y=s[s.length-1],this.lastControl={}},_moveToR:function(t,e,s){"x"in this.last?t.push("moveTo",[this.last.x+=s[0],this.last.y+=s[1]]):t.push("moveTo",[this.last.x=s[0],this.last.y=s[1]]);for(var a=2;a<s.length;a+=2)t.push("lineTo",[this.last.x+=s[a],this.last.y+=s[a+1]]);this.lastControl={}},_lineToA:function(t,e,s){for(var a=0;a<s.length;a+=2)t.push("lineTo",[s[a],s[a+1]]);this.last.x=s[s.length-2],this.last.y=s[s.length-1],this.lastControl={}},_lineToR:function(t,e,s){for(var a=0;a<s.length;a+=2)t.push("lineTo",[this.last.x+=s[a],this.last.y+=s[a+1]]);this.lastControl={}},_hLineToA:function(t,e,s){for(var a=0;a<s.length;++a)t.push("lineTo",[s[a],this.last.y]);this.last.x=s[s.length-1],this.lastControl={}},_hLineToR:function(t,e,s){for(var a=0;a<s.length;++a)t.push("lineTo",[this.last.x+=s[a],this.last.y]);this.lastControl={}},_vLineToA:function(t,e,s){for(var a=0;a<s.length;++a)t.push("lineTo",[this.last.x,s[a]]);this.last.y=s[s.length-1],this.lastControl={}},_vLineToR:function(t,e,s){for(var a=0;a<s.length;++a)t.push("lineTo",[this.last.x,this.last.y+=s[a]]);this.lastControl={}},_curveToA:function(t,e,s){for(var a=0;a<s.length;a+=6)t.push("bezierCurveTo",s.slice(a,a+6));this.last.x=s[s.length-2],this.last.y=s[s.length-1],this.lastControl.x=s[s.length-4],this.lastControl.y=s[s.length-3],this.lastControl.type="C"},_curveToR:function(t,e,s){for(var a=0;a<s.length;a+=6)t.push("bezierCurveTo",[this.last.x+s[a],this.last.y+s[a+1],this.lastControl.x=this.last.x+s[a+2],this.lastControl.y=this.last.y+s[a+3],this.last.x+s[a+4],this.last.y+s[a+5]]),this.last.x+=s[a+4],this.last.y+=s[a+5];this.lastControl.type="C"},_smoothCurveToA:function(t,e,s){for(var a=0;a<s.length;a+=4){var i="C"==this.lastControl.type;t.push("bezierCurveTo",[i?2*this.last.x-this.lastControl.x:this.last.x,i?2*this.last.y-this.lastControl.y:this.last.y,s[a],s[a+1],s[a+2],s[a+3]]),this.lastControl.x=s[a],this.lastControl.y=s[a+1],this.lastControl.type="C"}this.last.x=s[s.length-2],this.last.y=s[s.length-1]},_smoothCurveToR:function(t,e,s){for(var a=0;a<s.length;a+=4){var i="C"==this.lastControl.type;t.push("bezierCurveTo",[i?2*this.last.x-this.lastControl.x:this.last.x,i?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+s[a],this.last.y+s[a+1],this.last.x+s[a+2],this.last.y+s[a+3]]),this.lastControl.x=this.last.x+s[a],this.lastControl.y=this.last.y+s[a+1],this.lastControl.type="C",this.last.x+=s[a+2],this.last.y+=s[a+3]}},_qCurveToA:function(t,e,s){for(var a=0;a<s.length;a+=4)t.push("quadraticCurveTo",s.slice(a,a+4));this.last.x=s[s.length-2],this.last.y=s[s.length-1],this.lastControl.x=s[s.length-4],this.lastControl.y=s[s.length-3],this.lastControl.type="Q"},_qCurveToR:function(t,e,s){for(var a=0;a<s.length;a+=4)t.push("quadraticCurveTo",[this.lastControl.x=this.last.x+s[a],this.lastControl.y=this.last.y+s[a+1],this.last.x+s[a+2],this.last.y+s[a+3]]),this.last.x+=s[a+2],this.last.y+=s[a+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(t,e,s){for(var a=0;a<s.length;a+=2){var i="Q"==this.lastControl.type;t.push("quadraticCurveTo",[this.lastControl.x=i?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=i?2*this.last.y-this.lastControl.y:this.last.y,s[a],s[a+1]]),this.lastControl.type="Q"}this.last.x=s[s.length-2],this.last.y=s[s.length-1]},_qSmoothCurveToR:function(t,e,s){for(var a=0;a<s.length;a+=2){var i="Q"==this.lastControl.type;t.push("quadraticCurveTo",[this.lastControl.x=i?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=i?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+s[a],this.last.y+s[a+1]]),this.lastControl.type="Q",this.last.x+=s[a],this.last.y+=s[a+1]}},_arcTo:function(e,s,i){for(var o="a"==s,n=0;n<i.length;n+=7){var r=i[n+5],h=i[n+6];o&&(r+=this.last.x,h+=this.last.y);var l=a.arcAsBezier(this.last,i[n],i[n+1],i[n+2],i[n+3]?1:0,i[n+4]?1:0,r,h);t.forEach(l,function(t){e.push("bezierCurveTo",t)}),this.last.x=r,this.last.y=h}this.lastControl={}},_closePath:function(t){t.push("closePath",[]),this.lastControl={}}}),t.forEach(["moveTo","lineTo","hLineTo","vLineTo","curveTo","smoothCurveTo","qCurveTo","qSmoothCurveTo","arcTo","closePath"],function(t){r(e.Path,t)}),t.declare("dojox.gfx.TextPath",e.path.TextPath,{_renderShape:function(){this.shape}}),t.declare("dojox.gfx.Surface",s.Surface,{constructor:function(){s.Container._init.call(this),this.pendingImageCount=0,this.makeDirty()},setDimensions:function(t,s){return this.width=e.normalizedLength(t),this.height=e.normalizedLength(s),this.rawNode?(this.rawNode.width=t,this.rawNode.height=s,this.makeDirty(),this):this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null},render:function(){if(!this.pendingImageCount){var t=this.rawNode.getContext("2d");t.save(),t.clearRect(0,0,this.rawNode.width,this.rawNode.height);for(var e=0;e<this.children.length;++e)this.children[e].render(t);t.restore(),"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender)}},makeDirty:function(){this.pendingImagesCount||"pendingRender"in this||(this.pendingRender=setTimeout(t.hitch(this,this.render),0))},downloadImage:function(e,s){var a=t.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender),e.onload=a,e.onerror=a,e.onabort=a,e.src=s},onImageLoad:function(){--this.pendingImageCount||this.render()},getEventSource:function(){return null},connect:function(){},disconnect:function(){}}),e.createSurface=function(s,a,i){a||(a="100%"),i||(i="100%");var o=new e.Surface,n=t.byId(s),r=n.ownerDocument.createElement("canvas");return r.width=a,r.height=i,n.appendChild(r),o.rawNode=r,o.surface=o,o};var c=s.Container,u={add:function(){return this.surface.makeDirty(),c.add.apply(this,arguments)},remove:function(){return this.surface.makeDirty(),c.remove.apply(this,arguments)},clear:function(){return this.surface.makeDirty(),c.clear.apply(this,arguments)},_moveChildToFront:function(){return this.surface.makeDirty(),c._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(){return this.surface.makeDirty(),c._moveChildToBack.apply(this,arguments)}};t.mixin(s.Creator,{createObject:function(t,e){var s=new t;return s.surface=this.surface,s.setShape(e),this.add(s),s}}),t.extend(e.Group,u),t.extend(e.Group,s.Creator),t.extend(e.Surface,u),t.extend(e.Surface,s.Creator)}())}});