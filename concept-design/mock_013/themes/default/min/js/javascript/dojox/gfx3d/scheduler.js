dojo._hasResource["dojox.gfx3d.scheduler"]||(dojo._hasResource["dojox.gfx3d.scheduler"]=!0,dojo.provide("dojox.gfx3d.scheduler"),dojo.provide("dojox.gfx3d.drawer"),dojo.require("dojox.gfx3d.vector"),dojo.mixin(dojox.gfx3d.scheduler,{zOrder:function(o,e){return e=e?e:dojox.gfx3d.scheduler.order,o.sort(function(o,r){return e(r)-e(o)}),o},bsp:function(o,e){console.debug("BSP scheduler"),e=e?e:dojox.gfx3d.scheduler.outline;var r=new dojox.gfx3d.scheduler.BinarySearchTree(o[0],e);return dojo.forEach(o.slice(1),function(o){r.add(o,e)}),r.iterate(e)},order:function(o){return o.getZOrder()},outline:function(o){return o.getOutline()}}),dojo.declare("dojox.gfx3d.scheduler.BinarySearchTree",null,{constructor:function(o,e){this.plus=null,this.minus=null,this.object=o;var r=e(o);this.orient=r[0],this.normal=dojox.gfx3d.vector.normalize(r)},add:function(o,e){var r=.5,t=e(o),d=dojox.gfx3d.vector,n=this.normal,i=this.orient;if(dojo.every(t,function(o){return Math.floor(r+d.dotProduct(n,d.substract(o,i)))<=0}))this.minus?this.minus.add(o,e):this.minus=new dojox.gfx3d.scheduler.BinarySearchTree(o,e);else{if(!dojo.every(t,function(o){return Math.floor(r+d.dotProduct(n,d.substract(o,i)))>=0}))throw dojo.forEach(t,function(o){console.debug(d.dotProduct(n,d.substract(o,i)))}),"The case: polygon cross siblings' plate is not implemneted yet";this.plus?this.plus.add(o,e):this.plus=new dojox.gfx3d.scheduler.BinarySearchTree(o,e)}},iterate:function(){var o=.5,e=dojox.gfx3d.vector,r=[],t=null,d={x:0,y:0,z:-1e4};return t=Math.floor(o+e.dotProduct(this.normal,e.substract(d,this.orient)))<=0?[this.plus,this.minus]:[this.minus,this.plus],t[0]&&(r=r.concat(t[0].iterate())),r.push(this.object),t[1]&&(r=r.concat(t[1].iterate())),r}}),dojo.mixin(dojox.gfx3d.drawer,{conservative:function(o,e,r){console.debug("conservative draw"),dojo.forEach(this.objects,function(o){o.destroy()}),dojo.forEach(e,function(o){o.draw(r.lighting)})},chart:function(o,e,r){console.debug("chart draw"),dojo.forEach(this.todos,function(o){o.draw(r.lighting)})}}));