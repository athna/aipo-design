dojo._hasResource["dojox.grid._grid.builder"]||(dojo._hasResource["dojox.grid._grid.builder"]=!0,dojo.provide("dojox.grid._grid.builder"),dojo.require("dojox.grid._grid.drag"),dojo.declare("dojox.grid.Builder",null,{constructor:function(e){this.view=e,this.grid=e.grid},view:null,_table:'<table class="dojoxGrid-row-table" border="0" cellspacing="0" cellpadding="0" role="wairole:presentation">',generateCellMarkup:function(e,o,t,i){var r,d=[];return r=i?['<th tabIndex="-1" role="wairole:columnheader"']:['<td tabIndex="-1" role="wairole:gridcell"'],e.colSpan&&r.push(' colspan="',e.colSpan,'"'),e.rowSpan&&r.push(' rowspan="',e.rowSpan,'"'),r.push(' class="dojoxGrid-cell '),e.classes&&r.push(e.classes," "),t&&r.push(t," "),d.push(r.join("")),d.push(""),r=['" idx="',e.index,'" style="'],r.push(e.styles,o||""),e.unitWidth&&r.push("width:",e.unitWidth,";"),d.push(r.join("")),d.push(""),r=['"'],e.attrs&&r.push(" ",e.attrs),r.push(">"),d.push(r.join("")),d.push(""),d.push("</td>"),d},isCellNode:function(e){return Boolean(e&&e.getAttribute&&e.getAttribute("idx"))},getCellNodeIndex:function(e){return e?Number(e.getAttribute("idx")):-1},getCellNode:function(e,o){for(var t,i=0;t=dojox.grid.getTr(e.firstChild,i);i++)for(var r,d=0;r=t.cells[d];d++)if(this.getCellNodeIndex(r)==o)return r},findCellTarget:function(e,o){for(var t=e;t&&!this.isCellNode(t)&&t!=o;)t=t.parentNode;return t!=o?t:null},baseDecorateEvent:function(e){e.dispatch="do"+e.type,e.grid=this.grid,e.sourceView=this.view,e.cellNode=this.findCellTarget(e.target,e.rowNode),e.cellIndex=this.getCellNodeIndex(e.cellNode),e.cell=e.cellIndex>=0?this.grid.getCell(e.cellIndex):null},findTarget:function(e,o){for(var t=e;t&&!(o in t)&&t!=this.domNode;)t=t.parentNode;return t!=this.domNode?t:null},findRowTarget:function(e){return this.findTarget(e,dojox.grid.rowIndexTag)},isIntraNodeEvent:function(e){try{return e.cellNode&&e.relatedTarget&&dojo.isDescendant(e.relatedTarget,e.cellNode)}catch(o){return!1}},isIntraRowEvent:function(e){try{var o=e.relatedTarget&&this.findRowTarget(e.relatedTarget);return!o&&-1==e.rowIndex||o&&e.rowIndex==o.gridRowIndex}catch(t){return!1}},dispatchEvent:function(e){return e.dispatch in this?this[e.dispatch](e):void 0},domouseover:function(e){e.cellNode&&e.cellNode!=this.lastOverCellNode&&(this.lastOverCellNode=e.cellNode,this.grid.onMouseOver(e)),this.grid.onMouseOverRow(e)},domouseout:function(e){e.cellNode&&e.cellNode==this.lastOverCellNode&&!this.isIntraNodeEvent(e,this.lastOverCellNode)&&(this.lastOverCellNode=null,this.grid.onMouseOut(e),this.isIntraRowEvent(e)||this.grid.onMouseOutRow(e))}}),dojo.declare("dojox.grid.contentBuilder",dojox.grid.Builder,{update:function(){this.prepareHtml()},prepareHtml:function(){for(var e,o=this.grid.get,t=this.view.structure.rows,i=0;e=t[i];i++)for(var r,d=0;r=e[d];d++)r.get=r.get||void 0==r.value&&o,r.markup=this.generateCellMarkup(r,r.cellStyles,r.cellClasses,!1)},generateHtml:function(e,o){var t=[this._table],i=this.view,r=i.onBeforeRow,d=i.structure.rows;r&&r(o,d);for(var n,l=0;n=d[l];l++)if(!n.hidden&&!n.header){t.push(n.invisible?'<tr class="dojoxGrid-invisible">':"<tr>");for(var s,a,u,c,h=0;s=n[h];h++)a=s.markup,u=s.customClasses=[],c=s.customStyles=[],a[5]=s.format(e),a[1]=u.join(" "),a[3]=c.join(";"),t.push.apply(t,a);t.push("</tr>")}return t.push("</table>"),t.join("")},decorateEvent:function(e){return e.rowNode=this.findRowTarget(e.target),e.rowNode?(e.rowIndex=e.rowNode[dojox.grid.rowIndexTag],this.baseDecorateEvent(e),e.cell=this.grid.getCell(e.cellIndex),!0):!1}}),dojo.declare("dojox.grid.headerBuilder",dojox.grid.Builder,{bogusClickTime:0,overResizeWidth:4,minColWidth:1,_table:'<table class="dojoxGrid-row-table" border="0" cellspacing="0" cellpadding="0" role="wairole:presentation"',update:function(){this.tableMap=new dojox.grid.tableMap(this.view.structure.rows)},generateHtml:function(e,o){var t=[this._table],i=this.view.structure.rows;this.view.viewWidth&&t.push([' style="width:',this.view.viewWidth,';"'].join("")),t.push(">"),dojox.grid.fire(this.view,"onBeforeRow",[-1,i]);for(var r,d=0;r=i[d];d++)if(!r.hidden){t.push(r.invisible?'<tr class="dojoxGrid-invisible">':"<tr>");for(var n,l,s=0;n=r[s];s++)n.customClasses=[],n.customStyles=[],l=this.generateCellMarkup(n,n.headerStyles,n.headerClasses,!0),l[5]=void 0!=o?o:e(n),l[3]=n.customStyles.join(";"),l[1]=n.customClasses.join(" "),t.push(l.join(""));t.push("</tr>")}return t.push("</table>"),t.join("")},getCellX:function(e){var o=e.layerX;if(dojo.isMoz){var t=dojox.grid.ascendDom(e.target,dojox.grid.makeNotTagName("th"));o-=t&&t.offsetLeft||0}var t=dojox.grid.ascendDom(e.target,function(){return t&&t!=e.cellNode?(o+=t.offsetLeft<0?0:t.offsetLeft,!0):!1});return o},decorateEvent:function(e){return this.baseDecorateEvent(e),e.rowIndex=-1,e.cellX=this.getCellX(e),!0},prepareLeftResize:function(e){var o=dojox.grid.getTdIndex(e.cellNode);return e.cellNode=o?e.cellNode.parentNode.cells[o-1]:null,e.cellIndex=e.cellNode?this.getCellNodeIndex(e.cellNode):-1,Boolean(e.cellNode)},canResize:function(e){if(!e.cellNode||e.cellNode.colSpan>1)return!1;var o=this.grid.getCell(e.cellIndex);return!o.noresize&&!o.isFlex()},overLeftResizeArea:function(e){return e.cellIndex>0&&e.cellX<this.overResizeWidth&&this.prepareLeftResize(e)},overRightResizeArea:function(e){return e.cellNode&&e.cellX>=e.cellNode.offsetWidth-this.overResizeWidth},domousemove:function(e){var o=this.overRightResizeArea(e)?"e-resize":this.overLeftResizeArea(e)?"w-resize":"";o&&!this.canResize(e)&&(o="not-allowed"),e.sourceView.headerNode.style.cursor=o||""},domousedown:function(e){dojox.grid.drag.dragging||(this.overRightResizeArea(e)||this.overLeftResizeArea(e))&&this.canResize(e)&&this.beginColumnResize(e)},doclick:function(e){return(new Date).getTime()<this.bogusClickTime?(dojo.stopEvent(e),!0):void 0},beginColumnResize:function(e){dojo.stopEvent(e);for(var o,t=[],i=this.tableMap.findOverlappingNodes(e.cellNode),r=0;o=i[r];r++)t.push({node:o,index:this.getCellNodeIndex(o),width:o.offsetWidth});var d={view:e.sourceView,node:e.cellNode,index:e.cellIndex,w:e.cellNode.clientWidth,spanners:t};dojox.grid.drag.start(e.cellNode,dojo.hitch(this,"doResizeColumn",d),dojo.hitch(this,"endResizeColumn",d),e)},doResizeColumn:function(e,o){var t=e.w+o.deltaX;if(t>=this.minColWidth){for(var i,r,d=0;i=e.spanners[d];d++)r=i.width+o.deltaX,i.node.style.width=r+"px",e.view.setColWidth(i.index,r);e.node.style.width=t+"px",e.view.setColWidth(e.index,t)}if(e.view.flexCells&&!e.view.testFlexCells()){var n=dojox.grid.findTable(e.node);n&&(n.style.width="")}},endResizeColumn:function(e){this.bogusClickTime=(new Date).getTime()+30,setTimeout(dojo.hitch(e.view,"update"),50)}}),dojo.declare("dojox.grid.tableMap",null,{constructor:function(e){this.mapRows(e)},map:null,mapRows:function(e){var o=e.length;if(o){this.map=[];for(var t,i=0;t=e[i];i++)this.map[i]=[];for(var t,i=0;t=e[i];i++)for(var r,d,n,l=0,s=0;r=t[l];l++){for(;this.map[i][s];)s++;this.map[i][s]={c:l,r:i},n=r.rowSpan||1,d=r.colSpan||1;for(var a=0;n>a;a++)for(var u=0;d>u;u++)this.map[i+a][s+u]=this.map[i][s];s+=d}}},dumpMap:function(){for(var e,o=0,t="";e=this.map[o];o++,t=""){for(var i,r=0;i=e[r];r++)t+=i.r+","+i.c+"   ";console.log(t)}},getMapCoords:function(e,o){for(var t,i=0;t=this.map[i];i++)for(var r,d=0;r=t[d];d++)if(r.c==o&&r.r==e)return{j:i,i:d};return{j:-1,i:-1}},getNode:function(e,o,t){var i=e&&e.rows[o];return i&&i.cells[t]},_findOverlappingNodes:function(inTable,inRow,inCol){for(var row,nodes=[],m=this.getMapCoords(inRow,inCol),row=this.map[m.j],j=0;row=this.map[j];j++)if(j!=m.j)with(row[m.i]){var n=this.getNode(inTable,r,c);n&&nodes.push(n)}return nodes},findOverlappingNodes:function(e){return this._findOverlappingNodes(dojox.grid.findTable(e),dojox.grid.getTrIndex(e.parentNode),dojox.grid.getTdIndex(e))}}),dojox.grid.rowIndexTag="gridRowIndex");