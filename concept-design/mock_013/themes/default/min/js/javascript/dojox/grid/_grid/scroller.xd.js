dojo._xdResourceLoaded({depends:[["provide","dojox.grid._grid.scroller"]],defineResource:function(e){e._hasResource["dojox.grid._grid.scroller"]||(e._hasResource["dojox.grid._grid.scroller"]=!0,e.provide("dojox.grid._grid.scroller"),e.declare("dojox.grid.scroller.base",null,{constructor:function(){this.pageHeights=[],this.stack=[]},rowCount:0,defaultRowHeight:10,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,lastVisibleRow:0,page:0,pageTop:0,init:function(t,i,o){switch(arguments.length){case 3:this.rowsPerPage=o;case 2:this.keepRows=i;case 1:this.rowCount=t}this.defaultPageHeight=this.defaultRowHeight*this.rowsPerPage,this.pageCount=Math.ceil(this.rowCount/this.rowsPerPage),this.keepPages=Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2),this.invalidate(),this.scrollboxNode&&(this.scrollboxNode.scrollTop=0,this.scroll(0),this.scrollboxNode.onscroll=e.hitch(this,"onscroll"))},invalidate:function(){this.invalidateNodes(),this.pageHeights=[],this.height=this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0,this.resize()},updateRowCount:function(e){if(this.invalidateNodes(),this.rowCount=e,oldPageCount=this.pageCount,this.pageCount=Math.ceil(this.rowCount/this.rowsPerPage),this.pageCount<oldPageCount)for(var t=oldPageCount-1;t>=this.pageCount;t--)this.height-=this.getPageHeight(t),delete this.pageHeights[t];else this.pageCount>oldPageCount&&(this.height+=this.defaultPageHeight*(this.pageCount-oldPageCount-1)+this.calcLastPageHeight());this.resize()},pageExists:function(){},measurePage:function(){},positionPage:function(){},repositionPages:function(){},installPage:function(){},preparePage:function(){},renderPage:function(){},removePage:function(){},pacify:function(){},pacifying:!1,pacifyTicks:200,setPacifying:function(e){this.pacifying!=e&&(this.pacifying=e,this.pacify(this.pacifying))},startPacify:function(){this.startPacifyTicks=(new Date).getTime()},doPacify:function(){var e=(new Date).getTime()-this.startPacifyTicks>this.pacifyTicks;return this.setPacifying(!0),this.startPacify(),e},endPacify:function(){this.setPacifying(!1)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight),dojox.grid.setStyleHeightPx(this.contentNode,this.height)},calcLastPageHeight:function(){if(!this.pageCount)return 0;var e=this.pageCount-1,t=(this.rowCount%this.rowsPerPage||this.rowsPerPage)*this.defaultRowHeight;return this.pageHeights[e]=t,t},updateContentHeight:function(e){this.height+=e,this.resize()},updatePageHeight:function(e){if(this.pageExists(e)){var t=this.getPageHeight(e),i=this.measurePage(e)||t;this.pageHeights[e]=i,i&&t!=i&&(this.updateContentHeight(i-t),this.repositionPages(e))}},rowHeightChanged:function(e){this.updatePageHeight(Math.floor(e/this.rowsPerPage))},invalidateNodes:function(){for(;this.stack.length;)this.destroyPage(this.popPage())},createPageNode:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.left="0",e},getPageHeight:function(e){var t=this.pageHeights[e];return void 0!==t?t:this.defaultPageHeight},pushPage:function(e){return this.stack.push(e)},popPage:function(){return this.stack.shift()},findPage:function(e){for(var t=0,i=0,o=0;t<this.pageCount&&(o=this.getPageHeight(t),!(i+o>=e));t++,i+=o);this.page=t,this.pageTop=i},buildPage:function(e,t,i){this.preparePage(e,t),this.positionPage(e,i),this.installPage(e),this.renderPage(e),this.pushPage(e)},needPage:function(e,t){var i=this.getPageHeight(e),o=i;return this.pageExists(e)?this.positionPage(e,t):(this.buildPage(e,this.keepPages&&this.stack.length>=this.keepPages,t),i=this.measurePage(e)||i,this.pageHeights[e]=i,i&&o!=i&&this.updateContentHeight(i-o)),i},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop)},scroll:function(e){this.startPacify(),this.findPage(e);for(var t=this.height,i=this.getScrollBottom(e),o=this.page,s=this.pageTop;o<this.pageCount&&(0>i||i>s);o++)s+=this.needPage(o,s);this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,e),this.lastVisibleRow=this.getLastVisibleRow(o-1,s,i),t!=this.height&&this.repositionPages(o-1),this.endPacify()},getScrollBottom:function(e){return this.windowHeight>=0?e+this.windowHeight:-1},processNodeEvent:function(e,t){for(var i=e.target;i&&i!=t&&i.parentNode&&i.parentNode.parentNode!=t;)i=i.parentNode;if(!i||!i.parentNode||i.parentNode.parentNode!=t)return!1;var o=i.parentNode;return e.topRowIndex=o.pageIndex*this.rowsPerPage,e.rowIndex=e.topRowIndex+dojox.grid.indexInParent(i),e.rowTarget=i,!0},processEvent:function(e){return this.processNodeEvent(e,this.contentNode)},dummy:0}),e.declare("dojox.grid.scroller",dojox.grid.scroller.base,{constructor:function(){this.pageNodes=[]},renderRow:function(){},removeRow:function(){},getDefaultNodes:function(){return this.pageNodes},getDefaultPageNode:function(e){return this.getDefaultNodes()[e]},positionPageNode:function(e,t){e.style.top=t+"px"},getPageNodePosition:function(e){return e.offsetTop},repositionPageNodes:function(e,t){for(var i=0,o=0;o<this.stack.length;o++)i=Math.max(this.stack[o],i);for(var s=t[e],n=s?this.getPageNodePosition(s)+this.getPageHeight(e):0,a=e+1;i>=a;a++){if(s=t[a]){if(this.getPageNodePosition(s)==n)return;this.positionPage(a,n)}n+=this.getPageHeight(a)}},invalidatePageNode:function(e,t){var i=t[e];return i&&(delete t[e],this.removePage(e,i),dojox.grid.cleanNode(i),i.innerHTML=""),i},preparePageNode:function(e,t,i){var o=null===t?this.createPageNode():this.invalidatePageNode(t,i);o.pageIndex=e,o.id="page-"+e,i[e]=o},pageExists:function(e){return Boolean(this.getDefaultPageNode(e))},measurePage:function(e){return this.getDefaultPageNode(e).offsetHeight},positionPage:function(e,t){this.positionPageNode(this.getDefaultPageNode(e),t)},repositionPages:function(e){this.repositionPageNodes(e,this.getDefaultNodes())},preparePage:function(e,t){this.preparePageNode(e,t?this.popPage():null,this.getDefaultNodes())},installPage:function(e){this.contentNode.appendChild(this.getDefaultPageNode(e))},destroyPage:function(e){var t=this.invalidatePageNode(e,this.getDefaultNodes());dojox.grid.removeNode(t)},renderPage:function(e){for(var t=this.pageNodes[e],i=0,o=e*this.rowsPerPage;i<this.rowsPerPage&&o<this.rowCount;i++,o++)this.renderRow(o,t)},removePage:function(e){for(var t=0,i=e*this.rowsPerPage;t<this.rowsPerPage;t++,i++)this.removeRow(i)},getPageRow:function(e){return e*this.rowsPerPage},getLastPageRow:function(e){return Math.min(this.rowCount,this.getPageRow(e+1))-1},getFirstVisibleRowNodes:function(e,t,i,o){for(var s=this.getPageRow(e),n=dojox.grid.divkids(o[e]),a=0,r=n.length;r>a&&i>t;a++,s++)t+=n[a].offsetHeight;return s?s-1:s},getFirstVisibleRow:function(e,t,i){return this.pageExists(e)?this.getFirstVisibleRowNodes(e,t,i,this.getDefaultNodes()):0},getLastVisibleRowNodes:function(e,t,i,o){for(var s=this.getLastPageRow(e),n=dojox.grid.divkids(o[e]),a=n.length-1;a>=0&&t>i;a--,s--)t-=n[a].offsetHeight;return s+1},getLastVisibleRow:function(e,t,i){return this.pageExists(e)?this.getLastVisibleRowNodes(e,t,i,this.getDefaultNodes()):0},findTopRowForNodes:function(e,t){for(var i,o=dojox.grid.divkids(t[this.page]),s=0,n=o.length,a=this.pageTop;n>s;s++)if(i=o[s].offsetHeight,a+=i,a>=e)return this.offset=i-(a-e),s+this.page*this.rowsPerPage;return-1},findScrollTopForNodes:function(e,t){for(var i=Math.floor(e/this.rowsPerPage),o=0,s=0;i>s;s++)o+=this.getPageHeight(s);this.pageTop=o,this.needPage(i,this.pageTop);for(var n=dojox.grid.divkids(t[i]),a=e-this.rowsPerPage*i,s=0,r=n.length;r>s&&a>s;s++)o+=n[s].offsetHeight;return o},findTopRow:function(e){return this.findTopRowForNodes(e,this.getDefaultNodes())},findScrollTop:function(e){return this.findScrollTopForNodes(e,this.getDefaultNodes())},dummy:0}),e.declare("dojox.grid.scroller.columns",dojox.grid.scroller,{constructor:function(e){this.setContentNodes(e)},setContentNodes:function(e){this.contentNodes=e,this.colCount=this.contentNodes?this.contentNodes.length:0,this.pageNodes=[];for(var t=0;t<this.colCount;t++)this.pageNodes[t]=[]},getDefaultNodes:function(){return this.pageNodes[0]||[]},scroll:function(e){this.colCount&&dojox.grid.scroller.prototype.scroll.call(this,e)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight);for(var e=0;e<this.colCount;e++)dojox.grid.setStyleHeightPx(this.contentNodes[e],this.height)},positionPage:function(e,t){for(var i=0;i<this.colCount;i++)this.positionPageNode(this.pageNodes[i][e],t)},preparePage:function(e,t){for(var i=t?this.popPage():null,o=0;o<this.colCount;o++)this.preparePageNode(e,i,this.pageNodes[o])},installPage:function(e){for(var t=0;t<this.colCount;t++)this.contentNodes[t].appendChild(this.pageNodes[t][e])},destroyPage:function(e){for(var t=0;t<this.colCount;t++)dojox.grid.removeNode(this.invalidatePageNode(e,this.pageNodes[t]))},renderPage:function(e){for(var t=[],i=0;i<this.colCount;i++)t[i]=this.pageNodes[i][e];for(var i=0,o=e*this.rowsPerPage;i<this.rowsPerPage&&o<this.rowCount;i++,o++)this.renderRow(o,t)}}))}});