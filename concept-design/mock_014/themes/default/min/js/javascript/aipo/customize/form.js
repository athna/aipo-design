dojo.provide("aipo.customize.form"),aipo.customize.positionInitialize=function(){dojo.query(".body-child").forEach(function(e){dojo.place(e,dojo.query("body")[0],"last")})},aipo.customize.onReceiveMessage=function(e){if(!e){var o=dijit.byId("modalDialog");o&&o.hide()}dojo.byId("messageDiv")&&(dojo.byId("messageDiv").innerHTML=e)},aipo.customize.showMenu=function(e){var o=dojo.query("#menubar_"+e),t=dojo.query("#menubar_button_"+e);if(0!=o.length&&0!=t.length){var n=t[0].getBoundingClientRect(),i=document.documentElement.getBoundingClientRect();if("none"==o.style("display")){dojo.query("div.menubar").style("display","none");var l={left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop};o.style("opacity","0"),o.style("display","block"),o.style("position","absolute"),i.right-o[0].clientWidth>n.left?o.style("left",n.left+l.left+"px"):o.style("left",n.right-o[0].clientWidth+l.left+"px"),i.bottom-o[0].clientHeight>n.bottom?o.style("top",n.bottom+l.top+"px"):i.bottom<=0?o.style("top",n.bottom+l.top+"px"):n.top-o[0].clientHeight+l.top<0?o.style("top",n.bottom+l.top+"px"):o.style("top",n.top-o[0].clientHeight+l.top+"px"),o.style("opacity","1"),dojo.byId("timeline_"+e)&&1==dojo.query("div.timeline").length&&dojo.query("#accessControlDelete_"+e).style("display","none")}else aipo.customize.hideMenu(e)}},aipo.customize.showMenuForTab=function(e){var o=dojo.query("#menubar_"+e),t=dojo.query("#menubar_button_"+e);if(0!=o.length&&0!=t.length){var n=t[0].getBoundingClientRect(),i=document.documentElement.getBoundingClientRect();if("none"==o.style("display")){dojo.query("div.menubar").style("display","none");var l={left:document.documentElement.scrollLeft||document.body.scrollLeft,top:document.documentElement.scrollTop||document.body.scrollTop};o.style("opacity","0"),o.style("display","block"),o.style("position","absolute"),i.right-o[0].clientWidth>n.left?o.style("left",n.left+l.left+"px"):o.style("left",n.right-o[0].clientWidth+l.left+"px"),o.style("top",n.bottom+l.top+"px"),o.style("opacity","1")}else aipo.customize.hideMenu(e)}},aipo.customize.showMenuButtonOnly=function(e){var o=dojo.query("#menubar_"+e);"none"==o.style("display")?(o.style("display","block"),o.style("opacity","1")):(o.style("display","none"),o.style("opacity","0"))};var current_portlet_id=null;aipo.customize.refixMenuScheduleQueue=null,aipo.customize.refixMenuScheduleListener=null,aipo.customize.showMenuSchedule=function(e){current_portlet_id=null;var o=dojo.query("#menubar_"+e+"_date");"none"==o.style("display")?(dojo.query("div.menubar").style("display","none"),o.style("display","block"),aipo.customize.refixMenuSchedule(e),aipo.customize.refixMenuScheduleListener&&(dojo.disconnect(aipo.customize.refixMenuScheduleListener),aipo.customize.refixMenuScheduleListener=null),aipo.customize.refixMenuScheduleListener=dojo.connect(window,"onresize",function(){clearTimeout(aipo.customize.refixMenuScheduleQueue),aipo.customize.refixMenuScheduleQueue=setTimeout(function(){aipo.customize.refixMenuSchedule(e)},200)})):aipo.customize.hideMenu(e)},aipo.customize.refixMenuSchedule=function(e){var o,t,n=dojo.query("#menubar_"+e+"_date");dojo.byId("timeline_"+e)&&1==dojo.query("div.timeline").length&&dojo.query("#accessControlDelete_"+e).style("display","none");var i=dojo.byId("indicateDate_"+e);if(dojo.isIE){var l=function(e){for(var o=0;e;)o+=e.offsetLeft,e=e.offsetParent;return o},u=function(e){for(var o=0;e;)o+=e.offsetTop,e=e.offsetParent;return o};o=l(i),t=u(i),dojo.query(".relativeBlock").style("z-index","9999"),dojo.query("#tableWrapper_"+e).style("z-index","1"),current_portlet_id=e}else o=i.getBoundingClientRect().left,t=i.getBoundingClientRect().top;n.style("left",o+"px"),n.style("top",t+i.offsetHeight+"px")},aipo.customize.hideMenu=function(){var e=(dojo.query("div.menubar").style("display","none"),document.getElementById("subNavigation"));if(e){var o=e.currentStyle||document.defaultView.getComputedStyle(e,null);if("none"==o.display){var t=document.getElementById("auiWidgetsArea");t&&(t.style.top="",t.style.position="fixed")}}null!=current_portlet_id&&(dojo.query(".relativeBlock").style("z-index",""),dojo.query("#tableWrapper_"+current_portlet_id).style("z-index",""))},aipo.customize.setController=function(e,o){var t=o.parentNode.id;dojo.query("form#form"+e+' input[name="controller"]')[0].value=t;for(var n=dojo.query("form#form"+e+" table.controllerTable td"),i=n.length,l=0;i>l;l++)dojo.removeClass(n[l],"selected");var u=dojo.query("form#form"+e+" td#"+t)[0];dojo.addClass(u,"selected")},aipo.customize.deletesubmit=function(e,o,t){confirm("このアプリを削除してもよろしいですか？")&&aipo.customize.submit(e,o,t)},aipo.customize.deleteTabSubmit=function(e,o,t){confirm("このページを削除してもよろしいですか？")&&aipo.customize.submit(e,o,t)},aipo.customize.submit=function(e,o,t){try{dojo.xhrPost({url:e,timeout:3e4,content:{portlet_id:o},encoding:"utf-8",handleAs:"json-comment-filtered",headers:{X_REQUESTED_WITH:"XMLHttpRequest"},load:function(e){var o="";dojo.isArray(e)&&e.length>0&&("PermissionError"==e[0]?(o+="<ul>",o+="<li><span class='caution'>"+e[1]+"</span></li>",o+="</ul>"):(o+="<ul>",dojo.forEach(e,function(e){o+="<li><span class='caution'>"+e+"</span></li>"}),o+="</ul>")),t.call(t,o),""!=o&&aimluck.io.disableForm(form,!1)},error:function(){}})}catch(n){}};var bodyHandle=bodyHandle||{};aipo.customize.addAutoHideMenuTrigger=function(){dojo.query("a.customizeMenuIcon,a.menubarOpenButton").forEach(function(e){dojo.connect(e,"onmouseenter",null,function(){dojo.addClass(this,"customizeMenuIconMouseenter")}),dojo.connect(e,"onmouseleave",null,function(){dojo.removeClass(this,"customizeMenuIconMouseenter")})}),bodyHandle=dojo.connect(dojo.query("body")[0],"onclick",null,function(){0==dojo.query("a.customizeMenuIconMouseenter").length&&aipo.customize.hideMenu()})};