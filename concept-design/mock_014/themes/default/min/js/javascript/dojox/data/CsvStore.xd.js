dojo._xdResourceLoaded({depends:[["provide","dojox.data.CsvStore"],["require","dojo.data.util.filter"],["require","dojo.data.util.simpleFetch"]],defineResource:function(t){t._hasResource["dojox.data.CsvStore"]||(t._hasResource["dojox.data.CsvStore"]=!0,t.provide("dojox.data.CsvStore"),t.require("dojo.data.util.filter"),t.require("dojo.data.util.simpleFetch"),t.declare("dojox.data.CsvStore",null,{constructor:function(t){this._attributes=[],this._attributeIndexes={},this._dataArray=[],this._arrayOfAllItems=[],this._loadFinished=!1,t.url&&(this.url=t.url),this._csvData=t.data,t.label?this.label=t.label:""===this.label&&(this.label=void 0),this._storeProp="_csvStore",this._idProp="_csvId",this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0},this._loadInProgress=!1,this._queuedFetches=[]},url:"",label:"",_assertIsItem:function(t){if(!this.isItem(t))throw new Error("dojox.data.CsvStore: a function was passed an item argument that was not an item")},_assertIsAttribute:function(e){if(!t.isString(e))throw new Error("dojox.data.CsvStore: a function was passed an attribute argument that was not an attribute object nor an attribute name string")},getValue:function(t,e,r){this._assertIsItem(t),this._assertIsAttribute(e);var s=r;if(this.hasAttribute(t,e)){var a=this._dataArray[this.getIdentity(t)];s=a[this._attributeIndexes[e]]}return s},getValues:function(t,e){var r=this.getValue(t,e);return r?[r]:[]},getAttributes:function(t){this._assertIsItem(t);for(var e=[],r=this._dataArray[this.getIdentity(t)],s=0;s<r.length;s++)""!=r[s]&&e.push(this._attributes[s]);return e},hasAttribute:function(t,e){this._assertIsItem(t),this._assertIsAttribute(e);var r=this._attributeIndexes[e],s=this._dataArray[this.getIdentity(t)];return"undefined"!=typeof r&&r<s.length&&""!=s[r]},containsValue:function(e,r,s){var a=void 0;return"string"==typeof s&&(a=t.data.util.filter.patternToRegExp(s,!1)),this._containsValue(e,r,s,a)},_containsValue:function(t,e,r,s){for(var a=this.getValues(t,e),i=0;i<a.length;++i){var n=a[i];if("string"==typeof n&&s)return null!==n.match(s);if(r===n)return!0}return!1},isItem:function(t){if(t&&t[this._storeProp]===this){var e=t[this._idProp];if(e>=0&&e<this._dataArray.length)return!0}return!1},isItemLoaded:function(t){return this.isItem(t)},loadItem:function(){},getFeatures:function(){return this._features},getLabel:function(t){return this.label&&this.isItem(t)?this.getValue(t,this.label):void 0},getLabelAttributes:function(){return this.label?[this.label]:null},_fetchItems:function(e,r){var s=this,a=function(e,a){var i=null;if(e.query){i=[];var n=e.queryOptions?e.queryOptions.ignoreCase:!1,o={};for(var l in e.query){var h=e.query[l];"string"==typeof h&&(o[l]=t.data.util.filter.patternToRegExp(h,n))}for(var u=0;u<a.length;++u){var d=!0,c=a[u];for(var l in e.query){var h=e.query[l];s._containsValue(c,l,h,o[l])||(d=!1)}d&&i.push(c)}}else a.length>0&&(i=a.slice(0,a.length));r(i,e)};if(this._loadFinished)a(e,this._arrayOfAllItems);else if(""!==this.url)if(this._loadInProgress)this._queuedFetches.push({args:e,filter:a});else{this._loadInProgress=!0;var i={url:s.url,handleAs:"text"},n=t.xhrGet(i);n.addCallback(function(t){s._processData(t),a(e,s._arrayOfAllItems),s._handleQueuedFetches()}),n.addErrback(function(t){throw s._loadInProgress=!1,t})}else{if(!this._csvData)throw new Error("dojox.data.CsvStore: No CSV source data was provided as either URL or String data input.");this._processData(this._csvData),this._csvData=null,a(e,this._arrayOfAllItems)}},close:function(){},_getArrayOfArraysFromCsvFileContents:function(e){if(t.isString(e)){for(var r=new RegExp("\r\n|\n|\r"),s=new RegExp("^\\s+","g"),a=new RegExp("\\s+$","g"),i=new RegExp('""',"g"),n=[],o=e.split(r),l=0;l<o.length;++l){var h=o[l];if(h.length>0){for(var u=h.split(","),d=0;d<u.length;){var c=u[d],f=c.replace(s,""),_=f.replace(a,""),g=_.charAt(0),I=_.charAt(_.length-1),v=_.charAt(_.length-2),p=_.charAt(_.length-3);if(2===_.length&&'""'==_)u[d]="";else if('"'==g&&('"'!=I||'"'==I&&'"'==v&&'"'!=p)){if(d+1===u.length)return null;var m=u[d+1];u[d]=f+","+m,u.splice(d+1,1)}else'"'==g&&'"'==I&&(_=_.slice(1,_.length-1),_=_.replace(i,'"')),u[d]=_,d+=1}n.push(u)}}this._attributes=n.shift();for(var l=0;l<this._attributes.length;l++)this._attributeIndexes[this._attributes[l]]=l;this._dataArray=n}},_processData:function(t){this._getArrayOfArraysFromCsvFileContents(t),this._arrayOfAllItems=[];for(var e=0;e<this._dataArray.length;e++)this._arrayOfAllItems.push(this._createItemFromIdentity(e));this._loadFinished=!0,this._loadInProgress=!1},_createItemFromIdentity:function(t){var e={};return e[this._storeProp]=this,e[this._idProp]=t,e},getIdentity:function(t){return this.isItem(t)?t[this._idProp]:null},fetchItemByIdentity:function(e){if(this._loadFinished){var r=this._createItemFromIdentity(e.identity);if(this.isItem(r)||(r=null),e.onItem){var s=e.scope?e.scope:t.global;e.onItem.call(s,r)}}else{var a=this;if(""!==this.url)if(this._loadInProgress)this._queuedFetches.push({args:e});else{this._loadInProgress=!0;var i={url:a.url,handleAs:"text"},n=t.xhrGet(i);n.addCallback(function(r){var s=e.scope?e.scope:t.global;try{a._processData(r);var i=a._createItemFromIdentity(e.identity);a.isItem(i)||(i=null),e.onItem&&e.onItem.call(s,i),a._handleQueuedFetches()}catch(n){e.onError&&e.onError.call(s,n)}}),n.addErrback(function(r){if(this._loadInProgress=!1,e.onError){var s=e.scope?e.scope:t.global;e.onError.call(s,r)}})}else if(this._csvData){a._processData(a._csvData),a._csvData=null;var r=a._createItemFromIdentity(e.identity);if(a.isItem(r)||(r=null),e.onItem){var s=e.scope?e.scope:t.global;e.onItem.call(s,r)}}}},getIdentityAttributes:function(){return null},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var t=0;t<this._queuedFetches.length;t++){var e=this._queuedFetches[t],r=e.filter,s=e.args;r?r(s,this._arrayOfAllItems):this.fetchItemByIdentity(e.args)}this._queuedFetches=[]}}}),t.extend(dojox.data.CsvStore,t.data.util.simpleFetch))}});