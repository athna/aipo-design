dojo._xdResourceLoaded({depends:[["provide","dojox.gfx3d.object"],["require","dojox.gfx"],["require","dojox.gfx3d.lighting"],["require","dojox.gfx3d.scheduler"],["require","dojox.gfx3d.vector"],["require","dojox.gfx3d.gradient"]],defineResource:function(t){if(!t._hasResource["dojox.gfx3d.object"]){t._hasResource["dojox.gfx3d.object"]=!0,t.provide("dojox.gfx3d.object"),t.require("dojox.gfx"),t.require("dojox.gfx3d.lighting"),t.require("dojox.gfx3d.scheduler"),t.require("dojox.gfx3d.vector"),t.require("dojox.gfx3d.gradient");t.declare("dojox.gfx3d.Object",null,{constructor:function(){this.object=null,this.matrix=null,this.cache=null,this.renderer=null,this.parent=null,this.strokeStyle=null,this.fillStyle=null,this.shape=null},setObject:function(t){return this.object=dojox.gfx.makeParameters(this.object,t),this},setTransform:function(t){return this.matrix=dojox.gfx3d.matrix.clone(t?dojox.gfx3d.matrix.normalize(t):dojox.gfx3d.identity,!0),this},applyRightTransform:function(t){return t?this.setTransform([this.matrix,t]):this},applyLeftTransform:function(t){return t?this.setTransform([t,this.matrix]):this},applyTransform:function(t){return t?this.setTransform([this.matrix,t]):this},setFill:function(t){return this.fillStyle=t,this},setStroke:function(t){return this.strokeStyle=t,this},toStdFill:function(t,e){return this.fillStyle&&"undefined"!=typeof this.fillStyle.type?t[this.fillStyle.type](e,this.fillStyle.finish,this.fillStyle.color):this.fillStyle},invalidate:function(){this.renderer.addTodo(this)},destroy:function(){if(this.shape){var t=this.shape.getParent();t&&t.remove(this.shape),this.shape=null}},render:function(){throw"Pure virtual function, not implemented"},draw:function(){throw"Pure virtual function, not implemented"},getZOrder:function(){return 0},getOutline:function(){return null}}),t.declare("dojox.gfx3d.Scene",dojox.gfx3d.Object,{constructor:function(){this.objects=[],this.todos=[],this.schedule=dojox.gfx3d.scheduler.zOrder,this._draw=dojox.gfx3d.drawer.conservative},setFill:function(e){return this.fillStyle=e,t.forEach(this.objects,function(t){t.setFill(e)}),this},setStroke:function(e){return this.strokeStyle=e,t.forEach(this.objects,function(t){t.setStroke(e)}),this},render:function(e,i){var o=dojox.gfx3d.matrix.multiply(e,this.matrix);i&&(this.todos=this.objects),t.forEach(this.todos,function(t){t.render(o,i)})},draw:function(){this.objects=this.schedule(this.objects),this._draw(this.todos,this.objects,this.renderer)},addTodo:function(e){t.every(this.todos,function(t){return t!=e})&&(this.todos.push(e),this.invalidate())},invalidate:function(){this.parent.addTodo(this)},getZOrder:function(){var e=0;return t.forEach(this.objects,function(t){e+=t.getZOrder()}),this.objects.length>1?e/this.objects.length:0}}),t.declare("dojox.gfx3d.Edges",dojox.gfx3d.Object,{constructor:function(){this.object=t.clone(dojox.gfx3d.defaultEdges)},setObject:function(t,e){return this.object=dojox.gfx.makeParameters(this.object,t instanceof Array?{points:t,style:e}:t),this},getZOrder:function(){var e=0;return t.forEach(this.cache,function(t){e+=t.z}),this.cache.length>1?e/this.cache.length:0},render:function(e){var i=dojox.gfx3d.matrix.multiply(e,this.matrix);this.cache=t.map(this.object.points,function(t){return dojox.gfx3d.matrix.multiplyPoint(i,t)})},draw:function(){var e=this.cache;this.shape?this.shape.setShape(""):this.shape=this.renderer.createPath();var i=this.shape.setAbsoluteMode("absolute");if("strip"==this.object.style||"loop"==this.object.style)i.moveTo(e[0].x,e[0].y),t.forEach(e.slice(1),function(t){i.lineTo(t.x,t.y)}),"loop"==this.object.style&&i.closePath();else for(var o=0;o<this.cache.length;)i.moveTo(e[o].x,e[o].y),o++,i.lineTo(e[o].x,e[o].y),o++;i.setStroke(this.strokeStyle)}}),t.declare("dojox.gfx3d.Orbit",dojox.gfx3d.Object,{constructor:function(){this.object=t.clone(dojox.gfx3d.defaultOrbit)},render:function(e){var i=dojox.gfx3d.matrix.multiply(e,this.matrix),o=[0,Math.PI/4,Math.PI/3],r=dojox.gfx3d.matrix.multiplyPoint(i,this.object.center),s=t.map(o,function(t){return{x:this.center.x+this.radius*Math.cos(t),y:this.center.y+this.radius*Math.sin(t),z:this.center.z}},this.object);s=t.map(s,function(t){return dojox.gfx3d.matrix.multiplyPoint(i,t)});var n=dojox.gfx3d.vector.normalize(s);s=t.map(s,function(t){return dojox.gfx3d.vector.substract(t,r)});var h={xx:s[0].x*s[0].y,xy:s[0].y*s[0].y,xz:1,yx:s[1].x*s[1].y,yy:s[1].y*s[1].y,yz:1,zx:s[2].x*s[2].y,zy:s[2].y*s[2].y,zz:1,dx:0,dy:0,dz:0},a=t.map(s,function(t){return-Math.pow(t.x,2)}),c=dojox.gfx3d.matrix.multiplyPoint(dojox.gfx3d.matrix.invert(h),a[0],a[1],a[2]),d=Math.atan2(c.x,1-c.y)/2,x=t.map(s,function(t){return dojox.gfx.matrix.multiplyPoint(dojox.gfx.matrix.rotate(-d),t.x,t.y)}),l=Math.pow(x[0].x,2),a=Math.pow(x[0].y,2),u=Math.pow(x[1].x,2),f=Math.pow(x[1].y,2),g=Math.sqrt((l*f-a*u)/(f-a)),j=Math.sqrt((l*f-a*u)/(l-u));this.cache={cx:r.x,cy:r.y,rx:g,ry:j,theta:d,normal:n}},draw:function(t){this.shape?this.shape.setShape(this.cache):this.shape=this.renderer.createEllipse(this.cache),this.shape.applyTransform(dojox.gfx.matrix.rotateAt(this.cache.theta,this.cache.cx,this.cache.cy)).setStroke(this.strokeStyle).setFill(this.toStdFill(t,this.cache.normal))}}),t.declare("dojox.gfx3d.Path3d",dojox.gfx3d.Object,{constructor:function(){this.object=t.clone(dojox.gfx3d.defaultPath3d),this.segments=[],this.absolute=!0,this.last={},this.path=""},_collectArgs:function(t,e){for(var i=0;i<e.length;++i){var o=e[i];"boolean"==typeof o?t.push(o?1:0):"number"==typeof o?t.push(o):o instanceof Array?this._collectArgs(t,o):"x"in o&&"y"in o&&(t.push(o.x),t.push(o.y))}},_validSegments:{m:3,l:3,z:0},_pushSegment:function(t,e){var i=this._validSegments[t.toLowerCase()];if("number"==typeof i)if(i){if(e.length>=i){var o={action:t,args:e.slice(0,e.length-e.length%i)};this.segments.push(o)}}else{var o={action:t,args:[]};this.segments.push(o)}},moveTo:function(){var t=[];return this._collectArgs(t,arguments),this._pushSegment(this.absolute?"M":"m",t),this},lineTo:function(){var t=[];return this._collectArgs(t,arguments),this._pushSegment(this.absolute?"L":"l",t),this},closePath:function(){return this._pushSegment("Z",[]),this},render:function(e){var i=dojox.gfx3d.matrix.multiply(e,this.matrix),o="",r=this._validSegments;t.forEach(this.segments,function(t){o+=t.action;for(var e=0;e<t.args.length;e+=r[t.action.toLowerCase()]){var s=dojox.gfx3d.matrix.multiplyPoint(i,t.args[e],t.args[e+1],t.args[e+2]);o+=" "+s.x+" "+s.y}}),this.cache=o},_draw:function(){return this.parent.createPath(this.cache)}}),t.declare("dojox.gfx3d.Triangles",dojox.gfx3d.Object,{constructor:function(){this.object=t.clone(dojox.gfx3d.defaultTriangles)},setObject:function(t,e){return this.object=t instanceof Array?dojox.gfx.makeParameters(this.object,{points:t,style:e}):dojox.gfx.makeParameters(this.object,t),this},render:function(e){var i=dojox.gfx3d.matrix.multiply(e,this.matrix),o=t.map(this.object.points,function(t){return dojox.gfx3d.matrix.multiplyPoint(i,t)});this.cache=[];var r=o.slice(0,2),s=o[0];if("strip"==this.object.style)t.forEach(o.slice(2),function(t){r.push(t),r.push(r[0]),this.cache.push(r),r=r.slice(1,3)},this);else if("fan"==this.object.style)t.forEach(o.slice(2),function(t){r.push(t),r.push(s),this.cache.push(r),r=[s,t]},this);else for(var n=0;n<o.length;)this.cache.push([o[n],o[n+1],o[n+2],o[n]]),n+=3},draw:function(e){this.cache=dojox.gfx3d.scheduler.bsp(this.cache,function(t){return t}),this.shape?this.shape.clear():this.shape=this.renderer.createGroup(),t.forEach(this.cache,function(t){this.shape.createPolyline(t).setStroke(this.strokeStyle).setFill(this.toStdFill(e,dojox.gfx3d.vector.normalize(t)))},this)},getZOrder:function(){var e=0;return t.forEach(this.cache,function(t){e+=(t[0].z+t[1].z+t[2].z)/3}),this.cache.length>1?e/this.cache.length:0}}),t.declare("dojox.gfx3d.Quads",dojox.gfx3d.Object,{constructor:function(){this.object=t.clone(dojox.gfx3d.defaultQuads)},setObject:function(t,e){return this.object=dojox.gfx.makeParameters(this.object,t instanceof Array?{points:t,style:e}:t),this},render:function(e){var i=dojox.gfx3d.matrix.multiply(e,this.matrix),o=t.map(this.object.points,function(t){return dojox.gfx3d.matrix.multiplyPoint(i,t)});if(this.cache=[],"strip"==this.object.style)for(var r=o.slice(0,2),s=2;s<o.length;)r=r.concat([o[s],o[s+1],r[0]]),this.cache.push(r),r=r.slice(2,4),s+=2;else for(var s=0;s<o.length;)this.cache.push([o[s],o[s+1],o[s+2],o[s+3],o[s]]),s+=4},draw:function(t){this.cache=dojox.gfx3d.scheduler.bsp(this.cache,function(t){return t}),this.shape?this.shape.clear():this.shape=this.renderer.createGroup();for(var e=0;e<this.cache.length;e++)this.shape.createPolyline(this.cache[e]).setStroke(this.strokeStyle).setFill(this.toStdFill(t,dojox.gfx3d.vector.normalize(this.cache[e])))},getZOrder:function(){for(var t=0,e=0;e<this.cache.length;e++){var i=this.cache[e];t+=(i[0].z+i[1].z+i[2].z+i[3].z)/4}return this.cache.length>1?t/this.cache.length:0}}),t.declare("dojox.gfx3d.Polygon",dojox.gfx3d.Object,{constructor:function(){this.object=t.clone(dojox.gfx3d.defaultPolygon)},setObject:function(t){return this.object=dojox.gfx.makeParameters(this.object,t instanceof Array?{path:t}:t),this},render:function(e){var i=dojox.gfx3d.matrix.multiply(e,this.matrix);this.cache=t.map(this.object.path,function(t){return dojox.gfx3d.matrix.multiplyPoint(i,t)}),this.cache.push(this.cache[0])},draw:function(t){this.shape?this.shape.setShape({points:this.cache}):this.shape=this.renderer.createPolyline({points:this.cache}),this.shape.setStroke(this.strokeStyle).setFill(this.toStdFill(t,dojox.gfx3d.matrix.normalize(this.cache)))},getZOrder:function(){for(var t=0,e=0;e<this.cache.length;e++)t+=this.cache[e].z;return this.cache.length>1?t/this.cache.length:0},getOutline:function(){return this.cache.slice(0,3)}}),t.declare("dojox.gfx3d.Cube",dojox.gfx3d.Object,{constructor:function(){this.object=t.clone(dojox.gfx3d.defaultCube),this.polygons=[]},setObject:function(t){this.object=dojox.gfx.makeParameters(this.object,t)},render:function(e){var i=this.object.top,o=this.object.bottom,r={x:o.x,y:i.y,z:i.z},s={x:o.x,y:o.y,z:i.z},n={x:i.x,y:o.y,z:i.z},h={x:i.x,y:i.y,z:o.z},a={x:o.x,y:i.y,z:o.z},c={x:i.x,y:o.y,z:o.z},d=[i,r,s,n,h,a,o,c],x=dojox.gfx3d.matrix.multiply(e,this.matrix),l=t.map(d,function(t){return dojox.gfx3d.matrix.multiplyPoint(x,t)});i=l[0],r=l[1],s=l[2],n=l[3],h=l[4],a=l[5],o=l[6],c=l[7],this.cache=[[i,r,s,n,i],[h,a,o,c,h],[i,n,c,h,i],[n,s,o,c,n],[s,r,a,o,s],[r,i,h,a,r]]},draw:function(t){this.cache=dojox.gfx3d.scheduler.bsp(this.cache,function(t){return t});var e=this.cache.slice(3);this.shape?this.shape.clear():this.shape=this.renderer.createGroup();for(var i=0;i<e.length;i++)this.shape.createPolyline(e[i]).setStroke(this.strokeStyle).setFill(this.toStdFill(t,dojox.gfx3d.vector.normalize(e[i])))},getZOrder:function(){var t=this.cache[0][0],e=this.cache[1][2];return(t.z+e.z)/2}}),t.declare("dojox.gfx3d.Cylinder",dojox.gfx3d.Object,{constructor:function(){this.object=t.clone(dojox.gfx3d.defaultCylinder)},render:function(e){var i=dojox.gfx3d.matrix.multiply(e,this.matrix),o=[0,Math.PI/4,Math.PI/3],r=dojox.gfx3d.matrix.multiplyPoint(i,this.object.center),s=t.map(o,function(t){return{x:this.center.x+this.radius*Math.cos(t),y:this.center.y+this.radius*Math.sin(t),z:this.center.z}},this.object);s=t.map(s,function(t){return dojox.gfx3d.vector.substract(dojox.gfx3d.matrix.multiplyPoint(i,t),r)});var n={xx:s[0].x*s[0].y,xy:s[0].y*s[0].y,xz:1,yx:s[1].x*s[1].y,yy:s[1].y*s[1].y,yz:1,zx:s[2].x*s[2].y,zy:s[2].y*s[2].y,zz:1,dx:0,dy:0,dz:0},h=t.map(s,function(t){return-Math.pow(t.x,2)}),a=dojox.gfx3d.matrix.multiplyPoint(dojox.gfx3d.matrix.invert(n),h[0],h[1],h[2]),c=Math.atan2(a.x,1-a.y)/2,d=t.map(s,function(t){return dojox.gfx.matrix.multiplyPoint(dojox.gfx.matrix.rotate(-c),t.x,t.y)}),x=Math.pow(d[0].x,2),h=Math.pow(d[0].y,2),l=Math.pow(d[1].x,2),u=Math.pow(d[1].y,2),f=Math.sqrt((x*u-h*l)/(u-h)),g=Math.sqrt((x*u-h*l)/(x-l));if(g>f){var j=f;f=g,g=j,c-=Math.PI/2}var p=dojox.gfx3d.matrix.multiplyPoint(i,dojox.gfx3d.vector.sum(this.object.center,{x:0,y:0,z:this.object.height})),y="constant"==this.fillStyle.type?this.fillStyle.color:dojox.gfx3d.gradient(this.renderer.lighting,this.fillStyle,this.object.center,this.object.radius,Math.PI,2*Math.PI,i);(isNaN(f)||isNaN(g)||isNaN(c))&&(f=this.object.radius,g=0,c=0),this.cache={center:r,top:p,rx:f,ry:g,theta:c,gradient:y}},draw:function(){var t=this.cache,e=dojox.gfx3d.vector,i=dojox.gfx.matrix,o=[t.center,t.top],r=e.substract(t.top,t.center);e.dotProduct(r,this.renderer.lighting.incident)>0&&(o=[t.top,t.center],r=e.substract(t.center,t.top));var s=this.renderer.lighting[this.fillStyle.type](r,this.fillStyle.finish,this.fillStyle.color),n=Math.sqrt(Math.pow(t.center.x-t.top.x,2)+Math.pow(t.center.y-t.top.y,2));this.shape?this.shape.clear():this.shape=this.renderer.createGroup(),this.shape.createPath("").moveTo(0,-t.rx).lineTo(n,-t.rx).lineTo(n,t.rx).lineTo(0,t.rx).arcTo(t.ry,t.rx,0,!0,!0,0,-t.rx).setFill(t.gradient).setStroke(this.strokeStyle).setTransform([i.translate(o[0]),i.rotate(Math.atan2(o[1].y-o[0].y,o[1].x-o[0].x))]),t.rx>0&&t.ry>0&&this.shape.createEllipse({cx:o[1].x,cy:o[1].y,rx:t.rx,ry:t.ry}).setFill(s).setStroke(this.strokeStyle).applyTransform(i.rotateAt(t.theta,o[1]))}}),t.declare("dojox.gfx3d.Viewport",dojox.gfx.Group,{constructor:function(){this.dimension=null,this.objects=[],this.todos=[],this.renderer=this,this.schedule=dojox.gfx3d.scheduler.zOrder,this.draw=dojox.gfx3d.drawer.conservative,this.deep=!1,this.lights=[],this.lighting=null},setCameraTransform:function(t){return this.camera=dojox.gfx3d.matrix.clone(t?dojox.gfx3d.matrix.normalize(t):dojox.gfx3d.identity,!0),this.invalidate(),this},applyCameraRightTransform:function(t){return t?this.setCameraTransform([this.camera,t]):this},applyCameraLeftTransform:function(t){return t?this.setCameraTransform([t,this.camera]):this},applyCameraTransform:function(t){return this.applyCameraRightTransform(t)},setLights:function(t,e,i){this.lights=t instanceof Array?{sources:t,ambient:e,specular:i}:t;var o={x:0,y:0,z:1};return this.lighting=new dojox.gfx3d.lighting.Model(o,this.lights.sources,this.lights.ambient,this.lights.specular),this.invalidate(),this},addLights:function(t){return this.setLights(this.lights.sources.concat(t))},addTodo:function(e){t.every(this.todos,function(t){return t!=e})&&this.todos.push(e)},invalidate:function(){this.deep=!0,this.todos=this.objects},setDimensions:function(t){this.dimension=t?{width:"string"==typeof t.width?parseInt(t.width):t.width,height:"string"==typeof t.height?parseInt(t.height):t.height}:null},render:function(){if(0!=this.todos.length){for(var t=dojox.gfx3d.matrix,e=0;e<this.todos.length;e++)this.todos[e].render(dojox.gfx3d.matrix.normalize([t.cameraRotateXg(180),t.cameraTranslate(0,this.dimension.height,0),this.camera]),this.deep);this.objects=this.schedule(this.objects),this.draw(this.todos,this.objects,this),this.todos=[],this.deep=!1}}}),dojox.gfx3d.Viewport.nodeType=dojox.gfx.Group.nodeType,dojox.gfx3d._creators={createEdges:function(t,e){return this.create3DObject(dojox.gfx3d.Edges,t,e)},createTriangles:function(t,e){return this.create3DObject(dojox.gfx3d.Triangles,t,e)},createQuads:function(t,e){return this.create3DObject(dojox.gfx3d.Quads,t,e)},createPolygon:function(t){return this.create3DObject(dojox.gfx3d.Polygon,t)},createOrbit:function(t){return this.create3DObject(dojox.gfx3d.Orbit,t)},createCube:function(t){return this.create3DObject(dojox.gfx3d.Cube,t)},createCylinder:function(t){return this.create3DObject(dojox.gfx3d.Cylinder,t)},createPath3d:function(t){return this.create3DObject(dojox.gfx3d.Path3d,t)},createScene:function(){return this.create3DObject(dojox.gfx3d.Scene)},create3DObject:function(t,e,i){var o=new t;return this.adopt(o),e&&o.setObject(e,i),o},adopt:function(t){return t.renderer=this.renderer,t.parent=this,this.objects.push(t),this.addTodo(t),this},abandon:function(t){for(var e=0;e<this.objects.length;++e)this.objects[e]==t&&this.objects.splice(e,1);return t.parent=null,this},setScheduler:function(t){this.schedule=t},setDrawer:function(t){this.draw=t}},t.extend(dojox.gfx3d.Viewport,dojox.gfx3d._creators),t.extend(dojox.gfx3d.Scene,dojox.gfx3d._creators),delete dojox.gfx3d._creators,t.extend(dojox.gfx.Surface,{createViewport:function(){var t=this.createObject(dojox.gfx3d.Viewport,null,!0);return t.setDimensions(this.getDimensions()),t}})}}});