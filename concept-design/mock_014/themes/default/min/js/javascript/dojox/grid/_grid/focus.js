dojo._hasResource["dojox.grid._grid.focus"]||(dojo._hasResource["dojox.grid._grid.focus"]=!0,dojo.provide("dojox.grid._grid.focus"),dojo.declare("dojox.grid.focus",null,{constructor:function(t){this.grid=t,this.cell=null,this.rowIndex=-1,dojo.connect(this.grid.domNode,"onfocus",this,"doFocus")},tabbingOut:!1,focusClass:"dojoxGrid-cell-focus",focusView:null,initFocusView:function(){this.focusView=this.grid.views.getFirstScrollingView()},isFocusCell:function(t,i){return this.cell==t&&this.rowIndex==i},isLastFocusCell:function(){return this.rowIndex==this.grid.rowCount-1&&this.cell.index==this.grid.layout.cellCount-1},isFirstFocusCell:function(){return 0==this.rowIndex&&0==this.cell.index},isNoFocusCell:function(){return this.rowIndex<0||!this.cell},_focusifyCellNode:function(t){var i=this.cell&&this.cell.getNode(this.rowIndex);if(i){dojo.toggleClass(i,this.focusClass,t),this.scrollIntoView();try{this.grid.edit.isEditing()||dojox.grid.fire(i,"focus")}catch(o){}}},scrollIntoView:function(){if(this.cell){var t=this.cell,i=t.view.scrollboxNode,o={w:i.clientWidth,l:i.scrollLeft,t:i.scrollTop,h:i.clientHeight},s=t.getNode(this.rowIndex),e=t.view.getRowNode(this.rowIndex),l=this.grid.scroller.findScrollTop(this.rowIndex);s.offsetLeft+s.offsetWidth>o.l+o.w?i.scrollLeft=s.offsetLeft+s.offsetWidth-o.w:s.offsetLeft<o.l&&(i.scrollLeft=s.offsetLeft),l+e.offsetHeight>o.t+o.h?this.grid.setScrollTop(l+e.offsetHeight-o.h):l<o.t&&this.grid.setScrollTop(l)}},styleRow:function(t){t.index==this.rowIndex&&this._focusifyCellNode(!0)},setFocusIndex:function(t,i){this.setFocusCell(this.grid.getCell(i),t)},setFocusCell:function(t,i){t&&!this.isFocusCell(t,i)&&(this.tabbingOut=!1,this.focusGrid(),this._focusifyCellNode(!1),this.cell=t,this.rowIndex=i,this._focusifyCellNode(!0)),dojo.isOpera?setTimeout(dojo.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1):this.grid.onCellFocus(this.cell,this.rowIndex)},next:function(){var t=this.rowIndex,i=this.cell.index+1,o=this.grid.layout.cellCount-1,s=this.grid.rowCount-1;i>o&&(i=0,t++),t>s&&(i=o,t=s),this.setFocusIndex(t,i)},previous:function(){var t=this.rowIndex||0,i=(this.cell.index||0)-1;0>i&&(i=this.grid.layout.cellCount-1,t--),0>t&&(t=0,i=0),this.setFocusIndex(t,i)},move:function(t,i){var o=this.grid.rowCount-1,s=this.grid.layout.cellCount-1,e=this.rowIndex,l=this.cell.index,c=Math.min(o,Math.max(0,e+t)),n=Math.min(s,Math.max(0,l+i));this.setFocusIndex(c,n),t&&this.grid.updateRow(e)},previousKey:function(t){this.isFirstFocusCell()?this.tabOut(this.grid.domNode):(dojo.stopEvent(t),this.previous())},nextKey:function(t){this.isLastFocusCell()?this.tabOut(this.grid.lastFocusNode):(dojo.stopEvent(t),this.next())},tabOut:function(t){this.tabbingOut=!0,t.focus()},focusGrid:function(){dojox.grid.fire(this.focusView,"focus"),this._focusifyCellNode(!0)},doFocus:function(t){t&&t.target!=t.currentTarget||(!this.tabbingOut&&this.isNoFocusCell()&&this.setFocusIndex(0,0),this.tabbingOut=!1)}}));