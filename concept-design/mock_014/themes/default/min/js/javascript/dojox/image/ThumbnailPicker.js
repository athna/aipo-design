dojo._hasResource["dojox.image.ThumbnailPicker"]||(dojo._hasResource["dojox.image.ThumbnailPicker"]=!0,dojo.provide("dojox.image.ThumbnailPicker"),dojo.experimental("dojox.image.ThumbnailPicker"),dojo.require("dojo.fx"),dojo.require("dijit._Widget"),dojo.require("dijit._Templated"),dojo.declare("dojox.image.ThumbnailPicker",[dijit._Widget,dijit._Templated],{imageStore:null,request:null,size:500,thumbHeight:75,thumbWidth:100,useLoadNotifier:!1,useHyperlink:!1,hyperlinkTarget:"new",isClickable:!0,isScrollable:!0,isHorizontal:!0,autoLoad:!0,linkAttr:"link",imageThumbAttr:"imageUrlThumb",imageLargeAttr:"imageUrl",pageSize:20,titleAttr:"title",templateString:'<div dojoAttachPoint="outerNode" class="thumbOuter">\r\n	<div dojoAttachPoint="navPrev" class="thumbNav thumbClickable">\r\n	  <img src="" dojoAttachPoint="navPrevImg"/>    \r\n	</div>\r\n	<div dojoAttachPoint="thumbScroller" class="thumbScroller">\r\n	  <div dojoAttachPoint="thumbsNode" class="thumbWrapper"></div>\r\n	</div>\r\n	<div dojoAttachPoint="navNext" class="thumbNav thumbClickable">\r\n	  <img src="" dojoAttachPoint="navNextImg"/>  \r\n	</div>\r\n</div>\r\n',tempImgPath:dojo.moduleUrl("dojox.image","resources/images/1pixel.gif"),_thumbs:[],_thumbIndex:0,_maxPhotos:0,_loadedImages:{},postCreate:function(){this.widgetid=this.id,this.inherited("postCreate",arguments),this.pageSize=Number(this.pageSize),this._scrollerSize=this.size-102;var t=this._sizeProperty=this.isHorizontal?"width":"height";dojo.style(this.outerNode,"textAlign","center"),dojo.style(this.outerNode,t,this.size+"px"),dojo.style(this.thumbScroller,t,this._scrollerSize+"px"),this.useHyperlink&&dojo.subscribe(this.getClickTopicName(),this,function(t){var i=(t.index,this.imageStore.getValue(t.data,this.linkAttr));i&&("new"==this.hyperlinkTarget?window.open(i):window.location=i)}),this.isScrollable&&(dojo.require("dojox.fx.scroll"),dojo.require("dojox.fx.easing")),this.isClickable&&dojo.addClass(this.thumbsNode,"thumbClickable"),this._totalSize=0,this.init()},init:function(){if(this.isInitialized)return!1;var t=this.isHorizontal?"Horiz":"Vert";return dojo.addClass(this.navPrev,"prev"+t),dojo.addClass(this.navNext,"next"+t),dojo.addClass(this.thumbsNode,"thumb"+t),dojo.addClass(this.outerNode,"thumb"+t),this.navNextImg.setAttribute("src",this.tempImgPath),this.navPrevImg.setAttribute("src",this.tempImgPath),dojo.connect(this.navPrev,"onclick",this,"_prev"),dojo.connect(this.navNext,"onclick",this,"_next"),this.isInitialized=!0,this.isHorizontal?(this._offsetAttr="offsetLeft",this._sizeAttr="offsetWidth",this._scrollAttr="scrollLeft"):(this._offsetAttr="offsetTop",this._sizeAttr="offsetHeight",this._scrollAttr="scrollTop"),this._updateNavControls(),this.imageStore&&this.request&&this._loadNextPage(),!0},getClickTopicName:function(){return(this.widgetId?this.widgetId:this.id)+"/select"},getShowTopicName:function(){return(this.widgetId?this.widgetId:this.id)+"/show"},setDataStore:function(t,i,e){if(this.reset(),this.request={query:{},start:i.start?i.start:0,count:i.count?i.count:10,onBegin:dojo.hitch(this,function(t){this._maxPhotos=t})},i.query&&dojo.mixin(this.request.query,i.query),e&&e.imageThumbAttr)for(var s=["imageThumbAttr","imageLargeAttr","linkAttr","titleAttr"],o=0;o<s.length;o++)e[s[o]]&&(this[s[o]]=e[s[o]]);this.request.start=0,this.request.count=this.pageSize,this.imageStore=t,this.init()||this._loadNextPage()},reset:function(){this._loadedImages={};for(var t,i=0;i<this._thumbs.length;i++)t=this._thumbs[i],t&&t.parentNode&&t.parentNode.removeChild(t);this._thumbs=[],this.isInitialized=!1,this._noImages=!0},isVisible:function(t){var i=this._thumbs[t];if(!i)return!1;var e=this.isHorizontal?"offsetLeft":"offsetTop",s=this.isHorizontal?"offsetWidth":"offsetHeight",o=this.isHorizontal?"scrollLeft":"scrollTop",h=i[e]-this.thumbsNode[e];return h>=this.thumbScroller[o]&&h+i[s]<=this.thumbScroller[o]+this._scrollerSize},_next:function(){for(var t,i=this.isHorizontal?"offsetLeft":"offsetTop",e=this.isHorizontal?"offsetWidth":"offsetHeight",s=this.thumbsNode[i],o=this._thumbs[this._thumbIndex],h=o[i]-s,r=this._thumbIndex+1;r<this._thumbs.length;r++)if(t=this._thumbs[r],t[i]-s+t[e]-h>this._scrollerSize)return this._showThumbs(r),void 0},_prev:function(){if(0!=this.thumbScroller[this.isHorizontal?"scrollLeft":"scrollTop"]){for(var t,i=this.isHorizontal?"offsetLeft":"offsetTop",e=(this.isHorizontal?"offsetWidth":"offsetHeight",this._thumbs[this._thumbIndex]),s=e[i]-this.thumbsNode[i],o=this._thumbIndex-1;o>-1;o--)if(t=this._thumbs[o],s-t[i]>this._scrollerSize)return this._showThumbs(o+1),void 0;this._showThumbs(0)}},_checkLoad:function(t,i){dojo.publish(this.getShowTopicName(),[{index:i}]),this._updateNavControls(),this._loadingImages={},this._thumbIndex=i,this.thumbsNode.offsetWidth-t.offsetLeft<2*this._scrollerSize&&this._loadNextPage()},_showThumbs:function(t){var t=0==arguments.length?this._thumbIndex:arguments[0];if(t=Math.min(Math.max(t,0),this._maxPhotos),!(t>=this._maxPhotos)){var i=this._thumbs[t];if(i){var e=i.offsetLeft-this.thumbsNode.offsetLeft,s=i.offsetTop-this.thumbsNode.offsetTop,o=this.isHorizontal?e:s;if(!(o>=this.thumbScroller[this._scrollAttr]&&o+i[this._sizeAttr]<=this.thumbScroller[this._scrollAttr]+this._scrollerSize))if(this.isScrollable){var h=this.isHorizontal?{x:e,y:0}:{x:0,y:s};dojox.fx.smoothScroll({target:h,win:this.thumbScroller,duration:300,easing:dojox.fx.easing.easeOut,onEnd:dojo.hitch(this,"_checkLoad",i,t)}).play(10)}else this.isHorizontal?this.thumbScroller.scrollLeft=e:this.thumbScroller.scrollTop=s,this._checkLoad(i,t)}}},markImageLoaded:function(t){var i=dojo.byId("loadingDiv_"+this.widgetid+"_"+t);i&&this._setThumbClass(i,"thumbLoaded"),this._loadedImages[t]=!0},_setThumbClass:function(t,i){this.autoLoad&&dojo.addClass(t,i)},_loadNextPage:function(){if(!this._loadInProgress){this._loadInProgress=!0;for(var t=this.request.start+(1==this._noImages?0:this.pageSize),i=t;i<this._thumbs.length&&this._thumbs[i];)i++;var e=this,s=function(t){if(t&&t.length){var s=0,o=function(){if(s>=t.length)return e._loadInProgress=!1,void 0;var h=s++;e._loadImage(t[h],i+h,o)};o(),e._updateNavControls()}else e._loadInProgress=!1},o=function(){e._loadInProgress=!1,console.debug("Error getting items")};this.request.onComplete=s,this.request.onError=o,this.request.start=t,this._noImages=!1,this.imageStore.fetch(this.request)}},_loadImage:function(t,i,e){var s=this.imageStore.getValue(t,this.imageThumbAttr),o=document.createElement("img"),h=document.createElement("div");h.setAttribute("id","img_"+this.widgetid+"_"+i),h.appendChild(o),o._index=i,o._data=t,this._thumbs[i]=h;var r;this.useLoadNotifier&&(r=document.createElement("div"),r.setAttribute("id","loadingDiv_"+this.widgetid+"_"+i),this._setThumbClass(r,this._loadedImages[i]?"thumbLoaded":"thumbNotifier"),h.appendChild(r));var a,l,d=dojo.marginBox(this.thumbsNode);this.isHorizontal?(a=this.thumbWidth,l="w"):(a=this.thumbHeight,l="h"),d=d[l];var n=this.thumbScroller.scrollLeft,u=this.thumbScroller.scrollTop;dojo.style(this.thumbsNode,this._sizeProperty,d+a+20+"px"),this.thumbScroller.scrollLeft=n,this.thumbScroller.scrollTop=u,this.thumbsNode.appendChild(h),dojo.connect(o,"onload",this,function(){var t=dojo.marginBox(o)[l];return this._totalSize+=Number(t)+4,dojo.style(this.thumbsNode,this._sizeProperty,this._totalSize+"px"),this.useLoadNotifier&&dojo.style(r,"width",o.width-4+"px"),e(),!1}),dojo.connect(o,"onclick",this,function(i){return dojo.publish(this.getClickTopicName(),[{index:i.target._index,data:i.target._data,url:o.getAttribute("src"),largeUrl:this.imageStore.getValue(t,this.imageLargeAttr),title:this.imageStore.getValue(t,this.titleAttr),link:this.imageStore.getValue(t,this.linkAttr)}]),!1}),dojo.addClass(o,"imageGalleryThumb"),o.setAttribute("src",s);var m=this.imageStore.getValue(t,this.titleAttr);m&&o.setAttribute("title",m),this._updateNavControls()},_updateNavControls:function(){var t=function(t,i){var e=i?"addClass":"removeClass";dojo[e](t,"enabled"),dojo[e](t,"thumbClickable")},i=this.isHorizontal?"scrollLeft":"scrollTop",e=this.isHorizontal?"offsetWidth":"offsetHeight";t(this.navPrev,this.thumbScroller[i]>0);var s=(this._thumbs[this._thumbs.length-1],this.thumbScroller[i]+this._scrollerSize<this.thumbsNode[e]);t(this.navNext,s)}}));