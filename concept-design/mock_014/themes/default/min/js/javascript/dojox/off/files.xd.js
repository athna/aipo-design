dojo._xdResourceLoaded({depends:[["provide","dojox.off.files"]],defineResource:function(e){e._hasResource["dojox.off.files"]||(e._hasResource["dojox.off.files"]=!0,e.provide("dojox.off.files"),dojox.off.files={versionURL:"version.js",listOfURLs:[],refreshing:!1,_cancelID:null,_error:!1,_errorMessages:[],_currentFileIndex:0,_store:null,_doSlurp:!1,slurp:function(){this._doSlurp=!0},cache:function(o){if(e.isString(o)){var t=this._trimAnchor(o+"");this.isAvailable(t)||this.listOfURLs.push(t)}else if(o instanceof e._Url){var t=this._trimAnchor(o.uri);this.isAvailable(t)||this.listOfURLs.push(t)}else e.forEach(o,function(e){e=this._trimAnchor(e),this.isAvailable(e)||this.listOfURLs.push(e)},this)},printURLs:function(){console.debug("The following URLs are cached for offline use:"),e.forEach(this.listOfURLs,function(e){console.debug(e)})},remove:function(e){for(var o=0;o<this.listOfURLs.length;o++)if(this.listOfURLs[o]==e){this.listOfURLs=this.listOfURLs.splice(o,1);break}},isAvailable:function(e){for(var o=0;o<this.listOfURLs.length;o++)if(this.listOfURLs[o]==e)return!0;return!1},refresh:function(e){try{djConfig.isDebug&&this.printURLs(),this.refreshing=!0,this.versionURL?this._getVersionInfo(function(o,t,r){djConfig.isDebug||!t||r||!o||o!=t?(console.warn("Refreshing offline file list"),this._doRefresh(e,t)):(console.warn("No need to refresh offline file list"),e(!1,[]))}):(console.warn("Refreshing offline file list"),this._doRefresh(e))}catch(o){this.refreshing=!1,dojox.off.coreOpFailed=!0,dojox.off.enabled=!1,dojox.off.onFrameworkEvent("coreOperationFailed")}},abortRefresh:function(){this.refreshing&&(this._store.abortCapture(this._cancelID),this.refreshing=!1)},_slurp:function(){if(this._doSlurp){var o=e.hitch(this,function(e){this._sameLocation(e)&&this.cache(e)});o(window.location.href),e.query("script").forEach(function(e){try{o(e.getAttribute("src"))}catch(t){}}),e.query("link").forEach(function(e){try{if(!e.getAttribute("rel")||"stylesheet"!=e.getAttribute("rel").toLowerCase())return;o(e.getAttribute("href"))}catch(t){}}),e.query("img").forEach(function(e){try{o(e.getAttribute("src"))}catch(t){}}),e.query("a").forEach(function(e){try{o(e.getAttribute("href"))}catch(t){}}),e.forEach(document.styleSheets,function(t){try{if(t.cssRules)e.forEach(t.cssRules,function(e){var t=e.cssText;if(t){var r=t.match(/url\(\s*([^\) ]*)\s*\)/i);if(!r)return;for(var i=1;i<r.length;i++)o(r[i])}});else if(t.cssText)for(var r,i=t.cssText.toString(),s=i.split(/\f|\r|\n/),n=0;n<s.length;n++)r=s[n].match(/url\(\s*([^\) ]*)\s*\)/i),r&&r.length&&o(r[1])}catch(f){}})}},_sameLocation:function(o){return o?o.length&&"#"==o.charAt(0)?!1:(o=new e._Url(o),o.scheme||o.port||o.host?!o.scheme&&o.host&&o.port&&window.location.hostname==o.host&&window.location.port==o.port?!0:o.scheme||!o.host||o.port||window.location.hostname!=o.host||80!=window.location.port?window.location.protocol==o.scheme+":"&&window.location.hostname==o.host&&(window.location.port==o.port||!window.location.port&&!o.port):!0:!0):!1},_trimAnchor:function(e){return e.replace(/\#.*$/,"")},_doRefresh:function(o,t){var r;try{r=google.gears.factory.create("beta.localserver","1.0")}catch(i){throw e.setObject("google.gears.denied",!0),dojox.off.onFrameworkEvent("coreOperationFailed"),"Google Gears must be allowed to run"}var s="dot_store_"+window.location.href.replace(/[^0-9A-Za-z_]/g,"_");r.removeStore(s),r.openStore(s);var n=r.createStore(s);this._store=n;var f=this;this._currentFileIndex=0,this._cancelID=n.capture(this.listOfURLs,function(e,r){if(!r&&f.refreshing){f._cancelID=null,f.refreshing=!1;var i=[];return i.push("Unable to capture: "+e),o(!0,i),void 0}r&&f._currentFileIndex++,r&&f._currentFileIndex>=f.listOfURLs.length&&(f._cancelID=null,f.refreshing=!1,t&&dojox.storage.put("oldVersion",t,null,dojox.off.STORAGE_NAMESPACE),dojox.storage.put("justDebugged",djConfig.isDebug,null,dojox.off.STORAGE_NAMESPACE),o(!1,[]))})},_getVersionInfo:function(o){var t=dojox.storage.get("justDebugged",dojox.off.STORAGE_NAMESPACE),r=dojox.storage.get("oldVersion",dojox.off.STORAGE_NAMESPACE),i=null;o=e.hitch(this,o),e.xhrGet({url:this.versionURL+"?browserbust="+(new Date).getTime(),timeout:5e3,handleAs:"javascript",error:function(){dojox.storage.remove("oldVersion",dojox.off.STORAGE_NAMESPACE),dojox.storage.remove("justDebugged",dojox.off.STORAGE_NAMESPACE),o(r,i,t)},load:function(e){e&&(i=e),o(r,i,t)}})}})}});