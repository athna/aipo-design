dojo._hasResource["dojo.io.iframe"]||(dojo._hasResource["dojo.io.iframe"]=!0,dojo.provide("dojo.io.iframe"),dojo.io.iframe={create:function(fname,onloadstr,uri){if(window[fname])return window[fname];if(window.frames[fname])return window.frames[fname];var cframe=null,turi=uri;turi||(djConfig.useXDomain&&!djConfig.dojoBlankHtmlUrl&&console.debug("dojo.io.iframe.create: When using cross-domain Dojo builds, please save dojo/resources/blank.html to your domain and set djConfig.dojoBlankHtmlUrl to the path on your domain to blank.html"),turi=djConfig.dojoBlankHtmlUrl||dojo.moduleUrl("dojo","resources/blank.html"));var ifrstr=dojo.isIE?'<iframe name="'+fname+'" src="'+turi+'" onload="'+onloadstr+'">':"iframe";with(cframe=dojo.doc.createElement(ifrstr))name=fname,setAttribute("name",fname),id=fname;with(dojo.body().appendChild(cframe),window[fname]=cframe,cframe.style)dojo.isSafari<3&&(position="absolute"),left=top="1px",height=width="1px",visibility="hidden";return dojo.isIE||(this.setSrc(cframe,turi,!0),cframe.onload=new Function(onloadstr)),cframe},setSrc:function(e,o,t){try{if(t){var r;if(r=dojo.isIE||dojo.isSafari>2?e.contentWindow.document:dojo.isSafari?e.document:e.contentWindow,!r)return e.location=o,void 0;r.location.replace(o)}else dojo.isSafari?e.location=o:frames[e.name].location=o}catch(i){console.debug("dojo.io.iframe.setSrc: ",i)}},doc:function(e){var o=e.contentDocument||e.contentWindow&&e.contentWindow.document||e.name&&document.frames[e.name]&&document.frames[e.name].document||null;return o},send:function(e){this._frame||(this._frame=this.create(this._iframeName,"dojo.io.iframe._iframeOnload();"));var o=dojo._ioSetArgs(e,function(e){e.canceled=!0,e.ioArgs._callNext()},function(e){var o=null;try{var t=e.ioArgs,r=dojo.io.iframe,i=r.doc(r._frame),a=t.handleAs;o=i,"html"!=a&&(o=i.getElementsByTagName("textarea")[0].value,"json"==a?o=dojo.fromJson(o):"javascript"==a&&(o=dojo.eval(o)))}catch(n){o=n}finally{t._callNext()}return o},function(e,o){return o.ioArgs._hasError=!0,o.ioArgs._callNext(),e});return o.ioArgs._callNext=function(){this._calledNext||(this._calledNext=!0,dojo.io.iframe._currentDfd=null,dojo.io.iframe._fireNextRequest())},this._dfdQueue.push(o),this._fireNextRequest(),dojo._ioWatch(o,function(e){return!e.ioArgs._hasError},function(e){return!!e.ioArgs._finished},function(e){e.ioArgs._finished?e.callback(e):e.errback(new Error("Invalid dojo.io.iframe request state"))}),o},_currentDfd:null,_dfdQueue:[],_iframeName:"dojoIoIframe",_fireNextRequest:function(){try{if(this._currentDfd||0==this._dfdQueue.length)return;var e=this._currentDfd=this._dfdQueue.shift(),o=e.ioArgs,t=o.args;o._contentToClean=[];var r=t.form,i=t.content||{};if(r){if(i)for(var a in i)if(r[a])r[a].value=i[a];else{var n;dojo.isIE?n=dojo.doc.createElement("<input type='hidden' name='"+a+"'>"):(n=dojo.doc.createElement("input"),n.type="hidden",n.name=a),n.value=i[a],r.appendChild(n),o._contentToClean.push(a)}var d=r.getAttributeNode("action"),s=r.getAttributeNode("method"),l=r.getAttributeNode("target");t.url&&(o._originalAction=d?d.value:null,d?d.value=t.url:r.setAttribute("action",t.url)),s&&s.value||(s?s.value=t.method?t.method:"post":r.setAttribute("method",t.method?t.method:"post")),o._originalTarget=l?l.value:null,l?l.value=this._iframeName:r.setAttribute("target",this._iframeName),r.target=this._iframeName,r.submit()}else{var f=t.url+(t.url.indexOf("?")>-1?"&":"?")+o.query;this.setSrc(this._frame,f,!0)}}catch(u){e.errback(u)}},_iframeOnload:function(){var e=this._currentDfd;if(!e)return this._fireNextRequest(),void 0;var o=e.ioArgs,t=o.args,r=t.form;if(r){for(var i=o._contentToClean,a=0;a<i.length;a++){var n=i[a];if(dojo.isSafari<3)for(var d=0;d<r.childNodes.length;d++){var s=r.childNodes[d];if(s.name==n){dojo._destroyElement(s);break}}else dojo._destroyElement(r[n]),r[n]=null}o._originalAction&&r.setAttribute("action",o._originalAction),o._originalTarget&&(r.setAttribute("target",o._originalTarget),r.target=o._originalTarget)}o._finished=!0}});