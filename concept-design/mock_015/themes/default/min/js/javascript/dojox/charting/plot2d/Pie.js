dojo._hasResource["dojox.charting.plot2d.Pie"]||(dojo._hasResource["dojox.charting.plot2d.Pie"]=!0,dojo.provide("dojox.charting.plot2d.Pie"),dojo.require("dojox.charting.Element"),dojo.require("dojox.charting.axis2d.common"),dojo.require("dojox.charting.plot2d.common"),dojo.require("dojox.lang.functional"),dojo.require("dojox.gfx"),function(){var t=dojox.lang.functional,o=dojox.lang.utils,i=dojox.charting.plot2d.common,e=dojox.charting.axis2d.common,n=dojox.gfx,r=.8;dojo.declare("dojox.charting.plot2d.Pie",dojox.charting.Element,{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:20,labelStyle:"default",htmlLabels:!0},optionalParams:{font:"",fontColor:"",radius:0},constructor:function(t,i){this.opt=dojo.clone(this.defaultParams),o.updateWithObject(this.opt,i),o.updateWithPattern(this.opt,i,this.optionalParams),this.run=null,this.dyn=[]},clear:function(){return this.dirty=!0,this.dyn=[],this},setAxis:function(){return this},addSeries:function(t){return this.run=t,this},calculateAxes:function(){return this},getRequiredColors:function(){return this.run?this.run.data.length:0},render:function(o,s){if(!this.dirty)return this;this.dirty=!1,this.cleanGroup();var a,h,l,d,c=this.group,u=this.chart.theme,f=(o.width-s.l-s.r)/2,p=(o.height-s.t-s.b)/2,x=Math.min(f,p),m="font"in this.opt?this.opt.font:u.axis.font,g="fontColor"in this.opt?this.opt.fontColor:u.axis.fontColor,j=t.foldl1(this.run.data,"+"),b=0,y=dojo.map(this.run.data,function(t){return t/j});if(this.opt.labels){var M=dojo.map(y,function(t){return this._getLabel(100*t)+"%"},this);h=t.foldl1(dojo.map(M,t.pluck("length")),"x, y -> Math.max(x, y)"),l=m?n.normalizedLength(n.splitFontString(m).size):0,h=Math.max(h*r,1)/2*l,this.opt.labelOffset<0&&(x=Math.min(f-2*h,p-l)+this.opt.labelOffset),d=x-this.opt.labelOffset}"radius"in this.opt&&(x=this.opt.radius,d=x-this.opt.labelOffset);var P={cx:s.l+f,cy:s.t+p,r:x};if(this.dyn=[],!this.run||!this.run.data.length)return this;if(1==this.run.data.length){a=new dojo.Color(u.next("color"));var v=c.createCircle(P).setFill(i.augmentFill(u.run.fill,a)).setStroke(i.augmentStroke(u.series.stroke,a));if(this.dyn.push({color:a,fill:v.getFill(),stroke:v.getStroke()}),this.opt.labels){var h=4,m="font"in this.opt?this.opt.font:u.axis.font,g="fontColor"in this.opt?this.opt.fontColor:u.axis.fontColor,l=m?n.normalizedLength(n.splitFontString(m).size):0;h=Math.max(h*r,1)/2*l;var k=e.createText[this.opt.htmlLabels?"html":"gfx"](this.chart,c,P.cx,P.cy+l/2,"middle","100%",m,g);this.opt.htmlLabels&&this.htmlElements.push(k)}return this}return dojo.forEach(y,function(t,o){var e=b+2*t*Math.PI;o+1==y.length&&(e=2*Math.PI);var n=e-b,r=P.cx+x*Math.cos(b),s=P.cy+x*Math.sin(b),h=P.cx+x*Math.cos(e),l=P.cy+x*Math.sin(e);a=new dojo.Color(u.next("color"));var d=c.createPath({}).moveTo(P.cx,P.cy).lineTo(r,s).arcTo(x,x,0,n>Math.PI,!0,h,l).lineTo(P.cx,P.cy).closePath().setFill(i.augmentFill(u.series.fill,a)).setStroke(i.augmentStroke(u.series.stroke,a));this.dyn.push({color:a,fill:d.getFill(),stroke:d.getStroke()}),b=e},this),this.opt.labels&&(b=0,dojo.forEach(y,function(t,o){var i=b+2*t*Math.PI;o+1==y.length&&(i=2*Math.PI);var n=(b+i)/2,t=P.cx+d*Math.cos(n),r=P.cy+d*Math.sin(n)+l/2,s=e.createText[this.opt.htmlLabels?"html":"gfx"](this.chart,c,t,r,"middle",M[o],m,g);this.opt.htmlLabels&&this.htmlElements.push(s),b=i},this)),this},_getLabel:function(t){return this.opt.fixed?t.toFixed(this.opt.precision):t.toString()}})}());