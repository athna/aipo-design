dojo._hasResource["dijit.Tree"]||(dojo._hasResource["dijit.Tree"]=!0,dojo.provide("dijit.Tree"),dojo.require("dojo.fx"),dojo.require("dijit._Widget"),dojo.require("dijit._Templated"),dojo.require("dijit._Container"),dojo.require("dojo.cookie"),dojo.declare("dijit._TreeNode",[dijit._Widget,dijit._Templated,dijit._Container,dijit._Contained],{item:null,isTreeNode:!0,label:"",isExpandable:null,isExpanded:!1,state:"UNCHECKED",templateString:'<div class="dijitTreeNode dijitTreeExpandLeaf dijitTreeChildrenNo" waiRole="presentation"\r\n	><span dojoAttachPoint="expandoNode" class="dijitTreeExpando" waiRole="presentation"\r\n	></span\r\n	><span dojoAttachPoint="expandoNodeText" class="dijitExpandoText" waiRole="presentation"\r\n	></span\r\n	>\r\n	<div dojoAttachPoint="contentNode" class="dijitTreeContent" waiRole="presentation">\r\n		<div dojoAttachPoint="iconNode" class="dijitInline dijitTreeIcon" waiRole="presentation"></div>\r\n		<span dojoAttachPoint="labelNode" class="dijitTreeLabel" wairole="treeitem" tabindex="-1"></span>\r\n	</div>\r\n</div>\r\n',postCreate:function(){this.setLabelNode(this.label),this._setExpando(),this._updateItemClasses(this.item),this.isExpandable&&dijit.setWaiState(this.labelNode,"expanded",this.isExpanded)},markProcessing:function(){this.state="LOADING",this._setExpando(!0)},unmarkProcessing:function(){this._setExpando(!1)},_updateItemClasses:function(e){this.iconNode.className="dijitInline dijitTreeIcon "+this.tree.getIconClass(e),this.labelNode.className="dijitTreeLabel "+this.tree.getLabelClass(e)},_updateLayout:function(){var e=this.getParent();e&&e.isTree&&e._hideRoot?dojo.addClass(this.domNode,"dijitTreeIsRoot"):dojo.toggleClass(this.domNode,"dijitTreeIsLast",!this.getNextSibling())},_setExpando:function(e){var t=["dijitTreeExpandoLoading","dijitTreeExpandoOpened","dijitTreeExpandoClosed","dijitTreeExpandoLeaf"],i=e?0:this.isExpandable?this.isExpanded?1:2:3;dojo.forEach(t,function(e){dojo.removeClass(this.expandoNode,e)},this),dojo.addClass(this.expandoNode,t[i]),this.expandoNodeText.innerHTML=e?"*":this.isExpandable?this.isExpanded?"-":"+":"*"},expand:function(){this.isExpanded||("playing"==this._wipeOut.status()&&this._wipeOut.stop(),this.isExpanded=!0,dijit.setWaiState(this.labelNode,"expanded","true"),dijit.setWaiRole(this.containerNode,"group"),this._setExpando(),this._wipeIn.play())},collapse:function(){this.isExpanded&&("playing"==this._wipeIn.status()&&this._wipeIn.stop(),this.isExpanded=!1,dijit.setWaiState(this.labelNode,"expanded","false"),this._setExpando(),this._wipeOut.play())},setLabelNode:function(e){this.labelNode.innerHTML="",this.labelNode.appendChild(document.createTextNode(e))},_setChildren:function(e){this.destroyDescendants(),this.state="LOADED";var t={};if(e&&e.length>0?(this.isExpandable=!0,this.containerNode||(this.containerNode=this.tree.containerNodeTemplate.cloneNode(!0),this.domNode.appendChild(this.containerNode)),dojo.forEach(e,function(e){var i=new dijit._TreeNode(dojo.mixin({tree:this.tree,label:this.tree.getLabel(e.item)},e));this.addChild(i);var o=this.tree.store.getIdentity(e.item);t[o]=i,this.tree.persist&&this.tree._openedItemIds[o]&&this.tree._expandNode(i)},this),dojo.forEach(this.getChildren(),function(e){e._updateLayout()})):this.isExpandable=!1,this._setExpando&&this._setExpando(!1),this.isTree&&this._hideRoot){var i=this.getChildren()[0],o=i?i.labelNode:this.domNode;o.setAttribute("tabIndex","0")}return this.containerNode&&!this._wipeIn&&(this._wipeIn=dojo.fx.wipeIn({node:this.containerNode,duration:150}),this._wipeOut=dojo.fx.wipeOut({node:this.containerNode,duration:150})),t},_addChildren:function(e){var t={};return e&&e.length>0&&(dojo.forEach(e,function(e){var i=new dijit._TreeNode(dojo.mixin({tree:this.tree,label:this.tree.getLabel(e.item)},e));this.addChild(i),t[this.tree.store.getIdentity(e.item)]=i},this),dojo.forEach(this.getChildren(),function(e){e._updateLayout()})),t},deleteNode:function(e){e.destroy();var t=this.getChildren();0==t.length&&(this.isExpandable=!1,this.collapse()),dojo.forEach(t,function(e){e._updateLayout()})},makeExpandable:function(){this.isExpandable=!0,this._setExpando(!1)}}),dojo.declare("dijit.Tree",dijit._TreeNode,{store:null,query:null,childrenAttr:["children"],templateString:'<div class="dijitTreeContainer" style="" waiRole="tree"\r\n	dojoAttachEvent="onclick:_onClick,onkeypress:_onKeyPress">\r\n	<div class="dijitTreeNode  dijitTreeIsRoot dijitTreeExpandLeaf dijitTreeChildrenNo" waiRole="presentation"\r\n		dojoAttachPoint="rowNode"\r\n		><span dojoAttachPoint="expandoNode" class="dijitTreeExpando" waiRole="presentation"\r\n		></span\r\n		><span dojoAttachPoint="expandoNodeText" class="dijitExpandoText" waiRole="presentation"\r\n		></span\r\n		>\r\n		<div dojoAttachPoint="contentNode" class="dijitTreeContent" waiRole="presentation">\r\n			<div dojoAttachPoint="iconNode" class="dijitInline dijitTreeIcon" waiRole="presentation"></div>\r\n			<span dojoAttachPoint="labelNode" class="dijitTreeLabel" wairole="treeitem" tabindex="0"></span>\r\n		</div>\r\n	</div>\r\n</div>\r\n',isExpandable:!0,isTree:!0,persist:!0,dndController:null,dndParams:["onDndDrop","itemCreator","onDndCancel","checkAcceptance","checkItemAcceptance"],onDndDrop:null,itemCreator:null,onDndCancel:null,checkAcceptance:null,checkItemAcceptance:null,_publish:function(e,t){dojo.publish(this.id,[dojo.mixin({tree:this,event:e},t||{})])},postMixInProperties:function(){if(this.tree=this,this.lastFocused=this.labelNode,this._itemNodeMap={},this._hideRoot=!this.label,!this.store.getFeatures()["dojo.data.api.Identity"])throw new Error("dijit.tree requires access to a store supporting the dojo.data Identity api");this.cookieName||(this.cookieName=this.id+"SaveStateCookie"),this.store.getFeatures()["dojo.data.api.Notification"]&&(this.connect(this.store,"onNew","_onNewItem"),this.connect(this.store,"onDelete","_onDeleteItem"),this.connect(this.store,"onSet","_onSetItem"))},postCreate:function(){if(this.persist){var e=dojo.cookie(this.cookieName);this._openedItemIds={},e&&dojo.forEach(e.split(","),function(e){this._openedItemIds[e]=!0},this)}var t=document.createElement("div");if(t.style.display="none",t.className="dijitTreeContainer",dijit.setWaiRole(t,"presentation"),this.containerNodeTemplate=t,this._hideRoot&&(this.rowNode.style.display="none"),this.inherited("postCreate",arguments),this._expandNode(this),this.dndController){dojo.isString(this.dndController)&&(this.dndController=dojo.getObject(this.dndController));for(var i={},o=0;o<this.dndParams.length;o++)this[this.dndParams[o]]&&(i[this.dndParams[o]]=this[this.dndParams[o]]);this.dndController=new this.dndController(this,i)}this.connect(this.domNode,dojo.isIE?"onactivate":"onfocus","_onTreeFocus")},mayHaveChildren:function(e){return dojo.some(this.childrenAttr,function(t){return this.store.hasAttribute(e,t)},this)},getItemChildren:function(e,t){function i(){0==--s&&t(n)}var o=this.store;if(null==e)o.fetch({query:this.query,onComplete:t});else{for(var n=[],d=0;d<this.childrenAttr.length;d++)n=n.concat(o.getValues(e,this.childrenAttr[d]));var s=0;dojo.forEach(n,function(e){o.isItemLoaded(e)||s++}),0==s?t(n):dojo.forEach(n,function(e){o.isItemLoaded(e)||o.loadItem({item:e,onItem:i})})}},getItemParentIdentity:function(e,t){return this.store.getIdentity(t.item)},getLabel:function(e){return this.store.getLabel(e)},getIconClass:function(){},getLabelClass:function(){},_onLoadAllItems:function(e,t){var i=dojo.map(t,function(e){return{item:e,isExpandable:this.mayHaveChildren(e)}},this);dojo.mixin(this._itemNodeMap,e._setChildren(i)),this._expandNode(e)},_onKeyPress:function(e){if(!e.altKey){var t=dijit.getEnclosingWidget(e.target);if(t)if(e.charCode){var i=e.charCode;e.altKey||e.ctrlKey||e.shiftKey||e.metaKey||(i=String.fromCharCode(i).toLowerCase(),this._onLetterKeyNav({node:t,key:i}),dojo.stopEvent(e))}else{var o=this._keyHandlerMap;o||(o={},o[dojo.keys.ENTER]="_onEnterKey",o[dojo.keys.LEFT_ARROW]="_onLeftArrow",o[dojo.keys.RIGHT_ARROW]="_onRightArrow",o[dojo.keys.UP_ARROW]="_onUpArrow",o[dojo.keys.DOWN_ARROW]="_onDownArrow",o[dojo.keys.HOME]="_onHomeKey",o[dojo.keys.END]="_onEndKey",this._keyHandlerMap=o),this._keyHandlerMap[e.keyCode]&&(this[this._keyHandlerMap[e.keyCode]]({node:t,item:t.item}),dojo.stopEvent(e))}}},_onEnterKey:function(e){this._publish("execute",{item:e.item,node:e.node}),this.onClick(e.item,e.node)},_onDownArrow:function(e){var t=this._navToNextNode(e.node);return t&&t.isTreeNode?(t.tree.focusNode(t),t):void 0},_onUpArrow:function(e){var t=e.node,i=t,o=t.getPreviousSibling();if(o)for(t=o;t.isExpandable&&t.isExpanded&&t.hasChildren();){i=t;var n=t.getChildren();t=n[n.length-1]}else{var d=t.getParent();this._hideRoot&&d===this||(t=d)}return t&&t.isTreeNode&&(i=t),i&&i.isTreeNode?(i.tree.focusNode(i),i):void 0},_onRightArrow:function(e){var t=e.node,i=t;return t.isExpandable&&!t.isExpanded?this._expandNode(t):t.hasChildren()&&(t=t.getChildren()[0]),t&&t.isTreeNode&&(i=t),i&&i.isTreeNode?(i.tree.focusNode(i),i):void 0},_onLeftArrow:function(e){var t=e.node,i=t;return t.isExpandable&&t.isExpanded?this._collapseNode(t):t=t.getParent(),t&&t.isTreeNode&&(i=t),i&&i.isTreeNode?(i.tree.focusNode(i),i):void 0},_onHomeKey:function(){var e=this._navToRootOrFirstNode();return e?(e.tree.focusNode(e),e):void 0},_onEndKey:function(e){for(var t=e.node.tree,i=t;i.isExpanded;){var o=i.getChildren();i=o[o.length-1],i.isTreeNode&&(t=i)}return t&&t.isTreeNode?(t.tree.focusNode(t),t):void 0},_onLetterKeyNav:function(e){var t=startNode=e.node,i=e.key;do t=this._navToNextNode(t),t||(t=this._navToRootOrFirstNode());while(t!==startNode&&t.label.charAt(0).toLowerCase()!=i);return t&&t.isTreeNode?(t!==startNode&&t.tree.focusNode(t),t):void 0},_onClick:function(e){var t=e.target,i=dijit.getEnclosingWidget(t);i&&i.isTreeNode&&(t==i.expandoNode||t==i.expandoNodeText?i.isExpandable&&this._onExpandoClick({node:i}):(this._publish("execute",{item:i.item,node:i}),this.onClick(i.item,i),this.focusNode(i)),dojo.stopEvent(e))},_onExpandoClick:function(e){var t=e.node;t.isExpanded?this._collapseNode(t):this._expandNode(t)},onClick:function(){},_navToNextNode:function(e){var t;if(e.isExpandable&&e.isExpanded&&e.hasChildren())t=e.getChildren()[0];else for(;e&&e.isTreeNode&&!(t=e.getNextSibling());)e=e.getParent();return t},_navToRootOrFirstNode:function(){if(!this._hideRoot)return this;var e=this.getChildren()[0];return e&&e.isTreeNode?e:void 0},_collapseNode:function(e){if(e.isExpandable){if("LOADING"==e.state)return;this.lastFocused&&(dojo.isDescendant(this.lastFocused.domNode,e.domNode)?this.focusNode(e):this.focusNode(this.lastFocused)),e.collapse(),this.persist&&e.item&&(delete this._openedItemIds[this.store.getIdentity(e.item)],this._saveState())}},_expandNode:function(e){var t=e.tree;if(t.lastFocused&&t.focusNode(t.lastFocused),e.isExpandable){{this.store,this.store.getValue}switch(e.state){case"LOADING":return;case"UNCHECKED":e.markProcessing();var i=this,o=function(t){e.unmarkProcessing(),i._onLoadAllItems(e,t)};this.getItemChildren(e.item,o);break;default:e.expand&&(e.expand(),this.persist&&e.item&&(this._openedItemIds[this.store.getIdentity(e.item)]=!0,this._saveState()))}}},blurNode:function(){var e=this.lastFocused;if(e){var t=e.labelNode;dojo.removeClass(t,"dijitTreeLabelFocused"),t.setAttribute("tabIndex","-1"),this.lastFocused=null}},focusNode:function(e){e.labelNode.focus()},_onBlur:function(){if(this.lastFocused){var e=this.lastFocused.labelNode;dojo.removeClass(e,"dijitTreeLabelFocused")}},_onTreeFocus:function(e){var t=dijit.getEnclosingWidget(e.target);t!=this.lastFocused&&this.blurNode();var i=t.labelNode;i.setAttribute("tabIndex","0"),dojo.addClass(i,"dijitTreeLabelFocused"),this.lastFocused=t},_onNewItem:function(e,t){if(t){var i=this._itemNodeMap[this.getItemParentIdentity(e,t)];if(!i||-1==dojo.indexOf(this.childrenAttr,t.attribute))return}var o={item:e,isExpandable:this.mayHaveChildren(e)};if(i){if(i.isExpandable||i.makeExpandable(),"LOADED"==i.state||i.isExpanded)var n=i._addChildren([o])}else var n=this._addChildren([o]);n&&dojo.mixin(this._itemNodeMap,n)},_onDeleteItem:function(e){var t=this.store.getIdentity(e),i=this._itemNodeMap[t];if(i){var o=i.getParent();o.deleteNode(i),this._itemNodeMap[t]=null}},_onSetItem:function(e){var t=this.store.getIdentity(e);node=this._itemNodeMap[t],node&&(node.setLabelNode(this.getLabel(e)),node._updateItemClasses(e))},_saveState:function(){if(this.persist){var e=[];for(var t in this._openedItemIds)e.push(t);dojo.cookie(this.cookieName,e.join(","))}}}));