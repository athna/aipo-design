dojo._hasResource["dojox.data.QueryReadStore"]||(dojo._hasResource["dojox.data.QueryReadStore"]=!0,dojo.provide("dojox.data.QueryReadStore"),dojo.provide("dojox.data.QueryReadStore.InvalidItemError"),dojo.provide("dojox.data.QueryReadStore.InvalidAttributeError"),dojo.require("dojo.string"),dojo.require("dojo.data.util.simpleFetch"),dojo.declare("dojox.data.QueryReadStore",null,{url:"",requestMethod:"get",_className:"dojox.data.QueryReadStore",_items:[],_lastServerQuery:null,lastRequestHash:null,doClientPaging:!0,_itemsByIdentity:null,_identifier:null,_features:{"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0},constructor:function(t){dojo.mixin(this,t)},getValue:function(t,e,i){if(this._assertIsItem(t),!dojo.isString(e))throw new Error(this._className+".getValue(): Invalid attribute, string expected!");if(!this.hasAttribute(t,e)){if(i)return i;console.log(this._className+".getValue(): Item does not have the attribute '"+e+"'.")}return t.i[e]},getValues:function(t,e){var i=[];return this.hasAttribute(t,e)&&i.push(t.i[e]),i},getAttributes:function(t){this._assertIsItem(t);var e=[];for(var i in t.i)e.push(i);return e},hasAttribute:function(t,e){return this.isItem(t)&&"undefined"!=typeof t.i[e]},containsValue:function(t,e,i){for(var r=this.getValues(t,e),o=r.length,n=0;o>n;n++)if(r[n]==i)return!0;return!1},isItem:function(t){return t?"undefined"!=typeof t.r&&t.r==this:!1},isItemLoaded:function(t){return this.isItem(t)},loadItem:function(t){this.isItemLoaded(t.item)},fetch:function(t){t=t||{},t.store||(t.store=this);var e=this,i=function(t,e){if(e.onError){var i=e.scope||dojo.global;e.onError.call(i,t,e)}},r=function(t,i){var r=i.abort||null,o=!1,n=i.start?i.start:0;0==e.doClientPaging&&(n=0);var s=i.count?n+i.count:t.length;i.abort=function(){o=!0,r&&r.call(i)};var a=i.scope||dojo.global;if(i.store||(i.store=e),i.onBegin&&i.onBegin.call(a,t.length,i),i.sort&&t.sort(dojo.data.util.sorter.createSortFunction(i.sort,e)),i.onItem)for(var d=n;d<t.length&&s>d;++d){var u=t[d];o||i.onItem.call(a,u,i)}if(i.onComplete&&!o){var l=null;i.onItem||(l=t.slice(n,s)),i.onComplete.call(a,l,i)}};return this._fetchItems(t,r,i),t},getFeatures:function(){return this._features},close:function(){},getLabel:function(){return void 0},getLabelAttributes:function(){return null},_fetchItems:function(t,e,r){var o=t.serverQuery||t.query||{};if(this.doClientPaging||(o.start=t.start||0,t.count&&(o.count=t.count)),this.doClientPaging&&null!==this._lastServerQuery&&dojo.toJson(o)==dojo.toJson(this._lastServerQuery))e(this._items,t);else{var n="post"==this.requestMethod.toLowerCase()?dojo.xhrPost:dojo.xhrGet,s=n({url:this.url,handleAs:"json-comment-optional",content:o});s.addCallback(dojo.hitch(this,function(r){r=this._filterResponse(r),this._items=[],dojo.forEach(r.items,function(t){this._items.push({i:t,r:this})},this);var o=r.identifier;if(this._itemsByIdentity={},o)for(this._identifier=o,i=0;i<this._items.length;++i){var n=this._items[i].i,s=n[o];if(this._itemsByIdentity[s])throw new Error("dojo.data.QueryReadStore:  The json data as specified by: ["+this.url+"] is malformed.  Items within the list have identifier: ["+o+"].  Value collided: ["+s+"]");this._itemsByIdentity[s]=n}else for(this._identifier=Number,i=0;i<this._items.length;++i)this._items[i].n=i;e(this._items,t)})),s.addErrback(function(e){r(e,t)}),this.lastRequestHash=(new Date).getTime()+"-"+String(Math.random()).substring(2),this._lastServerQuery=dojo.mixin({},o)}},_filterResponse:function(t){return t},_assertIsItem:function(t){if(!this.isItem(t))throw new dojox.data.QueryReadStore.InvalidItemError(this._className+": a function was passed an item argument that was not an item")},_assertIsAttribute:function(t){if("string"!=typeof t)throw new dojox.data.QueryReadStore.InvalidAttributeError(this._className+": '"+t+"' is not a valid attribute identifier.")},fetchItemByIdentity:function(t){if(this._itemsByIdentity){var e=this._itemsByIdentity[t.identity];if(void 0!==e){if(t.onItem){var i=t.scope?t.scope:dojo.global;t.onItem.call(i,{i:e,r:this})}return}}var r=function(){var e=t.scope?t.scope:dojo.global;t.onError&&t.onError.call(e,error)},o=function(e){var i=t.scope?t.scope:dojo.global;try{var r=null;e&&1==e.length&&(r=e[0]),t.onItem&&t.onItem.call(i,r)}catch(o){t.onError&&t.onError.call(i,o)}},n={serverQuery:{id:t.identity}};this._fetchItems(n,o,r)},getIdentity:function(t){var e=null;return e=this._identifier===Number?t.n:t.i[this._identifier]},getIdentityAttributes:function(){return[this._identifier]}}),dojo.declare("dojox.data.QueryReadStore.InvalidItemError",Error,{}),dojo.declare("dojox.data.QueryReadStore.InvalidAttributeError",Error,{}));