dojo._hasResource["dojox.grid.VirtualGrid"]||(dojo._hasResource["dojox.grid.VirtualGrid"]=!0,dojo.provide("dojox.grid.VirtualGrid"),dojo.require("dojox.grid._grid.lib"),dojo.require("dojox.grid._grid.scroller"),dojo.require("dojox.grid._grid.view"),dojo.require("dojox.grid._grid.views"),dojo.require("dojox.grid._grid.layout"),dojo.require("dojox.grid._grid.rows"),dojo.require("dojox.grid._grid.focus"),dojo.require("dojox.grid._grid.selection"),dojo.require("dojox.grid._grid.edit"),dojo.require("dojox.grid._grid.rowbar"),dojo.require("dojox.grid._grid.publicEvents"),dojo.declare("dojox.VirtualGrid",[dijit._Widget,dijit._Templated],{templateString:'<div class="dojoxGrid" hidefocus="hidefocus" role="wairole:grid"><div class="dojoxGrid-master-header" dojoAttachPoint="headerNode"></div><div class="dojoxGrid-master-view" dojoAttachPoint="viewsNode"></div><span dojoAttachPoint="lastFocusNode" tabindex="0"></span></div>',classTag:"dojoxGrid",get:function(){},rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:!1,autoHeight:!1,autoRender:!0,defaultHeight:"15em",structure:"",elasticView:-1,singleClickEdit:!1,sortInfo:0,themeable:!0,buildRendering:function(){this.inherited(arguments),this.get==dojox.VirtualGrid.prototype.get&&(this.get=null),this.domNode.getAttribute("tabIndex")||(this.domNode.tabIndex="0"),this.createScroller(),this.createLayout(),this.createViews(),this.createManagers(),dojox.grid.initTextSizePoll(),this.connect(dojox.grid,"textSizeChanged","textSizeChanged"),dojox.grid.funnelEvents(this.domNode,this,"doKeyEvent",dojox.grid.keyEvents),this.connect(this,"onShow","renderOnIdle")},postCreate:function(){this.styleChanged=this._styleChanged,this.setStructure(this.structure)},destroy:function(){this.domNode.onReveal=null,this.domNode.onSizeChange=null,this.edit.destroy(),this.views.destroyViews(),this.inherited(arguments)},styleChanged:function(){this.setStyledClass(this.domNode,"")},_styleChanged:function(){this.styleChanged(),this.update()},textSizeChanged:function(){setTimeout(dojo.hitch(this,"_textSizeChanged"),1)},_textSizeChanged:function(){this.domNode&&(this.views.forEach(function(t){t.content.update()}),this.render())},sizeChange:function(){dojox.grid.jobs.job(this.id+"SizeChange",50,dojo.hitch(this,"update"))},renderOnIdle:function(){setTimeout(dojo.hitch(this,"render"),1)},createManagers:function(){this.rows=new dojox.grid.rows(this),this.focus=new dojox.grid.focus(this),this.selection=new dojox.grid.selection(this),this.edit=new dojox.grid.edit(this)},createScroller:function(){this.scroller=new dojox.grid.scroller.columns,this.scroller.renderRow=dojo.hitch(this,"renderRow"),this.scroller.removeRow=dojo.hitch(this,"rowRemoved")},createLayout:function(){this.layout=new dojox.grid.layout(this)},createViews:function(){this.views=new dojox.grid.views(this),this.views.createView=dojo.hitch(this,"createView")},createView:function(inClass){var c=eval(inClass),view=new c({grid:this});return this.viewsNode.appendChild(view.domNode),this.headerNode.appendChild(view.headerNode),this.views.addView(view),view},buildViews:function(){for(var t,e=0;t=this.layout.structure[e];e++)this.createView(t.type||"dojox.GridView").setStructure(t);this.scroller.setContentNodes(this.views.getContentNodes())},setStructure:function(t){this.views.destroyViews(),this.structure=t,this.structure&&dojo.isString(this.structure)&&(this.structure=dojox.grid.getProp(this.structure)),this.structure||(this.structure=window.layout),this.structure&&(this.layout.setStructure(this.structure),this._structureChanged())},_structureChanged:function(){this.buildViews(),this.autoRender&&this.render()},resize:function(){if(this.domNode.parentNode){var t=dojo._getPadBorderExtents(this.domNode);if(this.autoHeight?(this.domNode.style.height="auto",this.viewsNode.style.height=""):this.flex>0||this.domNode.clientHeight<=t.h&&(this.domNode.parentNode==document.body?this.domNode.style.height=this.defaultHeight:this.fitTo="parent"),"parent"==this.fitTo){var e=dojo._getContentBox(this.domNode.parentNode).h;dojo.marginBox(this.domNode,{h:Math.max(0,e)})}var i=this.views.measureHeader();this.headerNode.style.height=i+"px";var o=1,e=this.autoHeight?-1:Math.max(this.domNode.clientHeight-i,0)||0;if(this.autoWidth)this.domNode.style.width=this.views.arrange(o,0,0,e)+"px";else{var s=this.domNode.clientWidth||this.domNode.offsetWidth-t.w;this.views.arrange(o,0,s,e)}this.scroller.windowHeight=e,this.scroller.defaultRowHeight=this.rows.getDefaultHeightPx()+1,this.postresize()}},resizeHeight:function(){var t=this.views.measureHeader();this.headerNode.style.height=t+"px";var e=this.autoHeight?-1:Math.max(this.domNode.clientHeight-t,0)||0;this.views.onEach("setSize",[0,e]),this.views.onEach("resizeHeight"),this.scroller.windowHeight=e},render:function(){this.domNode&&(this.update=this.defaultUpdate,this.scroller.init(this.rowCount,this.keepRows,this.rowsPerPage),this.prerender(),this.setScrollTop(0),this.postrender())},prerender:function(){this.views.render(),this.resize()},postrender:function(){this.postresize(),this.focus.initFocusView(),dojo.setSelectable(this.domNode,!1)},postresize:function(){this.autoHeight&&(this.viewsNode.style.height=this.views.measureContent()+"px")},renderRow:function(t,e){this.views.renderRow(t,e)},rowRemoved:function(t){this.views.rowRemoved(t)},invalidated:null,updating:!1,beginUpdate:function(){this.invalidated=[],this.updating=!0},endUpdate:function(){this.updating=!1;var t=this.invalidated;if(t.all)this.update();else if(void 0!=t.rowCount)this.updateRowCount(t.rowCount);else for(r in t)this.updateRow(Number(r));this.invalidated=null},defaultUpdate:function(){return this.updating?(this.invalidated.all=!0,void 0):(this.prerender(),this.scroller.invalidateNodes(),this.setScrollTop(this.scrollTop),this.postrender(),void 0)},update:function(){this.render()},updateRow:function(t){return t=Number(t),this.updating?(this.invalidated[t]=!0,void 0):(this.views.updateRow(t,this.rows.getHeight(t)),this.scroller.rowHeightChanged(t),void 0)},updateRowCount:function(t){return this.updating?(this.invalidated.rowCount=t,void 0):(this.rowCount=t,this.scroller.updateRowCount(t),this.setScrollTop(this.scrollTop),this.resize(),void 0)},updateRowStyles:function(t){this.views.updateRowStyles(t)},rowHeightChanged:function(t){this.views.renormalizeRow(t),this.scroller.rowHeightChanged(t)},fastScroll:!0,delayScroll:!1,scrollRedrawThreshold:dojo.isIE?100:50,scrollTo:function(t){if(!this.fastScroll)return this.setScrollTop(t),void 0;var e=Math.abs(this.lastScrollTop-t);this.lastScrollTop=t,e>this.scrollRedrawThreshold||this.delayScroll?(this.delayScroll=!0,this.scrollTop=t,this.views.setScrollTop(t),dojox.grid.jobs.job("dojoxGrid-scroll",200,dojo.hitch(this,"finishScrollJob"))):this.setScrollTop(t)},finishScrollJob:function(){this.delayScroll=!1,this.setScrollTop(this.scrollTop)},setScrollTop:function(t){this.scrollTop=this.views.setScrollTop(t),this.scroller.scroll(this.scrollTop)},scrollToRow:function(t){this.setScrollTop(this.scroller.findScrollTop(t)+1)},styleRowNode:function(t,e){e&&this.rows.styleRowNode(t,e)},getCell:function(t){return this.layout.cells[t]},setCellWidth:function(t,e){this.getCell(t).unitWidth=e},getCellName:function(t){return"Cell "+t.index},canSort:function(){},sort:function(){},getSortAsc:function(t){return t=void 0==t?this.sortInfo:t,Boolean(t>0)},getSortIndex:function(t){return t=void 0==t?this.sortInfo:t,Math.abs(t)-1},setSortIndex:function(t,e){var i=t+1;void 0!=e?i*=e?1:-1:this.getSortIndex()==t&&(i=-this.sortInfo),this.setSortInfo(i)},setSortInfo:function(t){this.canSort(t)&&(this.sortInfo=t,this.sort(),this.update())},doKeyEvent:function(t){t.dispatch="do"+t.type,this.onKeyEvent(t)},_dispatch:function(t,e){return t in this?this[t](e):void 0},dispatchKeyEvent:function(t){this._dispatch(t.dispatch,t)},dispatchContentEvent:function(t){this.edit.dispatchEvent(t)||t.sourceView.dispatchContentEvent(t)||this._dispatch(t.dispatch,t)},dispatchHeaderEvent:function(t){t.sourceView.dispatchHeaderEvent(t)||this._dispatch("doheader"+t.type,t)},dokeydown:function(t){this.onKeyDown(t)},doclick:function(t){t.cellNode?this.onCellClick(t):this.onRowClick(t)},dodblclick:function(t){t.cellNode?this.onCellDblClick(t):this.onRowDblClick(t)},docontextmenu:function(t){t.cellNode?this.onCellContextMenu(t):this.onRowContextMenu(t)},doheaderclick:function(t){t.cellNode?this.onHeaderCellClick(t):this.onHeaderClick(t)},doheaderdblclick:function(t){t.cellNode?this.onHeaderCellDblClick(t):this.onHeaderDblClick(t)},doheadercontextmenu:function(t){t.cellNode?this.onHeaderCellContextMenu(t):this.onHeaderContextMenu(t)},doStartEdit:function(t,e){this.onStartEdit(t,e)},doApplyCellEdit:function(t,e,i){this.onApplyCellEdit(t,e,i)},doCancelEdit:function(t){this.onCancelEdit(t)},doApplyEdit:function(t){this.onApplyEdit(t)},addRow:function(){this.updateRowCount(this.rowCount+1)},removeSelectedRows:function(){this.updateRowCount(Math.max(0,this.rowCount-this.selection.getSelected().length)),this.selection.clear()}}),dojo.mixin(dojox.VirtualGrid.prototype,dojox.grid.publicEvents));