dojo._hasResource["dojox.storage.GearsStorageProvider"]||(dojo._hasResource["dojox.storage.GearsStorageProvider"]=!0,dojo.provide("dojox.storage.GearsStorageProvider"),dojo.require("dojox.storage.Provider"),dojo.require("dojox.storage.manager"),dojo.require("dojox.sql"),dojo.isGears&&!function(){dojo.declare("dojox.storage.GearsStorageProvider",dojox.storage.Provider,{constructor:function(){},TABLE_NAME:"__DOJO_STORAGE",initialized:!1,_available:null,initialize:function(){if(1!=djConfig.disableGearsStorage){this.TABLE_NAME="__DOJO_STORAGE";try{dojox.sql("CREATE TABLE IF NOT EXISTS "+this.TABLE_NAME+"(  namespace TEXT,  key TEXT,  value TEXT )"),dojox.sql("CREATE UNIQUE INDEX IF NOT EXISTS namespace_key_index ON "+this.TABLE_NAME+" (namespace, key)")}catch(e){return console.debug("dojox.storage.GearsStorageProvider.initialize:",e),this.initialized=!1,dojox.storage.manager.loaded(),void 0}this.initialized=!0,dojox.storage.manager.loaded()}},isAvailable:function(){return this._available=dojo.isGears},put:function(e,o,r,t){if(0==this.isValidKey(e))throw new Error("Invalid key given: "+e);t=t||this.DEFAULT_NAMESPACE,o=dojo.isString(o)?"string:"+o:dojo.toJson(o);try{dojox.sql("DELETE FROM "+this.TABLE_NAME+" WHERE namespace = ? AND key = ?",t,e),dojox.sql("INSERT INTO "+this.TABLE_NAME+" VALUES (?, ?, ?)",t,e,o)}catch(s){return console.debug("dojox.storage.GearsStorageProvider.put:",s),r(this.FAILED,e,s.toString()),void 0}r&&r(dojox.storage.SUCCESS,e,null)},get:function(e,o){if(0==this.isValidKey(e))throw new Error("Invalid key given: "+e);o=o||this.DEFAULT_NAMESPACE;var r=dojox.sql("SELECT * FROM "+this.TABLE_NAME+" WHERE namespace = ? AND  key = ?",o,e);return r.length?(r=r[0].value,r=dojo.isString(r)&&/^string:/.test(r)?r.substring("string:".length):dojo.fromJson(r)):null},getNamespaces:function(){for(var e=[dojox.storage.DEFAULT_NAMESPACE],o=dojox.sql("SELECT namespace FROM "+this.TABLE_NAME+" DESC GROUP BY namespace"),r=0;r<o.length;r++)o[r].namespace!=dojox.storage.DEFAULT_NAMESPACE&&e.push(o[r].namespace);return e},getKeys:function(e){if(e=e||this.DEFAULT_NAMESPACE,0==this.isValidKey(e))throw new Error("Invalid namespace given: "+e);for(var o=dojox.sql("SELECT key FROM "+this.TABLE_NAME+" WHERE namespace = ?",e),r=[],t=0;t<o.length;t++)r.push(o[t].key);return r},clear:function(e){if(0==this.isValidKey(e))throw new Error("Invalid namespace given: "+e);e=e||this.DEFAULT_NAMESPACE,dojox.sql("DELETE FROM "+this.TABLE_NAME+" WHERE namespace = ?",e)},remove:function(e,o){o=o||this.DEFAULT_NAMESPACE,dojox.sql("DELETE FROM "+this.TABLE_NAME+" WHERE namespace = ? AND key = ?",o,e)},putMultiple:function(e,o,r,t){if(this.isValidKeyArray(e)===!1||!o instanceof Array||e.length!=o.length)throw new Error("Invalid arguments: keys = ["+e+"], values = ["+o+"]");if((null==t||"undefined"==typeof t)&&(t=dojox.storage.DEFAULT_NAMESPACE),0==this.isValidKey(t))throw new Error("Invalid namespace given: "+t);this._statusHandler=r;try{dojox.sql.open(),dojox.sql.db.execute("BEGIN TRANSACTION");for(var s="REPLACE INTO "+this.TABLE_NAME+" VALUES (?, ?, ?)",i=0;i<e.length;i++){var a=o[i];a=dojo.isString(a)?"string:"+a:dojo.toJson(a),dojox.sql.db.execute(s,[t,e[i],a])}dojox.sql.db.execute("COMMIT TRANSACTION"),dojox.sql.close()}catch(n){return console.debug("dojox.storage.GearsStorageProvider.putMultiple:",n),r&&r(this.FAILED,e,n.toString()),void 0}r&&r(dojox.storage.SUCCESS,key,null)},getMultiple:function(e,o){if(this.isValidKeyArray(e)===!1)throw new("Invalid key array given: "+e);if((null==o||"undefined"==typeof o)&&(o=dojox.storage.DEFAULT_NAMESPACE),0==this.isValidKey(o))throw new Error("Invalid namespace given: "+o);for(var r="SELECT * FROM "+this.TABLE_NAME+" WHERE namespace = ? AND  key = ?",t=[],s=0;s<e.length;s++){var i=dojox.sql(r,o,e[s]);i.length?(i=i[0].value,t[s]=dojo.isString(i)&&/^string:/.test(i)?i.substring("string:".length):dojo.fromJson(i)):t[s]=null}return t},removeMultiple:function(e,o){o=o||this.DEFAULT_NAMESPACE,dojox.sql.open(),dojox.sql.db.execute("BEGIN TRANSACTION");for(var r="DELETE FROM "+this.TABLE_NAME+" WHERE namespace = ? AND key = ?",t=0;t<e.length;t++)dojox.sql.db.execute(r,[o,e[t]]);dojox.sql.db.execute("COMMIT TRANSACTION"),dojox.sql.close()},isPermanent:function(){return!0},getMaximumSize:function(){return this.SIZE_NO_LIMIT},hasSettingsUI:function(){return!1},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface")},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface")}}),dojox.storage.manager.register("dojox.storage.GearsStorageProvider",new dojox.storage.GearsStorageProvider),dojox.storage.manager.initialize()}());