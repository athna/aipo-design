dojo._xdResourceLoaded({depends:[["provide","dojox.storage.GearsStorageProvider"],["require","dojox.storage.Provider"],["require","dojox.storage.manager"],["require","dojox.sql"]],defineResource:function(e){e._hasResource["dojox.storage.GearsStorageProvider"]||(e._hasResource["dojox.storage.GearsStorageProvider"]=!0,e.provide("dojox.storage.GearsStorageProvider"),e.require("dojox.storage.Provider"),e.require("dojox.storage.manager"),e.require("dojox.sql"),e.isGears&&!function(){e.declare("dojox.storage.GearsStorageProvider",dojox.storage.Provider,{constructor:function(){},TABLE_NAME:"__DOJO_STORAGE",initialized:!1,_available:null,initialize:function(){if(1!=djConfig.disableGearsStorage){this.TABLE_NAME="__DOJO_STORAGE";try{dojox.sql("CREATE TABLE IF NOT EXISTS "+this.TABLE_NAME+"(  namespace TEXT,  key TEXT,  value TEXT )"),dojox.sql("CREATE UNIQUE INDEX IF NOT EXISTS namespace_key_index ON "+this.TABLE_NAME+" (namespace, key)")}catch(e){return console.debug("dojox.storage.GearsStorageProvider.initialize:",e),this.initialized=!1,dojox.storage.manager.loaded(),void 0}this.initialized=!0,dojox.storage.manager.loaded()}},isAvailable:function(){return this._available=e.isGears},put:function(o,r,t,s){if(0==this.isValidKey(o))throw new Error("Invalid key given: "+o);s=s||this.DEFAULT_NAMESPACE,r=e.isString(r)?"string:"+r:e.toJson(r);try{dojox.sql("DELETE FROM "+this.TABLE_NAME+" WHERE namespace = ? AND key = ?",s,o),dojox.sql("INSERT INTO "+this.TABLE_NAME+" VALUES (?, ?, ?)",s,o,r)}catch(i){return console.debug("dojox.storage.GearsStorageProvider.put:",i),t(this.FAILED,o,i.toString()),void 0}t&&t(dojox.storage.SUCCESS,o,null)},get:function(o,r){if(0==this.isValidKey(o))throw new Error("Invalid key given: "+o);r=r||this.DEFAULT_NAMESPACE;var t=dojox.sql("SELECT * FROM "+this.TABLE_NAME+" WHERE namespace = ? AND  key = ?",r,o);return t.length?(t=t[0].value,t=e.isString(t)&&/^string:/.test(t)?t.substring("string:".length):e.fromJson(t)):null},getNamespaces:function(){for(var e=[dojox.storage.DEFAULT_NAMESPACE],o=dojox.sql("SELECT namespace FROM "+this.TABLE_NAME+" DESC GROUP BY namespace"),r=0;r<o.length;r++)o[r].namespace!=dojox.storage.DEFAULT_NAMESPACE&&e.push(o[r].namespace);return e},getKeys:function(e){if(e=e||this.DEFAULT_NAMESPACE,0==this.isValidKey(e))throw new Error("Invalid namespace given: "+e);for(var o=dojox.sql("SELECT key FROM "+this.TABLE_NAME+" WHERE namespace = ?",e),r=[],t=0;t<o.length;t++)r.push(o[t].key);return r},clear:function(e){if(0==this.isValidKey(e))throw new Error("Invalid namespace given: "+e);e=e||this.DEFAULT_NAMESPACE,dojox.sql("DELETE FROM "+this.TABLE_NAME+" WHERE namespace = ?",e)},remove:function(e,o){o=o||this.DEFAULT_NAMESPACE,dojox.sql("DELETE FROM "+this.TABLE_NAME+" WHERE namespace = ? AND key = ?",o,e)},putMultiple:function(o,r,t,s){if(this.isValidKeyArray(o)===!1||!r instanceof Array||o.length!=r.length)throw new Error("Invalid arguments: keys = ["+o+"], values = ["+r+"]");if((null==s||"undefined"==typeof s)&&(s=dojox.storage.DEFAULT_NAMESPACE),0==this.isValidKey(s))throw new Error("Invalid namespace given: "+s);this._statusHandler=t;try{dojox.sql.open(),dojox.sql.db.execute("BEGIN TRANSACTION");for(var i="REPLACE INTO "+this.TABLE_NAME+" VALUES (?, ?, ?)",a=0;a<o.length;a++){var n=r[a];n=e.isString(n)?"string:"+n:e.toJson(n),dojox.sql.db.execute(i,[s,o[a],n])}dojox.sql.db.execute("COMMIT TRANSACTION"),dojox.sql.close()}catch(E){return console.debug("dojox.storage.GearsStorageProvider.putMultiple:",E),t&&t(this.FAILED,o,E.toString()),void 0}t&&t(dojox.storage.SUCCESS,key,null)},getMultiple:function(o,r){if(this.isValidKeyArray(o)===!1)throw new("Invalid key array given: "+o);if((null==r||"undefined"==typeof r)&&(r=dojox.storage.DEFAULT_NAMESPACE),0==this.isValidKey(r))throw new Error("Invalid namespace given: "+r);for(var t="SELECT * FROM "+this.TABLE_NAME+" WHERE namespace = ? AND  key = ?",s=[],i=0;i<o.length;i++){var a=dojox.sql(t,r,o[i]);a.length?(a=a[0].value,s[i]=e.isString(a)&&/^string:/.test(a)?a.substring("string:".length):e.fromJson(a)):s[i]=null}return s},removeMultiple:function(e,o){o=o||this.DEFAULT_NAMESPACE,dojox.sql.open(),dojox.sql.db.execute("BEGIN TRANSACTION");for(var r="DELETE FROM "+this.TABLE_NAME+" WHERE namespace = ? AND key = ?",t=0;t<e.length;t++)dojox.sql.db.execute(r,[o,e[t]]);dojox.sql.db.execute("COMMIT TRANSACTION"),dojox.sql.close()},isPermanent:function(){return!0},getMaximumSize:function(){return this.SIZE_NO_LIMIT},hasSettingsUI:function(){return!1},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface")},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface")}}),dojox.storage.manager.register("dojox.storage.GearsStorageProvider",new dojox.storage.GearsStorageProvider),dojox.storage.manager.initialize()}())}});