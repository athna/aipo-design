dojo._hasResource["dojo._base.Deferred"]||(dojo._hasResource["dojo._base.Deferred"]=!0,dojo.provide("dojo._base.Deferred"),dojo.require("dojo._base.lang"),dojo.Deferred=function(e){this.chain=[],this.id=this._nextId(),this.fired=-1,this.paused=0,this.results=[null,null],this.canceller=e,this.silentlyCancelled=!1},dojo.extend(dojo.Deferred,{_nextId:function(){var e=1;return function(){return e++}}(),cancel:function(){var e;if(-1==this.fired){if(this.canceller?e=this.canceller(this):this.silentlyCancelled=!0,-1==this.fired){if(!(e instanceof Error)){var r=e;e=new Error("Deferred Cancelled"),e.dojoType="cancel",e.cancelResult=r}this.errback(e)}}else 0==this.fired&&this.results[0]instanceof dojo.Deferred&&this.results[0].cancel()},_resback:function(e){this.fired=e instanceof Error?1:0,this.results[this.fired]=e,this._fire()},_check:function(){if(-1!=this.fired){if(!this.silentlyCancelled)throw new Error("already called!");return this.silentlyCancelled=!1,void 0}},callback:function(e){this._check(),this._resback(e)},errback:function(e){this._check(),e instanceof Error||(e=new Error(e)),this._resback(e)},addBoth:function(e,r){var t=dojo.hitch(e,r);return arguments.length>2&&(t=dojo.partial(t,arguments,2)),this.addCallbacks(t,t)},addCallback:function(e,r){var t=dojo.hitch(e,r);return arguments.length>2&&(t=dojo.partial(t,arguments,2)),this.addCallbacks(t,null)},addErrback:function(e,r){var t=dojo.hitch(e,r);return arguments.length>2&&(t=dojo.partial(t,arguments,2)),this.addCallbacks(null,t)},addCallbacks:function(e,r){return this.chain.push([e,r]),this.fired>=0&&this._fire(),this},_fire:function(){for(var e=this.chain,r=this.fired,t=this.results[r],i=this,s=null;e.length>0&&0==this.paused;){var n=e.shift()[r];if(n)try{t=n(t),r=t instanceof Error?1:0,t instanceof dojo.Deferred&&(s=function(e){i._resback(e),i.paused--,0==i.paused&&i.fired>=0&&i._fire()},this.paused++)}catch(a){console.debug(a),r=1,t=a}}this.fired=r,this.results[r]=t,s&&this.paused&&t.addBoth(s)}}));