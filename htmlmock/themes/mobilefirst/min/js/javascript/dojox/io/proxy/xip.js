dojo._hasResource["dojox.io.proxy.xip"]||(dojo._hasResource["dojox.io.proxy.xip"]=!0,dojo.provide("dojox.io.proxy.xip"),dojo.require("dojo.io.iframe"),dojo.require("dojox.data.dom"),dojox.io.proxy.xip={xipClientUrl:djConfig.xipClientUrl||dojo.moduleUrl("dojox.io.proxy","xip_client.html"),_state:{},_stateIdCounter:0,needFrameRecursion:function(){return dojo.isIE>=7},send:function(e){var t="XhrIframeProxy"+this._stateIdCounter++;e._stateId=t;var o=this.xipClientUrl+"#0:init:id="+t+"&server="+encodeURIComponent(e._ifpServerUrl)+"&fr=false";if(this.needFrameRecursion()){var r=window.location.href.split("#")[0].split("?")[0];if("/"==(this.xipClientUrl+"").charAt(0)){var s=r.indexOf("://");s=r.indexOf("/",s+3),r=r.substring(0,s)}else r=r.substring(0,r.lastIndexOf("/")+1);r+=this.xipClientUrl;var i=e._ifpServerUrl+(-1==e._ifpServerUrl.indexOf("?")?"?":"&")+"dojo.fr=1";o=i+"#0:init:id="+t+"&client="+encodeURIComponent(r)+"&fr="+this.needFrameRecursion()}return this._state[t]={facade:e,stateId:t,clientFrame:dojo.io.iframe.create(t,"",o)},t},receive:function(e,t){for(var o={},r=t.split("&"),s=0;s<r.length;s++)if(r[s]){var i=r[s].split("=");o[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}var a=this._state[e],n=a.facade;if(n._setResponseHeaders(o.responseHeaders),(0==o.status||o.status)&&(n.status=parseInt(o.status,10)),o.statusText&&(n.statusText=o.statusText),o.responseText){n.responseText=o.responseText;var d=n.getResponseHeader("Content-Type");!d||"application/xml"!=d&&"text/xml"!=d||(n.responseXML=dojox.data.dom.createDocument(o.responseText,d))}n.readyState=4,this.destroyState(e)},clientFrameLoaded:function(e){var t=this._state[e],o=t.facade;if(this.needFrameRecursion())var r=window.open("",t.stateId+"_clientEndPoint");else var r=t.clientFrame.contentWindow;var s=[];for(var i in o._requestHeaders)s.push(i+": "+o._requestHeaders[i]);var a={uri:o._uri};s.length>0&&(a.requestHeaders=s.join("\r\n")),o._method&&(a.method=o._method),o._bodyData&&(a.data=o._bodyData),r.send(dojo.objectToQuery(a))},destroyState:function(e){var t=this._state[e];if(t){delete this._state[e];var o=t.clientFrame.parentNode;o.removeChild(t.clientFrame),t.clientFrame=null,t=null}},createFacade:function(){return arguments&&arguments[0]&&arguments[0].iframeProxyUrl?new dojox.io.proxy.xip.XhrIframeFacade(arguments[0].iframeProxyUrl):dojox.io.proxy.xip._xhrObjOld.apply(dojo,arguments)}},dojox.io.proxy.xip._xhrObjOld=dojo._xhrObj,dojo._xhrObj=dojox.io.proxy.xip.createFacade,dojox.io.proxy.xip.XhrIframeFacade=function(e){this._requestHeaders={},this._allResponseHeaders=null,this._responseHeaders={},this._method=null,this._uri=null,this._bodyData=null,this.responseText=null,this.responseXML=null,this.status=null,this.statusText=null,this.readyState=0,this._ifpServerUrl=e,this._stateId=null},dojo.extend(dojox.io.proxy.xip.XhrIframeFacade,{open:function(e,t){this._method=e,this._uri=t,this.readyState=1},setRequestHeader:function(e,t){this._requestHeaders[e]=t},send:function(e){this._bodyData=e,this._stateId=dojox.io.proxy.xip.send(this),this.readyState=2},abort:function(){dojox.io.proxy.xip.destroyState(this._stateId)},getAllResponseHeaders:function(){return this._allResponseHeaders},getResponseHeader:function(e){return this._responseHeaders[e]},_setResponseHeaders:function(e){if(e){this._allResponseHeaders=e,e=e.replace(/\r/g,"");for(var t=e.split("\n"),o=0;o<t.length;o++)if(t[o]){var r=t[o].split(": ");this._responseHeaders[r[0]]=r[1]}}}}));