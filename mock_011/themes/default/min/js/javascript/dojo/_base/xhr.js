dojo._hasResource["dojo._base.xhr"]||(dojo._hasResource["dojo._base.xhr"]=!0,dojo.provide("dojo._base.xhr"),dojo.require("dojo._base.Deferred"),dojo.require("dojo._base.json"),dojo.require("dojo._base.lang"),dojo.require("dojo._base.query"),function(){function e(e,o,n){var t=e[o];r.isString(t)?e[o]=[t,n]:r.isArray(t)?t.push(n):e[o]=n}var r=dojo;dojo.formToObject=function(o){var n={},t="input:not([type=file]):not([type=submit]):not([type=image]):not([type=reset]):not([type=button]), select, textarea";return r.query(t,o).filter(function(e){return!e.disabled}).forEach(function(o){var t=o.name,a=(o.type||"").toLowerCase();"radio"==a||"checkbox"==a?o.checked&&e(n,t,o.value):o.multiple?(n[t]=[],r.query("option",o).forEach(function(r){r.selected&&e(n,t,r.value)})):(e(n,t,o.value),"image"==a&&(n[t+".x"]=n[t+".y"]=n[t].x=n[t].y=0))}),n},dojo.objectToQuery=function(e){var o=encodeURIComponent,n="",t={};for(var a in e)if(e[a]!=t[a])if(r.isArray(e[a]))for(var i=0;i<e[a].length;i++)n+=o(a)+"="+o(e[a][i])+"&";else n+=o(a)+"="+o(e[a])+"&";return n.length&&"&"==n.charAt(n.length-1)&&(n=n.substr(0,n.length-1)),n},dojo.formToQuery=function(e){return r.objectToQuery(r.formToObject(e))},dojo.formToJson=function(e,o){return r.toJson(r.formToObject(e),o)},dojo.queryToObject=function(e){var o={},n=e.split("&"),t=decodeURIComponent;return r.forEach(n,function(e){if(e.length){var n=e.split("="),a=t(n.shift()),i=t(n.join("="));r.isString(o[a])&&(o[a]=[o[a]]),r.isArray(o[a])?o[a].push(i):o[a]=i}}),o},dojo._blockAsync=!1,dojo._contentHandlers={text:function(e){return e.responseText},json:function(e){return djConfig.usePlainJson||console.debug("Consider using mimetype:text/json-comment-filtered to avoid potential security issues with JSON endpoints (use djConfig.usePlainJson=true to turn off this message)"),r.fromJson(e.responseText)},"json-comment-filtered":function(e){var o=e.responseText,n=o.indexOf("/*"),t=o.lastIndexOf("*/");if(-1==n||-1==t)throw new Error("JSON was not comment filtered");return r.fromJson(o.substring(n+2,t))},javascript:function(e){return r.eval(e.responseText)},xml:function(e){return!r.isIE||e.responseXML?e.responseXML:(r.forEach(["MSXML2","Microsoft","MSXML","MSXML3"],function(r){try{var o=new ActiveXObject(prefixes[r]+".XMLDOM");return o.async=!1,o.loadXML(e.responseText),o}catch(n){}}),void 0)}},dojo._contentHandlers["json-comment-optional"]=function(e){var o=r._contentHandlers;try{return o["json-comment-filtered"](e)}catch(n){return o.json(e)}},dojo._ioSetArgs=function(e,o,n,t){var a={args:e,url:e.url},i=null;if(e.form){var u=r.byId(e.form),s=u.getAttributeNode("action");a.url=a.url||(s?s.value:null),i=r.formToObject(u)}var c=[{}];i&&c.push(i),e.content&&c.push(e.content),e.preventCache&&c.push({"dojo.preventCache":(new Date).valueOf()}),a.query=r.objectToQuery(r.mixin.apply(null,c)),a.handleAs=e.handleAs||"text";var d=new r.Deferred(o);d.addCallbacks(n,function(e){return t(e,d)});var l=e.load;l&&r.isFunction(l)&&d.addCallback(function(r){return l.call(e,r,a)});var f=e.error;f&&r.isFunction(f)&&d.addErrback(function(r){return f.call(e,r,a)});var h=e.handle;return h&&r.isFunction(h)&&d.addBoth(function(r){return h.call(e,r,a)}),d.ioArgs=a,d};var o=function(e){e.canceled=!0;var r=e.ioArgs.xhr,o=typeof r.abort;("function"==o||"unknown"==o)&&r.abort();var n=new Error("xhr cancelled");return n.dojoType="cancel",n},n=function(e){return r._contentHandlers[e.ioArgs.handleAs](e.ioArgs.xhr)},t=function(e){return console.debug(e),e},a=function(e){var a=r._ioSetArgs(e,o,n,t);return a.ioArgs.xhr=r._xhrObj(a.ioArgs.args),a},i=null,u=[],s=function(){var e=(new Date).getTime();if(!r._blockAsync)for(var o,n=0;n<u.length&&(o=u[n]);n++){var t=o.dfd;try{if(t&&!t.canceled&&o.validCheck(t)){if(o.ioCheck(t))u.splice(n--,1),o.resHandle(t);else if(t.startTime&&t.startTime+(t.ioArgs.args.timeout||0)<e){u.splice(n--,1);var a=new Error("timeout exceeded");a.dojoType="timeout",t.errback(a),t.cancel()}}else u.splice(n--,1)}catch(s){console.debug(s),t.errback(new Error("_watchInFlightError!"))}}return u.length?void 0:(clearInterval(i),i=null,void 0)};dojo._ioCancelAll=function(){try{r.forEach(u,function(e){e.dfd.cancel()})}catch(e){}},r.isIE&&r.addOnUnload(r._ioCancelAll),r._ioWatch=function(e,r,o,n){e.ioArgs.args.timeout&&(e.startTime=(new Date).getTime()),u.push({dfd:e,validCheck:r,ioCheck:o,resHandle:n}),i||(i=setInterval(s,50)),s()};var c="application/x-www-form-urlencoded",d=function(e){return e.ioArgs.xhr.readyState},l=function(e){return 4==e.ioArgs.xhr.readyState},f=function(e){r._isDocumentOk(e.ioArgs.xhr)?e.callback(e):e.errback(new Error("bad http response code:"+e.ioArgs.xhr.status))},h=function(e,o){var n=o.ioArgs,t=n.args;if(n.xhr.open(e,n.url,t.sync!==!0,t.user||void 0,t.password||void 0),t.headers)for(var a in t.headers)"content-type"!==a.toLowerCase()||t.contentType?n.xhr.setRequestHeader(a,t.headers[a]):t.contentType=t.headers[a];n.xhr.setRequestHeader("Content-Type",t.contentType||c);try{n.xhr.send(n.query)}catch(i){o.cancel()}return r._ioWatch(o,d,l,f),o};dojo._ioAddQueryToUrl=function(e){e.query.length&&(e.url+=(-1==e.url.indexOf("?")?"?":"&")+e.query,e.query=null)},dojo.xhrGet=function(e){var o=a(e);return r._ioAddQueryToUrl(o.ioArgs),h("GET",o)},dojo.xhrPost=function(e){return h("POST",a(e))},dojo.rawXhrPost=function(e){var r=a(e);return r.ioArgs.query=e.postData,h("POST",r)},dojo.xhrPut=function(e){return h("PUT",a(e))},dojo.rawXhrPut=function(e){var r=a(e),o=r.ioArgs;return e.putData&&(o.query=e.putData,e.putData=null),h("PUT",r)},dojo.xhrDelete=function(e){var o=a(e);return r._ioAddQueryToUrl(o.ioArgs),h("DELETE",o)}}());