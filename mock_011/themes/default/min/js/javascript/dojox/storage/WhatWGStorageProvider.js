dojo._hasResource["dojox.storage.WhatWGStorageProvider"]||(dojo._hasResource["dojox.storage.WhatWGStorageProvider"]=!0,dojo.provide("dojox.storage.WhatWGStorageProvider"),dojo.require("dojox.storage.Provider"),dojo.require("dojox.storage.manager"),dojo.declare("dojox.storage.WhatWGStorageProvider",[dojox.storage.Provider],{initialized:!1,_domain:null,_available:null,_statusHandler:null,_allNamespaces:null,_storageEventListener:null,initialize:function(){1!=djConfig.disableWhatWGStorage&&(this._domain="localhost"==location.hostname?"localhost.localdomain":location.hostname,this.initialized=!0,dojox.storage.manager.loaded())},isAvailable:function(){try{{globalStorage["localhost"==location.hostname?"localhost.localdomain":location.hostname]}}catch(t){return this._available=!1,this._available}return this._available=!0,this._available},put:function(t,e,o,a){if(0==this.isValidKey(t))throw new Error("Invalid key given: "+t);a=a||this.DEFAULT_NAMESPACE,t=this.getFullKey(t,a),this._statusHandler=o,e=dojo.isString(e)?"string:"+e:dojo.toJson(e);var i=dojo.hitch(this,function(){window.removeEventListener("storage",i,!1),o&&o.call(null,this.SUCCESS,t)});window.addEventListener("storage",i,!1);try{var r=globalStorage[this._domain];r.setItem(t,e)}catch(n){this._statusHandler.call(null,this.FAILED,t,n.toString())}},get:function(t,e){if(0==this.isValidKey(t))throw new Error("Invalid key given: "+t);e=e||this.DEFAULT_NAMESPACE,t=this.getFullKey(t,e);var o=globalStorage[this._domain],a=o.getItem(t);return null==a||""==a?null:(a=a.value,a=dojo.isString(a)&&/^string:/.test(a)?a.substring("string:".length):dojo.fromJson(a))},getNamespaces:function(){for(var t=[this.DEFAULT_NAMESPACE],e={},o=globalStorage[this._domain],a=/^__([^_]*)_/,i=0;i<o.length;i++){var r=o.key(i);if(1==a.test(r)){var n=r.match(a)[1];"undefined"==typeof e[n]&&(e[n]=!0,t.push(n))}}return t},getKeys:function(t){if(t=t||this.DEFAULT_NAMESPACE,0==this.isValidKey(t))throw new Error("Invalid namespace given: "+t);var e;e=t==this.DEFAULT_NAMESPACE?new RegExp("^([^_]{2}.*)$"):new RegExp("^__"+t+"_(.*)$");for(var o=globalStorage[this._domain],a=[],i=0;i<o.length;i++){var r=o.key(i);1==e.test(r)&&(r=r.match(e)[1],a.push(r))}return a},clear:function(t){if(t=t||this.DEFAULT_NAMESPACE,0==this.isValidKey(t))throw new Error("Invalid namespace given: "+t);var e;e=t==this.DEFAULT_NAMESPACE?new RegExp("^[^_]{2}"):new RegExp("^__"+t+"_");for(var o=globalStorage[this._domain],a=[],i=0;i<o.length;i++)1==e.test(o.key(i))&&(a[a.length]=o.key(i));dojo.forEach(a,dojo.hitch(o,"removeItem"))},remove:function(t,e){t=this.getFullKey(t,e);var o=globalStorage[this._domain];o.removeItem(t)},isPermanent:function(){return!0},getMaximumSize:function(){return this.SIZE_NO_LIMIT},hasSettingsUI:function(){return!1},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface")},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface")},getFullKey:function(t,e){if(e=e||this.DEFAULT_NAMESPACE,0==this.isValidKey(e))throw new Error("Invalid namespace given: "+e);return e==this.DEFAULT_NAMESPACE?t:"__"+e+"_"+t}}),dojox.storage.manager.register("dojox.storage.WhatWGStorageProvider",new dojox.storage.WhatWGStorageProvider));