dojo._hasResource["dijit._base.focus"]||(dojo._hasResource["dijit._base.focus"]=!0,dojo.provide("dijit._base.focus"),dojo.mixin(dijit,{_curFocus:null,_prevFocus:null,isCollapsed:function(){var o=dojo.global,e=dojo.doc;if(e.selection)return!e.selection.createRange().text;if(o.getSelection){var t=o.getSelection();return dojo.isString(t)?!t:t.isCollapsed||!t.toString()}},getBookmark:function(){var o,e=dojo.doc.selection;if(e){var t=e.createRange();o="CONTROL"==e.type.toUpperCase()?t.length?dojo._toArray(t):null:t.getBookmark()}else if(dojo.global.getSelection){if(e=dojo.global.getSelection()){var t=e.getRangeAt(0);o=t.cloneRange()}}else console.debug("No idea how to store the current selection for this browser!");return o},moveToBookmark:function(o){var e=dojo.doc;if(e.selection){var t;dojo.isArray(o)?(t=e.body.createControlRange(),dojo.forEach(o,t.addElement)):(t=e.selection.createRange(),t.moveToBookmark(o)),t.select()}else{var i=dojo.global.getSelection&&dojo.global.getSelection();i&&i.removeAllRanges?(i.removeAllRanges(),i.addRange(o)):console.debug("No idea how to restore selection for this browser!")}},getFocus:function(o,e){return{node:o&&dojo.isDescendant(dijit._curFocus,o.domNode)?dijit._prevFocus:dijit._curFocus,bookmark:dojo.withGlobal(e||dojo.global,dijit.isCollapsed)?null:dojo.withGlobal(e||dojo.global,dijit.getBookmark),openedForWindow:e}},focus:function(o){if(o){var e="node"in o?o.node:o,t=o.bookmark,i=o.openedForWindow;if(e){var d="iframe"==e.tagName.toLowerCase()?e.contentWindow:e;if(d&&d.focus)try{d.focus()}catch(n){}dijit._onFocusNode(e)}if(t&&dojo.withGlobal(i||dojo.global,dijit.isCollapsed)){i&&i.focus();try{dojo.withGlobal(i||dojo.global,moveToBookmark,null,[t])}catch(n){}}}},_activeStack:[],registerWin:function(o){o||(o=window),dojo.connect(o.document,"onmousedown",null,function(o){dijit._justMouseDowned=!0,setTimeout(function(){dijit._justMouseDowned=!1},0),dijit._onTouchNode(o.target||o.srcElement)});var e=o.document.body||o.document.getElementsByTagName("body")[0];e&&(dojo.isIE&&dojo.isIE<11?(e.attachEvent("onactivate",function(o){"body"!=o.srcElement.tagName.toLowerCase()&&dijit._onFocusNode(o.srcElement)}),e.attachEvent("ondeactivate",function(o){dijit._onBlurNode(o.srcElement)})):(e.addEventListener("focus",function(o){dijit._onFocusNode(o.target)},!0),e.addEventListener("blur",function(o){dijit._onBlurNode(o.target)},!0))),e=null},_onBlurNode:function(o){dijit._prevFocus=dijit._curFocus,dijit._curFocus=null;var e=dijit.getEnclosingWidget(o);e&&e._setStateClass&&(e._focused=!1,e._setStateClass()),dijit._justMouseDowned||(dijit._clearActiveWidgetsTimer&&clearTimeout(dijit._clearActiveWidgetsTimer),dijit._clearActiveWidgetsTimer=setTimeout(function(){delete dijit._clearActiveWidgetsTimer,dijit._setStack([])},100))},_onTouchNode:function(o){dijit._clearActiveWidgetsTimer&&(clearTimeout(dijit._clearActiveWidgetsTimer),delete dijit._clearActiveWidgetsTimer);var e=[];try{for(;o;)if(o.dijitPopupParent)o=dijit.byId(o.dijitPopupParent).domNode;else if(o.tagName&&"body"==o.tagName.toLowerCase()){if(o===dojo.body())break;o=dojo.query("iframe").filter(function(e){return e.contentDocument.body===o})[0]}else{var t=o.getAttribute&&o.getAttribute("widgetId");t&&e.unshift(t),o=o.parentNode}}catch(i){}dijit._setStack(e)},_onFocusNode:function(o){if(!(o&&o.tagName&&"body"==o.tagName.toLowerCase()||(dijit._onTouchNode(o),o==dijit._curFocus))){dijit._prevFocus=dijit._curFocus,dijit._curFocus=o,dojo.publish("focusNode",[o]);var e=dijit.getEnclosingWidget(o);e&&e._setStateClass&&(e._focused=!0,e._setStateClass())}},_setStack:function(o){var e=dijit._activeStack;dijit._activeStack=o;for(var t=0;t<Math.min(e.length,o.length)&&e[t]==o[t];t++);for(var i=e.length-1;i>=t;i--){var d=dijit.byId(e[i]);d&&(dojo.publish("widgetBlur",[d]),d._onBlur&&d._onBlur())}for(var i=t;i<o.length;i++){var d=dijit.byId(o[i]);d&&(dojo.publish("widgetFocus",[d]),d._onFocus&&d._onFocus())}}}),dojo.addOnLoad(dijit.registerWin));