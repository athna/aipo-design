dojo.require("dojox.gfx.vml"),dojo.experimental("dojox.gfx.vml_attach"),function(){dojox.gfx.attachNode=function(p){if(!p)return null;var c=null;switch(p.tagName.toLowerCase()){case dojox.gfx.Rect.nodeType:c=new dojox.gfx.Rect(p),a(c);break;case dojox.gfx.Ellipse.nodeType:p.style.width==p.style.height?(c=new dojox.gfx.Circle(p),l(c)):(c=new dojox.gfx.Ellipse(p),r(c));break;case dojox.gfx.Path.nodeType:switch(p.getAttribute("dojoGfxType")){case"line":c=new dojox.gfx.Line(p),n(c);break;case"polyline":c=new dojox.gfx.Polyline(p),x(c);break;case"path":c=new dojox.gfx.Path(p),h(c);break;case"text":c=new dojox.gfx.Text(p),s(c),f(c),g(c);break;case"textpath":c=new dojox.gfx.TextPath(p),h(c),s(c),f(c)}break;case dojox.gfx.Image.nodeType:switch(p.getAttribute("dojoGfxType")){case"image":c=new dojox.gfx.Image(p),i(c),d(c)}break;default:return null}return c instanceof dojox.gfx.Image||(e(c),o(c),c instanceof dojox.gfx.Text||t(c)),c},dojox.gfx.attachSurface=function(e){var o=new dojox.gfx.Surface;o.clipNode=e;var t=o.rawNode=e.firstChild,a=t.firstChild;return a&&"rect"==a.tagName?(o.bgNode=t,o):null};var e=function(e){var o=null,t=e.rawNode,a=t.fill;if(a.on&&"gradient"==a.type){var o=dojo.clone(dojox.gfx.defaultLinearGradient),r=dojox.gfx.matrix._degToRad(a.angle);o.x2=Math.cos(r),o.y2=Math.sin(r),o.colors=[];for(var l=a.colors.value.split(";"),n=0;n<l.length;++n){var x=l[n].match(/\S+/g);x&&2==x.length&&o.colors.push({offset:dojox.gfx.vml._parseFloat(x[0]),color:new dojo.Color(x[1])})}}else if(a.on&&"gradientradial"==a.type){var o=dojo.clone(dojox.gfx.defaultRadialGradient),i=parseFloat(t.style.width),d=parseFloat(t.style.height);o.cx=isNaN(i)?0:a.focusposition.x*i,o.cy=isNaN(d)?0:a.focusposition.y*d,o.r=isNaN(i)?1:i/2,o.colors=[];for(var l=a.colors.value.split(";"),n=l.length-1;n>=0;--n){var x=l[n].match(/\S+/g);x&&2==x.length&&o.colors.push({offset:dojox.gfx.vml._parseFloat(x[0]),color:new dojo.Color(x[1])})}}else if(a.on&&"tile"==a.type){var o=dojo.clone(dojox.gfx.defaultPattern);o.width=dojox.gfx.pt2px(a.size.x),o.height=dojox.gfx.pt2px(a.size.y),o.x=a.origin.x*o.width,o.y=a.origin.y*o.height,o.src=a.src}else a.on&&t.fillcolor&&(o=new dojo.Color(t.fillcolor+""),o.a=a.opacity);e.fillStyle=o},o=function(e){var o=e.rawNode;if(!o.stroked)return e.strokeStyle=null,void 0;var t=e.strokeStyle=dojo.clone(dojox.gfx.defaultStroke),a=o.stroke;t.color=new dojo.Color(o.strokecolor.value),t.width=dojox.gfx.normalizedLength(o.strokeweight+""),t.color.a=a.opacity,t.cap=this._translate(this._capMapReversed,a.endcap),t.join="miter"==a.joinstyle?a.miterlimit:a.joinstyle,t.style=a.dashstyle},t=function(e){var o=rawNode.skew,t=o.matrix,a=o.offset;e.matrix=dojox.gfx.matrix.normalize({xx:t.xtox,xy:t.ytox,yx:t.xtoy,yy:t.ytoy,dx:dojox.gfx.pt2px(a.x),dy:dojox.gfx.pt2px(a.y)})},a=function(e){var o=e.rawNode,t=o.outerHTML.match(/arcsize = \"(\d*\.?\d+[%f]?)\"/)[1],a=o.style,r=parseFloat(a.width),l=parseFloat(a.height);t=t.indexOf("%")>=0?parseFloat(t)/100:dojox.gfx.vml._parseFloat(t),e.shape=dojox.gfx.makeParameters(dojox.gfx.defaultRect,{x:parseInt(a.left),y:parseInt(a.top),width:r,height:l,r:Math.min(r,l)*t})},r=function(e){var o=e.rawNode.style,t=parseInt(o.width)/2,a=parseInt(o.height)/2;e.shape=dojox.gfx.makeParameters(dojox.gfx.defaultEllipse,{cx:parseInt(o.left)+t,cy:parseInt(o.top)+a,rx:t,ry:a})},l=function(e){var o=e.rawNode.style,t=parseInt(o.width)/2;e.shape=dojox.gfx.makeParameters(dojox.gfx.defaultCircle,{cx:parseInt(o.left)+t,cy:parseInt(o.top)+t,r:t})},n=function(e){var o=e.shape=dojo.clone(dojox.gfx.defaultLine),t=e.rawNode.path.v.match(dojox.gfx.pathVmlRegExp);do{if(t.length<7||"m"!=t[0]||"l"!=t[3]||"e"!=t[6])break;o.x1=parseInt(t[1]),o.y1=parseInt(t[2]),o.x2=parseInt(t[4]),o.y2=parseInt(t[5])}while(!1)},x=function(e){var o=e.shape=dojo.clone(dojox.gfx.defaultPolyline),t=e.rawNode.path.v.match(dojox.gfx.pathVmlRegExp);do{if(t.length<3||"m"!=t[0])break;var a=parseInt(t[0]),r=parseInt(t[1]);if(isNaN(a)||isNaN(r))break;if(o.points.push({x:a,y:r}),t.length<6||"l"!=t[3])break;for(var l=4;l<t.length&&(a=parseInt(t[l]),r=parseInt(t[l+1]),!isNaN(a)&&!isNaN(r));l+=2)o.points.push({x:a,y:r})}while(!1)},i=function(e){e.shape=dojo.clone(dojox.gfx.defaultImage),e.shape.src=e.rawNode.firstChild.src},d=function(e){var o=e.rawNode.filters["DXImageTransform.Microsoft.Matrix"];e.matrix=dojox.gfx.matrix.normalize({xx:o.M11,xy:o.M12,yx:o.M21,yy:o.M22,dx:o.Dx,dy:o.Dy})},s=function(e){var o=e.shape=dojo.clone(dojox.gfx.defaultText),t=e.rawNode,a=t.path.v.match(dojox.gfx.pathVmlRegExp);do{if(!a||7!=a.length)break;for(var r=t.childNodes,l=0;l<r.length&&"textpath"!=r[l].tagName;++l);if(l>=r.length)break;var n=r[l].style;switch(o.text=r[l].string,n["v-text-align"]){case"left":o.x=parseInt(a[1]),o.align="start";break;case"center":o.x=(parseInt(a[1])+parseInt(a[4]))/2,o.align="middle";break;case"right":o.x=parseInt(a[4]),o.align="end"}return o.y=parseInt(a[2]),o.decoration=n["text-decoration"],o.rotated=n["v-rotate-letters"].toLowerCase()in dojox.gfx.vml._bool,o.kerning=n["v-text-kern"].toLowerCase()in dojox.gfx.vml._bool,void 0}while(!1);e.shape=null},f=function(e){for(var o=e.fontStyle=dojo.clone(dojox.gfx.defaultFont),t=e.rawNode.childNodes,a=0;a<t.length&&"textpath"==t[a].tagName;++a);if(a>=t.length)return e.fontStyle=null,void 0;var r=t[a].style;o.style=r.fontstyle,o.variant=r.fontvariant,o.weight=r.fontweight,o.size=r.fontsize,o.family=r.fontfamily},g=function(e){t(e);var o=e.matrix,a=e.fontStyle;o&&a&&(e.matrix=dojox.gfx.matrix.multiply(o,{dy:.35*dojox.gfx.normalizedLength(a.size)}))},h=function(e){for(var o=e.shape=dojo.clone(dojox.gfx.defaultPath),t=rawNode.path.v.match(dojox.gfx.pathVmlRegExp),a=[],r=!1,l=dojox.gfx.Path._pathVmlToSvgMap,n=0;n<t.length;++t){var x=t[n];if(x in l)r=!1,a.push(l[x]);else if(!r){var i=parseInt(x);isNaN(i)?r=!0:a.push(i)}}var d=a.length;d>=4&&""==a[d-1]&&0==a[d-2]&&0==a[d-3]&&"l"==a[d-4]&&a.splice(d-4,4),d&&(o.path=a.join(" "))}}();