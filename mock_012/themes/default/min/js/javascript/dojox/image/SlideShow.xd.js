dojo._xdResourceLoaded({depends:[["provide","dojox.image.SlideShow"],["require","dojo.fx"],["require","dijit._Widget"],["require","dijit._Templated"]],defineResource:function(t){t._hasResource["dojox.image.SlideShow"]||(t._hasResource["dojox.image.SlideShow"]=!0,t.provide("dojox.image.SlideShow"),t.require("dojo.fx"),t.require("dijit._Widget"),t.require("dijit._Templated"),t.declare("dojox.image.SlideShow",[dijit._Widget,dijit._Templated],{imageHeight:375,imageWidth:500,title:"",titleTemplate:'@title <span class="slideShowCounterText">(@current of @total)</span>',noLink:!1,loop:!0,hasNav:!0,images:[],pageSize:20,autoLoad:!0,fixedHeight:!1,imageStore:null,linkAttr:"link",imageLargeAttr:"imageUrl",titleAttr:"title",slideshowInterval:3,templateString:'<div dojoAttachPoint="outerNode" class="slideShowWrapper">\r\n	<div style="position:relative;" dojoAttachPoint="innerWrapper">\r\n		<div class="slideShowNav" dojoAttachEvent="onclick: _handleClick">\r\n			<div class="dijitInline slideShowTitle" dojoAttachPoint="titleNode">${title}</div>\r\n		</div>\r\n		<div dojoAttachPoint="navNode" class="slideShowCtrl" dojoAttachEvent="onclick: _handleClick">\r\n			<span dojoAttachPoint="navPrev" class="slideShowCtrlPrev"></span>\r\n			<span dojoAttachPoint="navPlay" class="slideShowCtrlPlay"></span>\r\n			<span dojoAttachPoint="navNext" class="slideShowCtrlNext"></span>\r\n		</div>\r\n		<div dojoAttachPoint="largeNode" class="slideShowImageWrapper"></div>		\r\n		<div dojoAttachPoint="hiddenNode" class="slideShowHidden"></div>\r\n	</div>\r\n</div>\r\n',_tempImgPath:t.moduleUrl("dojox.image","resources/images/1pixel.gif"),_imageCounter:0,_tmpImage:null,_request:null,postCreate:function(){this.inherited("postCreate",arguments);var e=document.createElement("img");e.setAttribute("width",this.imageWidth),e.setAttribute("height",this.imageHeight),this.hasNav&&(t.connect(this.outerNode,"onmouseover",function(){try{i._showNav()}catch(t){}}),t.connect(this.outerNode,"onmouseout",function(t){try{i._hideNav(t)}catch(e){}})),this.outerNode.style.width=this.imageWidth+"px",e.setAttribute("src",this._tempImgPath);var i=this;this.largeNode.appendChild(e),this._tmpImage=e,this._currentImage=e,this._fitSize(!0),this._loadImage(0,function(){i.showImage(0)}),this._calcNavDimensions()},setDataStore:function(e,i,s){this.reset();var a=this;this._request={query:{},start:i.start?i.start:0,count:i.count?i.count:this.pageSize,onBegin:function(t){a.maxPhotos=t}},i.query&&t.mixin(this._request.query,i.query),s&&s.imageLargeAttr&&(this.imageLargeAttr=s.imageLargeAttr);var a=this,o=function(){a.showImage(0),a._request.onComplete=null};this.imageStore=e,this._request.onComplete=o,this._request.start=0,this.imageStore.fetch(this._request)},reset:function(){for(;this.largeNode.firstChild;)this.largeNode.removeChild(this.largeNode.firstChild);for(this.largeNode.appendChild(this._tmpImage);this.hiddenNode.firstChild;)this.hiddenNode.removeChild(this.hiddenNode.firstChild);for(var t,e=0;e<this.images.length;e++)t=this.images[e],t&&t.parentNode&&t.parentNode.removeChild(t);this.images=[],this.isInitialized=!1,this._imageCounter=0},isImageLoaded:function(t){return this.images&&this.images.length>index&&this.images[t]},moveImageLoadingPointer:function(t){this._imageCounter=t},destroy:function(){this._slideId&&this._stop(),this.inherited("destroy",arguments)},showNextImage:function(t,e){if(t&&this._timerCancelled)return!1;if(this.imageIndex+1>=this.maxPhotos){if(!t||!this.loop&&!e)return this._slideId&&this._stop(),!1;this.imageIndex=-1}var i=this;return this.showImage(this.imageIndex+1,function(){t&&i._startTimer()}),!0},toggleSlideShow:function(){if(this._slideId)this._stop();else{t.toggleClass(this.domNode,"slideShowPaused"),this._timerCancelled=!1;var e=this.showNextImage(!0,!0);e||this._stop()}},getShowTopicName:function(){return(this.widgetId?this.widgetId:this.id)+"/imageShow"},getLoadTopicName:function(){return(this.widgetId?this.widgetId:this.id)+"/imageLoad"},showImage:function(e,i){!i&&this._slideId&&this.toggleSlideShow();var s=this,a=this.largeNode.getElementsByTagName("div");this.imageIndex=e;var o=function(){if(s.images[e]){for(;s.largeNode.firstChild;)s.largeNode.removeChild(s.largeNode.firstChild);s.images[e].style.opacity=0,s.largeNode.appendChild(s.images[e]),s._currentImage=s.images[e]._img,s._fitSize();var a=function(a,o,n){var h=s.images[e].firstChild;"img"!=h.tagName.toLowerCase()&&(h=h.firstChild),title=h.getAttribute("title"),s._navShowing&&s._showNav(!0),t.publish(s.getShowTopicName(),[{index:e,title:title,url:h.getAttribute("src")}]),i&&i(a,o,n),s._setTitle(title)};t.fadeIn({node:s.images[e],duration:300,onEnd:a}).play()}else s._loadImage(e,function(){t.publish(s.getLoadTopicName(),[e]),s.showImage(e,i)})};a&&a.length>0?t.fadeOut({node:a[0],duration:300,onEnd:function(){s.hiddenNode.appendChild(a[0]),o()}}).play():o()},_fitSize:function(e){if(!this.fixedHeight||e){var i=this._currentImage.height+(this.hasNav?20:0);return t.style(this.innerWrapper,"height",i+"px"),void 0}t.style(this.largeNode,"paddingTop",this._getTopPadding()+"px")},_getTopPadding:function(){return this.fixedHeight?(this.imageHeight-this._currentImage.height)/2:0},_loadNextImage:function(){if(this.autoLoad){for(;this.images.length>=this._imageCounter&&this.images[this._imageCounter];)this._imageCounter++;this._loadImage(this._imageCounter)}},_loadImage:function(e,i){if(!this.images[e]&&this._request){var s=e-e%this.pageSize;this._request.start=s,this._request.onComplete=function(t){var i=e-s;t&&t.length>i&&o(t[i])};var a=this,o=function(s){var o=a.imageStore.getValue(s,a.imageLargeAttr),n=document.createElement("img"),h=document.createElement("div");h._img=n;var d=a.imageStore.getValue(s,a.linkAttr);if(!d||a.noLink)h.appendChild(n);else{var r=document.createElement("a");r.setAttribute("href",d),r.setAttribute("target","_blank"),h.appendChild(r),r.appendChild(n)}h.setAttribute("id",a.id+"_imageDiv"+e),t.connect(n,"onload",function(){a._fitImage(n),h.setAttribute("width",a.imageWidth),h.setAttribute("height",a.imageHeight),t.publish(a.getLoadTopicName(),[e]),a._loadNextImage(),i&&i()}),a.hiddenNode.appendChild(h);var l=document.createElement("div");t.addClass(l,"slideShowTitle"),h.appendChild(l),a.images[e]=h,n.setAttribute("src",o);var g=a.imageStore.getValue(s,a.titleAttr);g&&n.setAttribute("title",g)};this.imageStore.fetch(this._request)}},_stop:function(){this._slideId&&clearTimeout(this._slideId),this._slideId=null,this._timerCancelled=!0,t.removeClass(this.domNode,"slideShowPaused")},_prev:function(){this.imageIndex<1||this.showImage(this.imageIndex-1)},_next:function(){this.showNextImage()},_startTimer:function(){this._slideId=setTimeout("dijit.byId('"+this.id+"').showNextImage(true);",1e3*this.slideshowInterval)},_calcNavDimensions:function(){t.style(this.navNode,"position","absolute"),t.style(this.navNode,"left","-10000px"),t._setOpacity(this.navNode,99),this.navPlay._size=t.marginBox(this.navPlay),this.navPrev._size=t.marginBox(this.navPrev),this.navNext._size=t.marginBox(this.navNext),t._setOpacity(this.navNode,0),t.style(this.navNode,"position",""),t.style(this.navNode,"left","")},_setTitle:function(t){this.titleNode.innerHTML=this.titleTemplate.replace("@title",t).replace("@current",String(Number(this.imageIndex)+1)).replace("@total",String(this.maxPhotos))},_fitImage:function(t){var e=t.width,i=t.height;e>this.imageWidth&&(i=Math.floor(i*(this.imageWidth/e)),t.setAttribute("height",i+"px"),t.setAttribute("width",this.imageWidth+"px")),i>this.imageHeight&&(e=Math.floor(e*(this.imageHeight/i)),t.setAttribute("height",this.imageHeight+"px"),t.setAttribute("width",e+"px"))},_handleClick:function(t){switch(t.target){case this.navNext:this._next();break;case this.navPrev:this._prev();break;case this.navPlay:this.toggleSlideShow()}},_showNav:function(e){if(!this._navShowing||e){t.style(this.navNode,"marginTop","0px"),t.style(this.navPlay,"marginLeft","0px");var i=(t.marginBox(this.outerNode),this._currentImage.height-this.navPlay._size.h-10+this._getTopPadding());i>this._currentImage.height&&(i+=10),t[this.imageIndex<1?"addClass":"removeClass"](this.navPrev,"slideShowCtrlHide"),t[this.imageIndex+1>=this.maxPhotos?"addClass":"removeClass"](this.navNext,"slideShowCtrlHide");var s=this;this._navAnim&&this._navAnim.stop(),this._navShowing||(this._navAnim=t.fadeIn({node:this.navNode,duration:300,onEnd:function(){s._navAnim=null}}),this._navAnim.play(),this._navShowing=!0)}},_hideNav:function(e){if(!e||!this._overElement(this.outerNode,e)){var i=this;this._navAnim&&this._navAnim.stop(),this._navAnim=t.fadeOut({node:this.navNode,duration:300,onEnd:function(){i._navAnim=null}}),this._navAnim.play(),this._navShowing=!1}},_overElement:function(e,i){if("undefined"==typeof t)return!1;e=t.byId(e);var s={x:i.pageX,y:i.pageY},a=t._getBorderBox(e),o=t.coords(e,!0),n=o.x;return s.x>=n&&s.x<=n+a.w&&s.y>=o.y&&s.y<=top+a.h}}))}});