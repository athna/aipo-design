dojo._hasResource["dojo.dnd.Selector"]||(dojo._hasResource["dojo.dnd.Selector"]=!0,dojo.provide("dojo.dnd.Selector"),dojo.require("dojo.dnd.common"),dojo.require("dojo.dnd.Container"),dojo.declare("dojo.dnd.Selector",dojo.dnd.Container,{constructor:function(e,t){t||(t={}),this.singular=t.singular,this.selection={},this.anchor=null,this.simpleSelection=!1,this.events.push(dojo.connect(this.node,"onmousedown",this,"onMouseDown"),dojo.connect(this.node,"onmouseup",this,"onMouseUp"))},singular:!1,getSelectedNodes:function(){var e=new dojo.NodeList,t=dojo.dnd._empty;for(var o in this.selection)o in t||e.push(dojo.byId(o));return e},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){return this.forInItems(function(e,t){this._addItemClass(dojo.byId(t),"Selected"),this.selection[t]=1},this),this._removeAnchor()},deleteSelectedNodes:function(){var e=dojo.dnd._empty;for(var t in this.selection)if(!(t in e)){var o=dojo.byId(t);this.delItem(t),dojo._destroyElement(o)}return this.anchor=null,this.selection={},this},insertNodes:function(e,t,o,s){var n=this._normalizedCreator;return this._normalizedCreator=function(t,o){var s=n.call(this,t,o);return e?(this.anchor?this.anchor!=s.node&&(this._removeItemClass(s.node,"Anchor"),this._addItemClass(s.node,"Selected")):(this.anchor=s.node,this._removeItemClass(s.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[s.node.id]=1):(this._removeItemClass(s.node,"Selected"),this._removeItemClass(s.node,"Anchor")),s},dojo.dnd.Selector.superclass.insertNodes.call(this,t,o,s),this._normalizedCreator=n,this},destroy:function(){dojo.dnd.Selector.superclass.destroy.call(this),this.selection=this.anchor=null},markupFactory:function(e,t){return e._skipStartup=!0,new dojo.dnd.Selector(t,e)},onMouseDown:function(e){if(this.current){if(!this.singular&&!dojo.dnd.getCopyKeyState(e)&&!e.shiftKey&&this.current.id in this.selection)return this.simpleSelection=!0,dojo.stopEvent(e),void 0;if(!this.singular&&e.shiftKey){dojo.dnd.getCopyKeyState(e)||this._removeSelection();var t=dojo.query("> .dojoDndItem",this.parent);if(t.length&&(this.anchor||(this.anchor=t[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var o=0;o<t.length;++o){var s=t[o];if(s==this.anchor||s==this.current)break}for(++o;o<t.length;++o){var s=t[o];if(s==this.anchor||s==this.current)break;this._addItemClass(s,"Selected"),this.selection[s.id]=1}this._addItemClass(this.current,"Selected"),this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?dojo.dnd.getCopyKeyState(e)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):dojo.dnd.getCopyKeyState(e)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);dojo.stopEvent(e)}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=dojo.connect(this.node,"onmousemove",this,"onMouseMove")},onOutEvent:function(){dojo.disconnect(this.onmousemoveEvent),delete this.onmousemoveEvent},_removeSelection:function(){var e=dojo.dnd._empty;for(var t in this.selection)if(!(t in e)){var o=dojo.byId(t);o&&this._removeItemClass(o,"Selected")}return this.selection={},this},_removeAnchor:function(){return this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null),this}}));