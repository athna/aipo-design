dojo._hasResource["dojox.off.files"]||(dojo._hasResource["dojox.off.files"]=!0,dojo.provide("dojox.off.files"),dojox.off.files={versionURL:"version.js",listOfURLs:[],refreshing:!1,_cancelID:null,_error:!1,_errorMessages:[],_currentFileIndex:0,_store:null,_doSlurp:!1,slurp:function(){this._doSlurp=!0},cache:function(o){if(dojo.isString(o)){var e=this._trimAnchor(o+"");this.isAvailable(e)||this.listOfURLs.push(e)}else if(o instanceof dojo._Url){var e=this._trimAnchor(o.uri);this.isAvailable(e)||this.listOfURLs.push(e)}else dojo.forEach(o,function(o){o=this._trimAnchor(o),this.isAvailable(o)||this.listOfURLs.push(o)},this)},printURLs:function(){console.debug("The following URLs are cached for offline use:"),dojo.forEach(this.listOfURLs,function(o){console.debug(o)})},remove:function(o){for(var e=0;e<this.listOfURLs.length;e++)if(this.listOfURLs[e]==o){this.listOfURLs=this.listOfURLs.splice(e,1);break}},isAvailable:function(o){for(var e=0;e<this.listOfURLs.length;e++)if(this.listOfURLs[e]==o)return!0;return!1},refresh:function(o){try{djConfig.isDebug&&this.printURLs(),this.refreshing=!0,this.versionURL?this._getVersionInfo(function(e,t,r){djConfig.isDebug||!t||r||!e||e!=t?(console.warn("Refreshing offline file list"),this._doRefresh(o,t)):(console.warn("No need to refresh offline file list"),o(!1,[]))}):(console.warn("Refreshing offline file list"),this._doRefresh(o))}catch(e){this.refreshing=!1,dojox.off.coreOpFailed=!0,dojox.off.enabled=!1,dojox.off.onFrameworkEvent("coreOperationFailed")}},abortRefresh:function(){this.refreshing&&(this._store.abortCapture(this._cancelID),this.refreshing=!1)},_slurp:function(){if(this._doSlurp){var o=dojo.hitch(this,function(o){this._sameLocation(o)&&this.cache(o)});o(window.location.href),dojo.query("script").forEach(function(e){try{o(e.getAttribute("src"))}catch(t){}}),dojo.query("link").forEach(function(e){try{if(!e.getAttribute("rel")||"stylesheet"!=e.getAttribute("rel").toLowerCase())return;o(e.getAttribute("href"))}catch(t){}}),dojo.query("img").forEach(function(e){try{o(e.getAttribute("src"))}catch(t){}}),dojo.query("a").forEach(function(e){try{o(e.getAttribute("href"))}catch(t){}}),dojo.forEach(document.styleSheets,function(e){try{if(e.cssRules)dojo.forEach(e.cssRules,function(e){var t=e.cssText;if(t){var r=t.match(/url\(\s*([^\) ]*)\s*\)/i);if(!r)return;for(var i=1;i<r.length;i++)o(r[i])}});else if(e.cssText)for(var t,r=e.cssText.toString(),i=r.split(/\f|\r|\n/),s=0;s<i.length;s++)t=i[s].match(/url\(\s*([^\) ]*)\s*\)/i),t&&t.length&&o(t[1])}catch(n){}})}},_sameLocation:function(o){return o?o.length&&"#"==o.charAt(0)?!1:(o=new dojo._Url(o),o.scheme||o.port||o.host?!o.scheme&&o.host&&o.port&&window.location.hostname==o.host&&window.location.port==o.port?!0:o.scheme||!o.host||o.port||window.location.hostname!=o.host||80!=window.location.port?window.location.protocol==o.scheme+":"&&window.location.hostname==o.host&&(window.location.port==o.port||!window.location.port&&!o.port):!0:!0):!1},_trimAnchor:function(o){return o.replace(/\#.*$/,"")},_doRefresh:function(o,e){var t;try{t=google.gears.factory.create("beta.localserver","1.0")}catch(r){throw dojo.setObject("google.gears.denied",!0),dojox.off.onFrameworkEvent("coreOperationFailed"),"Google Gears must be allowed to run"}var i="dot_store_"+window.location.href.replace(/[^0-9A-Za-z_]/g,"_");t.removeStore(i),t.openStore(i);var s=t.createStore(i);this._store=s;var n=this;this._currentFileIndex=0,this._cancelID=s.capture(this.listOfURLs,function(t,r){if(!r&&n.refreshing){n._cancelID=null,n.refreshing=!1;var i=[];return i.push("Unable to capture: "+t),o(!0,i),void 0}r&&n._currentFileIndex++,r&&n._currentFileIndex>=n.listOfURLs.length&&(n._cancelID=null,n.refreshing=!1,e&&dojox.storage.put("oldVersion",e,null,dojox.off.STORAGE_NAMESPACE),dojox.storage.put("justDebugged",djConfig.isDebug,null,dojox.off.STORAGE_NAMESPACE),o(!1,[]))})},_getVersionInfo:function(o){var e=dojox.storage.get("justDebugged",dojox.off.STORAGE_NAMESPACE),t=dojox.storage.get("oldVersion",dojox.off.STORAGE_NAMESPACE),r=null;o=dojo.hitch(this,o),dojo.xhrGet({url:this.versionURL+"?browserbust="+(new Date).getTime(),timeout:5e3,handleAs:"javascript",error:function(){dojox.storage.remove("oldVersion",dojox.off.STORAGE_NAMESPACE),dojox.storage.remove("justDebugged",dojox.off.STORAGE_NAMESPACE),o(t,r,e)},load:function(i){i&&(r=i),o(t,r,e)}})}});