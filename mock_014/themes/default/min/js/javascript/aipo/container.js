aipo.PortletLayoutManager=function(){shindig.LayoutManager.call(this)},aipo.PortletLayoutManager.inherits(shindig.LayoutManager),aipo.PortletLayoutManager.prototype.getGadgetChrome=function(e){var t="gadget-chrome-"+e.portletId;return t?document.getElementById(t):null},aipo.PsmlUserPrefStore=function(){shindig.UserPrefStore.call(this)},aipo.PsmlUserPrefStore.inherits(shindig.UserPrefStore),aipo.PsmlUserPrefStore.prototype.getPrefs=function(){},aipo.PsmlUserPrefStore.prototype.savePrefs=function(){},aipo.IfrGadget={getMainContent:function(e){var t=this.getIframeId();gadgets.rpc.setRelayUrl(t,this.serverBase_+this.rpcRelay),gadgets.rpc.setAuthToken(t,this.rpcToken),e('<div class="'+this.cssClassGadgetContent+'"><iframe id="'+t+'" name="'+t+'" class="'+this.cssClassGadget+'" src="about:blank" frameborder="no"'+(this.scrolling?' scrolling="'+this.scrolling+'"':"no")+(this.height?' height="'+this.height+'"':"")+(this.width?' width="'+this.width+'"':"")+"></iframe></div>")},finishRender:function(){window.frames[this.getIframeId()].location=this.getIframeUrl()},getIframeUrl:function(){return this.serverBase_+"ifr?container="+this.CONTAINER+"&mid="+this.id+"&nocache="+aipo.container.nocache_+"&country="+aipo.container.country_+"&lang="+aipo.container.language_+"&view="+aipo.container.view_+(this.specVersion?"&v="+this.specVersion:"")+(shindig.container.parentUrl_?"&parent="+encodeURIComponent(shindig.container.parentUrl_):"")+(this.debug?"&debug=1":"")+this.getAdditionalParams()+this.getUserPrefsParams()+(this.secureToken?"&st="+this.secureToken:"")+"&url="+encodeURIComponent(this.specUrl)+"#rpctoken="+this.rpcToken+(this.viewParams?"&view-params="+encodeURIComponent(gadgets.json.stringify(this.viewParams)):"")+(this.hashData?"&"+this.hashData:"")}},aipo.IfrGadgetService=function(){shindig.IfrGadgetService.call(this),gadgets.rpc.register("set_pref",this.setUserPref),gadgets.rpc.register("set_title",this.setTitle),gadgets.rpc.register("requestNavigateTo",this.requestNavigateTo),gadgets.rpc.register("requestCheckActivity",this.requestCheckActivity),gadgets.rpc.register("requestCheckTimeline",this.requestCheckTimeline)},aipo.IfrGadgetService.inherits(shindig.IfrGadgetService),aipo.IfrGadgetService.prototype.setUserPref=function(){function e(e){200==e.rc}var t=this.f.replace("remote_iframe_","").split("_NN_")[0].replace("-popup",""),i=null;for(key in aipo.container.gadgets_){var o=aipo.container.gadgets_[key];if(t==o.portletId){i=key;break}}for(var a={},r=1,n=arguments.length;n>r;r+=2)a[arguments[r]]=arguments[r+1],i&&(aipo.container.gadgets_[i].userPrefs[arguments[r]]={},aipo.container.gadgets_[i].userPrefs[arguments[r]].value=arguments[r+1]);var s={CONTENT_TYPE:"JSON",METHOD:"POST",POST_DATA:gadgets.json.stringify(a)},c="?template=UserPrefUpdateJSONScreen&js_peid="+encodeURIComponent(t);gadgets.io.makeNonProxiedRequest(c,e,s,"application/javascript")},aipo.IfrGadgetService.prototype.setTitle=function(){},aipo.IfrGadgetService.prototype.requestNavigateTo=function(e,t){var i=this.f.replace("remote_iframe_","").split("_NN_")[0].replace("-popup",""),o="?js_peid="+encodeURIComponent(i);if("canvas"==e?o+="&action=controls.Maximize":"home"==e&&(o+="&action=controls.Restore"),t){var a=gadgets.json.stringify(t);a.length>0&&(o+="&appParams="+encodeURIComponent(a))}document.location.href=o},aipo.activityDesktopNotifyEnable=null,aipo.IfrGadgetService.prototype.requestDesktopNotifyEnable=function(){function e(e){if(200==e.rc){var t=e.data;t&&(aipo.activityDesktopNotifyEnable=t.enable)}}var t={},i={CONTENT_TYPE:"JSON",METHOD:"POST",POST_DATA:gadgets.json.stringify(t)},o="?template=ActivityNotifyEnableJSONScreen";null!=aipo.activityDesktopNotifyEnable?aipo.activityDesktopNotifyEnable&&0==window.webkitNotifications.checkPermission()?(o+="&enable=F",gadgets.io.makeNonProxiedRequest(o,e,i,"application/javascript")):window.webkitNotifications.requestPermission(function(){0==window.webkitNotifications.checkPermission()&&(o+="&enable=T",gadgets.io.makeNonProxiedRequest(o,e,i,"application/javascript"))}):gadgets.io.makeNonProxiedRequest(o,e,i,"application/javascript")},aipo.activityMax=null,aipo.IfrGadgetService.prototype.requestCheckActivity=function(e){function t(e){if(200==e.rc){var t=e.data,i=t.unreadCount,o={Workflow:"workflow",todo:"todo",Report:"report",Note:"note"};aipo.activityMax=t.max;var a=dijit.byId("activitycheckerContainer"),r=parseInt(i)||0;if(void 0!=dojo.byId("messagechecker")&&(r+=parseInt(dojo.byId("messagechecker").innerHTML)),void 0!=dojo.byId("supportchecker")&&(r+=parseInt(dojo.byId("supportchecker").innerHTML)),document.title=r?r>99?"(99+) "+djConfig.siteTitle:"("+r+") "+djConfig.siteTitle:djConfig.siteTitle,a){a.onCheckActivity(i);for(key in t.activities){var n=t.activities[key],s=n.appId,c=o[s];("workflow"==c||"todo"==c||"report"==c||"note"==c)&&aipo.portletReload(c)}}if(aipo.activityDesktopNotifyEnable&&window.webkitNotifications&&0==window.webkitNotifications.checkPermission()){var p=new Array;for(key in t.activities){var d=t.activities[key],g=window.webkitNotifications.createNotification("images/favicon48.png",d.displayName,d.text);g.show(),g.ondisplay=function(e){setTimeout(function(){e.currentTarget.cancel()},7e3)},p.push(g)}}}}var i={},o={CONTENT_TYPE:"JSON",METHOD:"POST",POST_DATA:gadgets.json.stringify(i)},a="?template=CheckActivityJSONScreen&isRead="+e;aipo.activityMax&&(a+="&max="+aipo.activityMax),gadgets.io.makeNonProxiedRequest(a,t,o,"application/javascript")},aipo.IfrGadgetService.prototype.requestCheckTimeline=function(){var e=0,t=dojo.byId("getTimelineOnClick").innerHTML;"true"!=t&&(dojo.query("#timelineOuter .elastic").forEach(function(t){t.value!=t.defaultValue&&e++}),void 0!=dojo.byId("modalDialog")&&"none"!=dojo.byId("modalDialog").style.display&&e++),0==e?aipo.portletReload("timeline"):dojo.query(".newMessage").style("display","")},aipo.IfrContainer=function(){shindig.Container.call(this),this.context=new Array},aipo.IfrContainer.inherits(shindig.Container),aipo.IfrContainer.prototype.gadgetClass=shindig.BaseIfrGadget,aipo.IfrContainer.prototype.gadgetService=new aipo.IfrGadgetService,aipo.IfrContainer.prototype.setParentUrl=function(e){e.match(/^http[s]?:\/\//)||(e=document.location.href.match(/^[^?#]+\//)[0]+e),this.parentUrl_=e},aipo.IfrContainer.prototype.assign=function(e){this.context.push(e)},aipo.IfrContainer.prototype.getContext=function(){return this.context},aipo.IfrContainer.prototype.addGadget=function(e){this.gadgets_[this.getGadgetKey_(e.id)]=e},aipo.IfrContainer.prototype.renderGadget=function(e){var t=this.layoutManager.getGadgetChrome(e);e.count||(e.count=0),e.count++,e.render(t)},aipo.IfrContainer.prototype.renderGadgets=function(){for(var e=this.context,t=0;t<e.length;t++){var i=e[t],o=this.createGadget(i);o.setServerBase(i.serverBase),this.addGadget(o)}aipo.cron.start()};var tmpGadget;aipo.IfrContainer.prototype.renderGadgetFromContext=function(e){var t=this.createGadget(e);t.setServerBase(e.serverBase),t.id=this.getNextGadgetInstanceId(),t.portletId+="-popup";var i="gadget-chrome-"+t.portletId,o=i?document.getElementById(i):null;t.count||(t.count=0),t.count++,t.render(o),tmpGadget=t},shindig.BaseIfrGadget.prototype.getIframeId=function(){return this.GADGET_IFRAME_PREFIX_+this.portletId+"_NN_"+this.count},shindig.BaseIfrGadget.prototype.queryIfrGadgetType_=function(){var e=this,t=aipo.IfrGadget;for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},shindig.Gadget.prototype.getContent=function(e){shindig.callAsyncAndJoin(["getMainContent"],function(t){e(t.join(""))},this)},aipo.container=new aipo.IfrContainer,aipo.container.layoutManager=new aipo.PortletLayoutManager,aipo.container.userPrefStore=new aipo.PsmlUserPrefStore,aipo.cron=new CronTask(function(e){function t(e){if(200==e.rc){for(var t=e.data,i=0;i<t.length;i++){var o=t[i],a=aipo.container.gadgets_["gadget_"+o.id];aipo.cron.isFirst||(gadgets.rpc.call("remote_iframe_"+o.portletId+"_NN_"+a.count,"update_security_token",null,o.secureToken),a.secureToken=o.secureToken);var r=o.height,n=null;if(o.views){n=o.views[aipo.container.view_];var s=0;if(n)s=n.preferredHeight;else{var c=o.views["default"];c&&(s=c.preferredHeight)}}r>0&&(a.height=r),s>0&&(a.height=s),a.scrolling=o.scrolling?"true":"no",aipo.cron.isFirst&&aipo.container.renderGadget(a)}aipo.cron.isFirst=!1}}var i=(aipo.container.context,{CONTENT_TYPE:"JSON",METHOD:"POST",POST_DATA:gadgets.json.stringify(aipo.container.context)}),o="?template=GadgetsSecurityTokenUpdateJSONScreen&view="+aipo.container.view_;aipo.cron.isFirst||(o+="&update=1"),gadgets.io.makeNonProxiedRequest(o,t,i,"application/javascript"),e()},18e5,!0),aipo.cron.isFirst=!0,aipo.container.onPopupGadgets=function(){var e=document.getElementById("gadgets-popup-action");e&&(location.href=e.href)};