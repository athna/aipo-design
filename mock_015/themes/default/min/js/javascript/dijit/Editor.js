dojo._hasResource["dijit.Editor"]||(dojo._hasResource["dijit.Editor"]=!0,dojo.provide("dijit.Editor"),dojo.require("dijit._editor.RichText"),dojo.require("dijit.Toolbar"),dojo.require("dijit._editor._Plugin"),dojo.require("dijit._Container"),dojo.require("dojo.i18n"),dojo.requireLocalization("dijit._editor","commands",null,"ROOT,cs,de,es,fr,hu,it,ja,ko,pl,pt,ru,zh,zh-tw"),dojo.declare("dijit.Editor",dijit._editor.RichText,{plugins:null,extraPlugins:null,constructor:function(){this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull"],this._plugins=[],this._editInterval=1e3*this.editActionInterval},postCreate:function(){if(this.customUndo&&(dojo.require("dijit._editor.range"),this._steps=this._steps.slice(0),this._undoedSteps=this._undoedSteps.slice(0)),dojo.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins)),dijit.Editor.superclass.postCreate.apply(this,arguments),this.commands=dojo.i18n.getLocalization("dijit._editor","commands",this.lang),!this.toolbar){var t=dojo.doc.createElement("div");dojo.place(t,this.editingArea,"before"),this.toolbar=new dijit.Toolbar({},t)}dojo.forEach(this.plugins,this.addPlugin,this),this.onNormalizedDisplayChanged()},destroy:function(){dojo.forEach(this._plugins,function(t){t.destroy&&t.destroy()}),this._plugins=[],this.toolbar.destroy(),delete this.toolbar,this.inherited("destroy",arguments)},addPlugin:function(t,i){var e=dojo.isString(t)?{name:t}:t;if(!e.setEditor){var s={args:e,plugin:null,editor:this};if(dojo.publish("dijit.Editor.getPlugin",[s]),!s.plugin){var o=dojo.getObject(e.name);o&&(s.plugin=new o(e))}if(!s.plugin)return console.debug("Cannot find plugin",t),void 0;t=s.plugin}arguments.length>1?this._plugins[i]=t:this._plugins.push(t),t.setEditor(this),dojo.isFunction(t.setToolbar)&&t.setToolbar(this.toolbar)},customUndo:dojo.isIE,editActionInterval:3,beginEditing:function(t){this._inEditing||(this._inEditing=!0,this._beginEditing(t)),this.editActionInterval>0&&(this._editTimer&&clearTimeout(this._editTimer),this._editTimer=setTimeout(dojo.hitch(this,this.endEditing),this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(t){if(this.customUndo&&("undo"==t||"redo"==t))return this[t]();try{this.customUndo&&(this.endEditing(),this._beginEditing());var i=this.inherited("execCommand",arguments);return this.customUndo&&this._endEditing(),i}catch(e){if(dojo.isMoz&&/copy|cut|paste/.test(t)){var s=dojo.string.substitute,o={cut:"X",copy:"C",paste:"V"},n=-1!=navigator.userAgent.indexOf("Macintosh");alert(s(this.commands.systemShortcutFF,[this.commands[t],s(this.commands[n?"appleKey":"ctrlKey"],[o[t]])]))}return!1}},queryCommandEnabled:function(t){return!this.customUndo||"undo"!=t&&"redo"!=t?this.inherited("queryCommandEnabled",arguments):"undo"==t?this._steps.length>1:this._undoedSteps.length>0},_changeToStep:function(t,i){this.setValue(i.text);var e=i.bookmark;if(e){if(dojo.isIE){if(dojo.isArray(e)){var s=[];dojo.forEach(e,function(t){s.push(dijit.range.getNode(t,this.editNode))},this),e=s}}else{var o=dijit.range.create();o.setStart(dijit.range.getNode(e.startContainer,this.editNode),e.startOffset),o.setEnd(dijit.range.getNode(e.endContainer,this.editNode),e.endOffset),e=o}dojo.withGlobal(this.window,"moveToBookmark",dijit,[e])}},undo:function(){this.endEditing(!0);var t=this._steps.pop();return this._steps.length>0?(this.focus(),this._changeToStep(t,this._steps[this._steps.length-1]),this._undoedSteps.push(t),this.onDisplayChanged(),!0):!1},redo:function(){this.endEditing(!0);var t=this._undoedSteps.pop();return t&&this._steps.length>0?(this.focus(),this._changeToStep(this._steps[this._steps.length-1],t),this._steps.push(t),this.onDisplayChanged(),!0):!1},endEditing:function(t){this._editTimer&&clearTimeout(this._editTimer),this._inEditing&&(this._endEditing(t),this._inEditing=!1)},_getBookmark:function(){var t=dojo.withGlobal(this.window,dijit.getBookmark);if(dojo.isIE){if(dojo.isArray(t)){var i=[];dojo.forEach(t,function(t){i.push(dijit.range.getIndex(t,this.editNode).o)},this),t=i}}else{var i=dijit.range.getIndex(t.startContainer,this.editNode).o;t={startContainer:i,startOffset:t.startOffset,endContainer:t.endContainer===t.startContainer?i:dijit.range.getIndex(t.endContainer,this.editNode).o,endOffset:t.endOffset}}return t},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:this.savedContent,bookmark:this._getBookmark()})},_endEditing:function(){var t=this.getValue(!0);this._undoedSteps=[],this._steps.push({text:t,bookmark:this._getBookmark()})},onKeyDown:function(t){if(!this.customUndo)return this.inherited("onKeyDown",arguments),void 0;var i=t.keyCode,e=dojo.keys;if(t.ctrlKey){if(90===i||122===i)return dojo.stopEvent(t),this.undo(),void 0;if(89===i||121===i)return dojo.stopEvent(t),this.redo(),void 0}switch(this.inherited("onKeyDown",arguments),i){case e.ENTER:this.beginEditing();break;case e.BACKSPACE:case e.DELETE:this.beginEditing();break;case 88:case 86:if(t.ctrlKey&&!t.altKey&&!t.metaKey){this.endEditing(),88==t.keyCode?(this.beginEditing("cut"),setTimeout(dojo.hitch(this,this.endEditing),1)):(this.beginEditing("paste"),setTimeout(dojo.hitch(this,this.endEditing),1));break}default:if(!t.ctrlKey&&!t.altKey&&!t.metaKey&&(t.keyCode<dojo.keys.F1||t.keyCode>dojo.keys.F15)){this.beginEditing();break}case e.ALT:this.endEditing();break;case e.UP_ARROW:case e.DOWN_ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.HOME:case e.END:case e.PAGE_UP:case e.PAGE_DOWN:this.endEditing(!0);break;case e.CTRL:case e.SHIFT:case e.TAB:}},_onBlur:function(){this.inherited("_onBlur",arguments),this.endEditing(!0)},onClick:function(){this.endEditing(!0),this.inherited("onClick",arguments)}}),dojo.subscribe("dijit.Editor.getPlugin",null,function(t){if(!t.plugin){var i,e=t.args,s=dijit._editor._Plugin,o=e.name;switch(o){case"undo":case"redo":case"cut":case"copy":case"paste":case"insertOrderedList":case"insertUnorderedList":case"indent":case"outdent":case"justifyCenter":case"justifyFull":case"justifyLeft":case"justifyRight":case"delete":case"selectAll":case"removeFormat":i=new s({command:o});break;case"bold":case"italic":case"underline":case"strikethrough":case"subscript":case"superscript":i=new s({buttonClass:dijit.form.ToggleButton,command:o});break;case"|":i=new s({button:new dijit.ToolbarSeparator});break;case"createLink":i=new dijit._editor.plugins.LinkDialog({command:o});break;case"foreColor":case"hiliteColor":i=new dijit._editor.plugins.TextColor({command:o});break;case"fontName":case"fontSize":case"formatBlock":i=new dijit._editor.plugins.FontChoice({command:o})}t.plugin=i}}));